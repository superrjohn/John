<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://superrjohn.github.io/John</id>
    <title>ä¸€åˆ‡éƒ½æ˜¯éç¨‹</title>
    <link href="https://superrjohn.github.io/John" />
    <updated>2023-11-08T09:27:06.236Z</updated>
    <category term="SpringSecurity" />
    <category term="hexo" />
    <category term="RabbitMQ" />
    <category term="æ”¯ä»˜" />
    <category term="Radis" />
    <category term="SpringMVC" />
    <category term="Pinia" />
    <category term="Vue2" />
    <category term="SpringBoot" />
    <entry>
        <id>https://superrjohn.github.io/John/2023/11/08/java/pay/alipay</id>
        <title>æ•´åˆæ”¯ä»˜å¯¶</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/11/08/java/pay/alipay"/>
        <content type="html">&lt;p&gt;åœ¨æ­¤ç‰¹åˆ«æ„Ÿè¬é»‘é¦¬ç¨‹åºå“¡æä¾›çš„èª²ç¨‹: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWo4NDExTjdCbS8=&#34;&gt;å­¸æˆåœ¨ç·š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰è¨€&lt;br&gt;
æ–¼ç”±å¯¦ç¿’é …ç›®å¿«åšå®Œæ‰åšè¨˜éŒ„ï¼Œè€Œä¸”é …ç›®æ¨¡å¡Šè¼ƒå¤šï¼Œæ•…æŒ‘éƒ¨ä»½ä¾†è¨˜éŒ„&lt;br&gt;
&lt;span class=&#34;rainbow&#34;&gt;å®Œæ•´é¡¹ç›®åœ°å€&lt;/span&gt;ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3N1cGVycmpvaG4vamF2YV93ZWI=&#34;&gt;https://github.com/superrjohn/java_web&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ•´åˆç¬¬ä¸‰æ–¹æ”¯ä»˜&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ•´åˆç¬¬ä¸‰æ–¹æ”¯ä»˜&#34;&gt;#&lt;/a&gt; æ•´åˆç¬¬ä¸‰æ–¹æ”¯ä»˜&lt;/h1&gt;
&lt;h2 id=&#34;åŸ·è¡Œæµç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åŸ·è¡Œæµç¨‹&#34;&gt;#&lt;/a&gt; åŸ·è¡Œæµç¨‹&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ¶å»å­¸ç¿’æ”¶è²»èª²ç¨‹æ™‚å¼•å°å…¶å»æ”¯ä»˜ï¼Œå¦‚ä¸‹åœ–ï¼š&lt;br&gt;
ç•¶ä½¿ç”¨è€…é»æ“Šå¾®ä¿¡æ”¯ä»˜æˆ–æ”¯ä»˜å¯¶æ”¯ä»˜æ™‚åŸ·è¡Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/1.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1ï¸âƒ£è«‹æ±‚å­¸ç¿’ä¸­å¿ƒæœå‹™å»ºç«‹é¸èª²è¨˜éŒ„&lt;br&gt;
2ï¸âƒ£è«‹æ±‚è¨‚å–®æœå‹™å»ºç«‹å•†å“è¨‚å–®ã€ç”¢ç”Ÿæ”¯ä»˜äºŒç¶­ç¢¼ã€‚&lt;br&gt;
3ï¸âƒ£ç”¨æˆ¶æƒç¢¼è«‹æ±‚è¨‚å–®æ”¯ä»˜æœå‹™ï¼Œè¨‚å–®æ”¯ä»˜æœå‹™è«‹æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ç”¢ç”Ÿæ”¯ä»˜è¨‚å–®ã€‚&lt;br&gt;
4ï¸âƒ£å‰ç«¯å–šèµ·æ”¯ä»˜å®¢æˆ¶ç«¯ï¼Œä½¿ç”¨è€…è¼¸å…¥å¯†ç¢¼å®Œæˆä»˜æ¬¾ã€‚&lt;br&gt;
5ï¸âƒ£ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æ”¯ä»˜å®Œæˆç™¼èµ·æ”¯ä»˜é€šçŸ¥ã€‚&lt;br&gt;
6ï¸âƒ£è¨‚å–®æ”¯ä»˜æœå‹™æ¥æ”¶ç¬¬ä¸‰æ–¹æ”¯ä»˜é€šçŸ¥çµæœã€‚&lt;br&gt;
7ï¸âƒ£ç”¨æˆ¶åœ¨å‰ç«¯æŸ¥è©¢ä»˜æ¬¾çµæœï¼Œè«‹æ±‚è¨‚å–®æ”¯ä»˜æœå‹™æŸ¥è©¢æ”¯ä»˜çµæœã€‚&lt;br&gt;
8ï¸âƒ£è¨‚å–®æ”¯ä»˜æœå‹™å‘å­¸ç¿’ä¸­å¿ƒæœå‹™é€šçŸ¥æ”¯ä»˜çµæœã€‚&lt;br&gt;
9ï¸âƒ£å­¸ç¿’ä¸­å¿ƒæœå‹™æ”¶åˆ°ä»˜æ¬¾çµæœï¼Œå¦‚æœæ”¯ä»˜æˆåŠŸå‰‡æ›´æ–°é¸èª²è¨˜éŒ„ï¼Œä¸¦æ·»åŠ åˆ°æˆ‘çš„èª²ç¨‹è¡¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é€šç”¨è¨‚å–®æœå‹™è¨­è¨ˆ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é€šç”¨è¨‚å–®æœå‹™è¨­è¨ˆ&#34;&gt;#&lt;/a&gt; é€šç”¨è¨‚å–®æœå‹™è¨­è¨ˆ&lt;/h2&gt;
&lt;p&gt;åœ¨æœ¬é …ç›®ä¸­ä¸åƒ…é¸èª²éœ€è¦ä¸‹å–®ï¼Œè³¼è²·å­¸ç¿’è³‡æ–™ã€è€å¸«ä¸€å°ä¸€ç­”ç–‘ç­‰æ‰€æœ‰æ”¶è²»é …ç›®éƒ½éœ€è¦æ”¯ä»˜ä¸‹å–®&lt;br&gt;
æ‰€ä»¥æœ¬é …ç›®è¨­è¨ˆé€šç”¨çš„è¨‚å–®æœå‹™ï¼Œé€šç”¨çš„è¨‚å–®æœå‹™æ‰¿æ¥å„æ¥­å‹™æ¨¡çµ„çš„æ”¶è²»æ”¯ä»˜éœ€æ±‚ï¼Œç•¶ç”¨æˆ¶éœ€è¦äº¤è²»æ™‚ï¼Œçµ±ä¸€ç”¢ç”Ÿå•†å“è¨‚å–®é€²è¡Œæ”¯ä»˜&lt;br&gt;
æ‰€æœ‰æ”¶è²»æ¥­å‹™æœ€çµ‚è½‰æ›ç‚ºè¨‚å–®è¨˜éŒ„ï¼Œåœ¨è¨‚å–®æœå‹™çš„å•†å“è¨‚å–®è¡¨ä¸­å­˜å„²&lt;br&gt;
ä»¥é¸èª²ç‚ºä¾‹ï¼Œé¸èª²è¨˜éŒ„è¡¨çš„ ID åœ¨å•†å“è¨‚å–®è¡¨çš„ out_business_id å­—æ®µ&lt;/p&gt;
&lt;h1 id=&#34;æº–å‚™é–‹ç™¼ç’°å¢ƒ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æº–å‚™é–‹ç™¼ç’°å¢ƒ&#34;&gt;#&lt;/a&gt; æº–å‚™é–‹ç™¼ç’°å¢ƒ&lt;/h1&gt;
&lt;h2 id=&#34;æ”¯ä»˜å¯¶é–‹ç™¼ç’°å¢ƒ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯ä»˜å¯¶é–‹ç™¼ç’°å¢ƒ&#34;&gt;#&lt;/a&gt; æ”¯ä»˜å¯¶é–‹ç™¼ç’°å¢ƒ&lt;/h2&gt;
&lt;p&gt;1ï¸âƒ£é…ç½®æ²™ç®±ç’°å¢ƒ&lt;br&gt;
æ²™ç®±ç’°å¢ƒæ˜¯æ”¯ä»˜å¯¶é–‹æ”¾å¹³å°ç‚ºé–‹ç™¼è€…æä¾›çš„èˆ‡ç”Ÿç”¢ç’°å¢ƒå®Œå…¨éš”é›¢çš„è¯èª¿æ¸¬è©¦ç’°å¢ƒï¼Œé–‹ç™¼è€…åœ¨æ²™ç®±ç’°å¢ƒä¸­å®Œæˆçš„æ¥å£å‘¼å«ä¸æœƒå°ç”Ÿç”¢ç’°å¢ƒä¸­çš„è³‡æ–™é€ æˆä»»ä½•å½±éŸ¿ã€‚&lt;br&gt;
æ¥å…¥æ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜éœ€å…·å‚™ä»¥ä¸‹æ¢ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;ğŸ”´ç”³è«‹å‰å¿…é ˆæ“æœ‰ç¶“éå¯¦åèªè­‰çš„æ”¯ä»˜å¯¶å¸³æˆ¶ï¼›&lt;/p&gt;
&lt;p&gt;ğŸ”´ä¼æ¥­æˆ–å€‹é«”å·¥å•†æˆ¶å¯ç”³è«‹ï¼›&lt;/p&gt;
&lt;p&gt;ğŸ”´éœ€æä¾›çœŸå¯¦æœ‰æ•ˆçš„ç‡Ÿæ¥­åŸ·ç…§ï¼Œä¸”æ”¯ä»˜å¯¶å¸³æˆ¶åç¨±éœ€èˆ‡ç‡Ÿæ¥­åŸ·ç…§ä¸»é«”ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;ğŸ”´ç¶²ç«™èƒ½æ­£å¸¸å­˜å–ä¸”é é¢é¡¯ç¤ºå®Œæ•´ï¼Œç¶²ç«™éœ€è¦æ˜ç¢ºç¶“ç‡Ÿå…§å®¹ä¸”æœ‰å®Œæ•´çš„å•†å“è³‡è¨Šï¼›&lt;/p&gt;
&lt;p&gt;ğŸ”´ç¶²ç«™å¿…é ˆé€é ICP å‚™æ¡ˆã€‚ å¦‚ç‚ºå€‹é«”å·¥å•†æˆ¶ï¼Œç¶²ç«™å‚™æ¡ˆä¸»é«”éœ€èˆ‡æ”¯ä»˜å¯¶å¸³æˆ¶ä¸»é«”åç¨±ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;è©³ç´°åƒè€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kb2NzLm9wZW4uYWxpcGF5LmNvbS8yMDM=&#34;&gt;https://docs.open.alipay.com/203&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æª”ä½¿ç”¨æ”¯ä»˜å¯¶æ²™ç®±é€²è¡Œé–‹ç™¼æ¸¬è©¦ï¼Œé€™è£¡ä¸»è¦ä»‹ç´¹æ”¯ä»˜å¯¶æ²™ç®±ç’°å¢ƒé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;è©³ç´°åƒè€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kb2NzLm9wZW4uYWxpcGF5LmNvbS8yMDAvMTA1MzExLw==&#34;&gt;https://docs.open.alipay.com/200/105311/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£æ¨¡æ“¬å™¨&lt;/p&gt;
&lt;p&gt;ä¸‹è¼‰æ¨¡æ“¬å™¨ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL211bXUuMTYzLmNvbS8=&#34;&gt;http://mumu.163.com/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£æ¨¡æ“¬å™¨ï¼Œå®‰è£åœ¨æ²’æœ‰ç©ºæ ¼å’Œä¸­æ–‡çš„ç›®éŒ„ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£æˆåŠŸï¼Œå•Ÿå‹•æ¨¡æ“¬å™¨&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£åœ¨æ¨¡æ“¬å™¨ä¸­å®‰è£æ²™ç®±ç‰ˆæœ¬çš„æ”¯ä»˜å¯¶&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ²™ç®±ç’°å¢ƒçš„è²·å®¶å¸³è™Ÿç™»å…¥æ²™ç®±ç‰ˆæœ¬çš„æ”¯ä»˜å¯¶&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/2.png&#34; class=&#34;abc&#34;&gt;
&lt;h1 id=&#34;å»ºç«‹è¨‚å–®æœå‹™&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å»ºç«‹è¨‚å–®æœå‹™&#34;&gt;#&lt;/a&gt; å»ºç«‹è¨‚å–®æœå‹™&lt;/h1&gt;
&lt;p&gt;æ‹·è²èª²ç¨‹è³‡æ–™ç›®éŒ„ä¸‹çš„è¨‚å–®æœå‹™å·¥ç¨‹ xuecheng-plus-orders åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®éŒ„&lt;/p&gt;
&lt;p&gt;ç„¶å¾Œåœ¨ nacos ä¸­æ·»åŠ é…ç½®æ–‡ä»¶&lt;br&gt;
 orders-api-dev.yaml&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;yaml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;server:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;servlet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;context-path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/orders&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;63030&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spring:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;attr&#34;&gt;cloud:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;config:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;override-none:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;orders-service-dev.yaml&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;yaml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spring:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;datasource:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;driver-class-name:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;com.mysql.cj.jdbc.Driver&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;url:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;jdbc:mysql://localhost:3306/xc_orders?serverTimezone=UTC&amp;amp;userUnicode=true&amp;amp;useSSL=false&amp;amp;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;username:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;root&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;password:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;root&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;xxl:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;job:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;admin:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;addresses:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http://192.168.101.128:18088/xxl-job-admin/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;executor:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;appname:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;payresultnotify-job&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;address:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;ip:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;8989&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;logpath:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/data/applogs/xxl-job/jobhandler&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;logretentiondays:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;30&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;accessToken:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;default_token&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å»ºç«‹ xc_orders è³‡æ–™åº«ï¼Œå°å…¥é»‘é¦¬æä¾›çš„ SQL è…³æœ¬&lt;/p&gt;
&lt;h1 id=&#34;æ”¯ä»˜æ¥å£æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯ä»˜æ¥å£æ¸¬è©¦&#34;&gt;#&lt;/a&gt; æ”¯ä»˜æ¥å£æ¸¬è©¦&lt;/h1&gt;
&lt;h2 id=&#34;é–±è®€æ¥å£å®šç¾©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é–±è®€æ¥å£å®šç¾©&#34;&gt;#&lt;/a&gt; é–±è®€æ¥å£å®šç¾©&lt;/h2&gt;
&lt;p&gt;1. æ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜æ¥å–æµç¨‹è©³ç´°åƒè€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kb2NzLm9wZW4uYWxpcGF5LmNvbS8yMDMvMTA1Mjg1Lw==&#34;&gt;https://docs.open.alipay.com/203/105285/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£ç”¨æˆ¶åœ¨å•†å®¶çš„ H5 ç¶²ç«™ä¸‹å–®ä»˜æ¬¾å¾Œï¼Œå•†å®¶ç³»çµ±ä¾ç…§æ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜æ¥å£ alipay.trade.wap.payAPI çš„åƒæ•¸è¦æ ¼ç”¢ç”Ÿè¨‚å–®æ•¸æ“š&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å‰ç«¯é é¢é€é Form è¡¨å–®çš„å½¢å¼è«‹æ±‚åˆ°æ”¯ä»˜å¯¶ã€‚ æ­¤æ™‚æ”¯ä»˜å¯¶æœƒè‡ªå‹•å°‡é é¢è·³åˆ°æ”¯ä»˜å¯¶ H5 æ”¶éŠ€å°é é¢ï¼Œå¦‚æœç”¨æˆ¶æ‰‹æ©Ÿä¸Šå®‰è£äº†æ”¯ä»˜å¯¶ APPï¼Œå‰‡æœƒè‡ªå‹•å–šèµ·æ”¯ä»˜å¯¶ APPã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£è¼¸å…¥æ”¯ä»˜å¯†ç¢¼å®Œæˆä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£ç”¨æˆ¶åœ¨æ”¯ä»˜å¯¶ APP æˆ– H5 æ”¶éŠ€å°å®Œæˆä»˜æ¬¾å¾Œï¼Œæœƒæ ¹æ“šå•†å®¶åœ¨æ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜ API ä¸­å‚³å…¥çš„å‰å°å›è·³åœ°å€ return_url è‡ªå‹•è·³è½‰å›å•†å®¶é é¢ï¼ŒåŒæ™‚åœ¨ URL è«‹æ±‚ä¸­ä»¥ Query String çš„å½¢å¼é™„å¸¶ æ”¯ä»˜çµæœåƒæ•¸ï¼Œè©³ç´°å›è·³åƒæ•¸è«‹è¦‹ã€Œæ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜æ¥å£ alipay.trade.wap.payã€å‰å°å›è·³åƒæ•¸ã€‚&lt;/p&gt;
&lt;p&gt;5ï¸âƒ£æ”¯ä»˜å¯¶ä¹Ÿæœƒæ ¹æ“šåŸå§‹æ”¯ä»˜ API ä¸­å‚³å…¥çš„éåŒæ­¥é€šçŸ¥åœ°å€ notify_urlï¼Œé€é POST è«‹æ±‚çš„å½¢å¼å°‡æ”¯ä»˜çµæœä½œç‚ºåƒæ•¸é€šçŸ¥åˆ°å•†å®¶ç³»çµ±ï¼Œè©³æƒ…è«‹åƒé–±æ”¯ä»˜çµæœéåŒæ­¥é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ¥å£å®šç¾©&lt;/p&gt;
&lt;p&gt;æ–‡æª”ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuZG9jcy5hbGlwYXkuY29tL29wZW4vMjAzLzEwNzA5MA==&#34;&gt;https://opendocs.alipay.com/open/203/107090&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ¥å£å®šç¾©ï¼šå¤–éƒ¨å•†å®¶è¦æ±‚æ”¯ä»˜å¯¶å»ºç«‹è¨‚å–®ä¸¦æ”¯ä»˜&lt;/p&gt;
&lt;p&gt;è«‹æ±‚åœ°å€ï¼šé–‹ç™¼ä¸­ä½¿ç”¨æ²™ç®±ä½å€ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuYXBpLmFsaXBheWRldi5jb20vZ2F0ZXdheS5kbw==&#34;&gt;https://openapi.alipaydev.com/gateway.do&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è«‹æ±‚åƒæ•¸ï¼šè©³ç´°æŸ¥é–±&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuZG9jcy5hbGlwYXkuY29tL29wZW4vMjAzLzEwNzA5MA==&#34;&gt; https://opendocs.alipay.com/open/203/107090&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ä¸€éƒ¨åˆ†ç”± sdk è¨­ç½®ï¼Œä¸€éƒ¨åˆ†éœ€è¦ç·¨å¯«ç¨‹å¼æ™‚æŒ‡å®šã€‚&lt;/p&gt;
&lt;p&gt;3. ç¤ºä¾‹ä»£ç¢¼&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;doPost&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpServletRequest httpRequest,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;                HttpServletResponse httpResponse)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; ServletException, IOException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayClient&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ... &lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayRequest&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt;();&lt;span class=&#34;comment&#34;&gt;//åˆ›å»ºAPIå¯¹åº”çš„request&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    alipayRequest.setReturnUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://domain.com/CallBack/return_url.jsp&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    alipayRequest.setNotifyUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://domain.com/CallBack/notify_url.jsp&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    alipayRequest.setBizContent(&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;#123;&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;out_trade_no\&amp;quot;:\&amp;quot;20150320010101002\&amp;quot;,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;total_amount\&amp;quot;:88.88,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;subject\&amp;quot;:\&amp;quot;Iphone6 16G\&amp;quot;,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;product_code\&amp;quot;:\&amp;quot;QUICK_WAP_WAY\&amp;quot;&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;string&#34;&gt;&amp;quot;  &amp;#125;&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//å¡«å……ä¸šåŠ¡å‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;form&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; alipayClient.pageExecute(alipayRequest).getBody(); &lt;span class=&#34;comment&#34;&gt;//è°ƒç”¨SDKç”Ÿæˆè¡¨å•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    httpResponse.setContentType(&lt;span class=&#34;string&#34;&gt;&amp;quot;text/html;charset=&amp;quot;&lt;/span&gt; + AlipayServiceEnvConstants.CHARSET);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    httpResponse.getWriter().write(form);&lt;span class=&#34;comment&#34;&gt;//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    httpResponse.getWriter().flush();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ä¸‹å–®åŸ·è¡Œæµç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‹å–®åŸ·è¡Œæµç¨‹&#34;&gt;#&lt;/a&gt; ä¸‹å–®åŸ·è¡Œæµç¨‹&lt;/h2&gt;
&lt;p&gt;æ ¹æ“šæ¥å£æè¿°ï¼Œæ”¯ä»˜å¯¶ä¸‹å–®æ¥å£çš„åŸ·è¡Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/3.png&#34; class=&#34;abc&#34;&gt;
&lt;h2 id=&#34;ç·¨å¯«ä¸‹å–®ç¨‹å¼ç¢¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·¨å¯«ä¸‹å–®ç¨‹å¼ç¢¼&#34;&gt;#&lt;/a&gt; ç·¨å¯«ä¸‹å–®ç¨‹å¼ç¢¼&lt;/h2&gt;
&lt;p&gt;æ ¹æ“šæ¥å£æµç¨‹ï¼Œé¦–å…ˆåœ¨è¨‚å–®æœå‹™ç·¨å¯«æ¸¬è©¦é¡åˆ¥è«‹æ±‚æ”¯ä»˜å¯¶ä¸‹å–®çš„æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¨‚å–®æœå‹™ api å·¥ç¨‹æ·»åŠ ä¾è³´ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;xml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;lt;!-- æ”¯ä»˜å®SDK --&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.alipay.sdk&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;alipay-sdk-java&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.7.73.ALL&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;lt;!-- æ”¯ä»˜å®SDKä¾èµ–çš„æ—¥å¿— --&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;commons-logging&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;commons-logging&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.2&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ‹·è² AlipayConfig.java åˆ°è¨‚å–®æœå‹™çš„ service å·¥ç¨‹ï¼Œå…¶ä¸­è«‹æ±‚ç¶²ç«™åœ°å€ç‚ºæ”¯ä»˜å¯¶æ”¯ä»˜æ¥å£åœ°å€&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayConfig&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// å•†æˆ·appid&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//	public static String APPID = &amp;quot;&amp;quot;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// ç§é’¥ pkcs8æ ¼å¼çš„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//	public static String RSA_PRIVATE_KEY = &amp;quot;&amp;quot;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// æœåŠ¡å™¨å¼‚æ­¥é€šçŸ¥é¡µé¢è·¯å¾„ éœ€http://æˆ–è€…https://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;notify_url&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;http://å•†æˆ·ç½‘å…³åœ°å€/alipay.trade.wap.pay-JAVA-UTF-8/notify_url.jsp&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥é¡µé¢è·¯å¾„ éœ€http://æˆ–è€…https://æ ¼å¼çš„å®Œæ•´è·¯å¾„ï¼Œä¸èƒ½åŠ ?id=123è¿™ç±»è‡ªå®šä¹‰å‚æ•°ï¼Œå¿…é¡»å¤–ç½‘å¯ä»¥æ­£å¸¸è®¿é—® å•†æˆ·å¯ä»¥è‡ªå®šä¹‰åŒæ­¥è·³è½¬åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;return_url&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;http://å•†æˆ·ç½‘å…³åœ°å€/alipay.trade.wap.pay-JAVA-UTF-8/return_url.jsp&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// è¯·æ±‚ç½‘å…³åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;https://openapi.alipaydev.com/gateway.do&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// ç¼–ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;CHARSET&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// è¿”å›æ ¼å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;FORMAT&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;json&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// æ”¯ä»˜å®å…¬é’¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//	public static String ALIPAY_PUBLIC_KEY = &amp;quot;&amp;quot;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// æ—¥å¿—è®°å½•ç›®å½•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;log_path&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;/log&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// RSA2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;SIGNTYPE&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;RSA2&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æƒç¢¼æ”¯ä»˜å…¶å¯¦å°±æ˜¯è«‹æ±‚ URL, æ‰€ä»¥æˆ‘å€‘è¦å¯«ä¸€å€‹ Controller, æˆ‘å€‘è¦ new DefaultAlipayClient é¡ä¸¦ä¿®æ”¹åƒæ•¸&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Controller&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayTestController&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_ID&amp;#125;&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String APP_ID;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_PRIVATE_KEY&amp;#125;&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String APP_PRIVATE_KEY;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.ALIPAY_PUBLIC_KEY&amp;#125;&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String ALIPAY_PUBLIC_KEY;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/alipaytest&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;doPost&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpServletRequest httpRequest,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;                    HttpServletResponse httpResponse)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; ServletException, IOException, AlipayApiException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayClient&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultAlipayClient&lt;/span&gt;(AlipayConfig.URL, APP_ID, APP_PRIVATE_KEY, AlipayConfig.FORMAT, AlipayConfig.CHARSET, ALIPAY_PUBLIC_KEY,AlipayConfig.SIGNTYPE);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayRequest&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt;();&lt;span class=&#34;comment&#34;&gt;//åˆ›å»ºAPIå¯¹åº”çš„request&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        alipayRequest.setReturnUrl(&amp;quot;http://domain.com/CallBack/return_url.jsp&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        alipayRequest.setNotifyUrl(&amp;quot;http://domain.com/CallBack/notify_url.jsp&amp;quot;);//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        alipayRequest.setBizContent(&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;#123;&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;out_trade_no\&amp;quot;:\&amp;quot;202210100010101002\&amp;quot;,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;total_amount\&amp;quot;:100000,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;subject\&amp;quot;:\&amp;quot;Iphone6 16G\&amp;quot;,&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot;    \&amp;quot;product_code\&amp;quot;:\&amp;quot;QUICK_WAP_WAY\&amp;quot;&amp;quot;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot;  &amp;#125;&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//å¡«å……ä¸šåŠ¡å‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;form&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; alipayClient.pageExecute(alipayRequest).getBody(); &lt;span class=&#34;comment&#34;&gt;//è°ƒç”¨SDKç”Ÿæˆè¡¨å•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.setContentType(&lt;span class=&#34;string&#34;&gt;&amp;quot;text/html;charset=&amp;quot;&lt;/span&gt; + AlipayConfig.CHARSET);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.getWriter().write(form);&lt;span class=&#34;comment&#34;&gt;//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.getWriter().flush();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ nacos ä¸­çš„ orders-service-dev.yaml ä¸­é…ç½®å…¬é’¥å’Œç§é’¥ï¼Œå¾ä½ çš„æ²™ç®±ç’°å¢ƒå¸³è™Ÿç²å¾—&lt;/p&gt;
&lt;figure class=&#34;highlight yml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;yml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;pay:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;alipay:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;APP_ID:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;å†™ä½ è‡ªå·±çš„AppID&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;APP_PRIVATE_KEY:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;å†™ä½ è‡ªå·±çš„åº”ç”¨ç§é’¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;ALIPAY_PUBLIC_KEY:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;å†™ä½ è‡ªå·±çš„æ”¯ä»˜å®å…¬é’¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç”¢ç”ŸäºŒç¶­ç¢¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç”¢ç”ŸäºŒç¶­ç¢¼&#34;&gt;#&lt;/a&gt; ç”¢ç”ŸäºŒç¶­ç¢¼&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨è€…åœ¨å‰ç«¯ä½¿ç”¨æ”¯ä»˜å¯¶æ²™ç®±é€éæƒç¢¼è«‹æ±‚ä¸‹å–®æ¥å£ï¼Œæˆ‘å€‘éœ€è¦ç”¢ç”Ÿè¨‚å–®æœå‹™çš„ä¸‹å–®æ¥å£çš„äºŒç¶­ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;ZXing æ˜¯ä¸€å€‹é–‹æºçš„é¡åˆ¥åº«ï¼Œæ˜¯ç”¨ Java ç·¨å¯«çš„å¤šæ ¼å¼çš„ 1D / 2D æ¢ç¢¼åœ–åƒè™•ç†åº«ï¼Œä½¿ç”¨ ZXing å¯ä»¥ç”¢ç”Ÿã€è­˜åˆ¥ QR Codeï¼ˆäºŒç¶­ç¢¼ï¼‰ã€‚ å¸¸ç”¨çš„äºŒç¶­ç¢¼è™•ç†åº«é‚„æœ‰ zbarï¼Œè¿‘å¹¾å¹´ä¸å†æ›´æ–°ç¨‹å¼ç¢¼ï¼Œä¸‹é‚Šä»‹ç´¹ ZXing ç”¢ç”ŸäºŒç¶­ç¢¼çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;1ï¼‰åœ¨ base å·¥ç¨‹ pom.xml ä¸­åŠ å…¥ä¾è³´ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;XML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;&amp;lt;!-- äºŒç»´ç ç”Ÿæˆ&amp;amp;è¯†åˆ«ç»„ä»¶ --&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.google.zxing&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;core&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.3.3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.google.zxing&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;javase&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.3.3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.apache.commons&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;commons-lang3&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¼‰ç”¢ç”ŸäºŒç¶­ç¢¼æ–¹æ³•&lt;/p&gt;
&lt;p&gt;æ‹·è²èª²ç¨‹è³‡æ–™ä¸­ utils ä¸‹çš„ QRCodeUtil.java åˆ° base å·¥ç¨‹ util åŒ…ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æ¸¬è©¦æ ¹æ“šå…§å®¹ç”¢ç”ŸäºŒç¶­ç¢¼æ–¹æ³•ï¼Œåœ¨ QRCodeUtil ä¸­åŠ å…¥ main æ–¹æ³•ï¼Œç•¶åŸ·è¡Œä»£ç¢¼æ™‚æœƒç”Ÿæˆ base64 ä¸²ï¼Œå°‡ base64 ä¸²è¤‡è£½åˆ°ç€è¦½å™¨ä½å€å¾Œå°‡é¡¯ç¤ºä¸€å€‹äºŒç¶­ç¢¼ï¼Œç”¨æˆ¶ç”¨æ‰‹æ©Ÿæƒæ­¤äºŒç¶­ç¢¼å°‡è¦æ±‚è‡³&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy5pdGNhc3QuY24v&#34;&gt; http://www.itcast.cn/&lt;/span&gt; , å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String[] args)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;QRCodeUtil&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;qrCodeUtil&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;QRCodeUtil&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    System.out.println(qrCodeUtil.createQRCode(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://www.itcast.cn/&amp;quot;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ¥å£æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å£æ¸¬è©¦&#34;&gt;#&lt;/a&gt; æ¥å£æ¸¬è©¦&lt;/h2&gt;
&lt;p&gt;ä¿®æ”¹æˆ‘å€‘ä¹‹å‰çš„ main æ–¹æ³•ï¼Œå°‡ url æ›æˆä¸‹å–®æ¥å£ï¼Œæ³¨æ„é€™è£¡ä¸è¦ç”¨ localhostï¼Œå¾—ç”¨æœ¬æ©Ÿå€åŸŸç¶²è·¯ ip, ç¾åœ¨ç”¨æˆ¶æƒç¢¼å¾Œæœƒè«‹æ±‚åˆ°æˆ‘å€‘å¯«çš„æ”¯ä»˜æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String[] args)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;QRCodeUtil&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;qrCodeUtil&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;QRCodeUtil&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    System.out.println(qrCodeUtil.createQRCode(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://192.168.101.1:63030/orders/alipaytest&amp;quot;&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‹è¡Œ main æ–¹æ³•ï¼Œå¾—åˆ°äºŒç¶­ç¢¼å¾Œï¼Œé–‹å•Ÿæ¨¡æ“¬å™¨ï¼Œåœ¨æ¨¡æ“¬å™¨ä¸­é–‹å•Ÿæ”¯ä»˜å¯¶æ²™ç®±å®¢æˆ¶ç«¯ï¼Œä¸¦ä½¿ç”¨æ²™ç®±å®¢æˆ¶ç«¯æƒç”Ÿæˆçš„äºŒç¶­ç¢¼ï¼Œå°±æœƒèª¿ç”¨ SDK ç”Ÿæˆè¡¨å–®ï¼Œä¸¦å–šé†’æ”¯ä»˜å¯¶çš„ JS çª—å£&lt;/p&gt;
&lt;h1 id=&#34;æ”¯ä»˜çµæœæŸ¥è©¢æ¥å£&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯ä»˜çµæœæŸ¥è©¢æ¥å£&#34;&gt;#&lt;/a&gt; æ”¯ä»˜çµæœæŸ¥è©¢æ¥å£&lt;/h1&gt;
&lt;p&gt;æ”¯ä»˜å®Œæˆå¯ä»¥å‘¼å«ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„ä»˜æ¬¾çµæœæŸ¥è©¢æ¥å£æŸ¥è©¢æ”¯ä»˜çµæœï¼Œä»¥ä¸‹ç”¨æ¸¬è©¦é¡æŸ¥è©¢&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuZG9jcy5hbGlwYXkuY29tL29wZW4vMDJpdmJ0&#34;&gt;https://opendocs.alipay.com/open/02ivbt&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰›æ‰è¨‚å–®ä»˜æ¬¾æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ out_trade_no å•†å“è¨‚å–®è™Ÿç¢¼æˆ–æ”¯ä»˜å¯¶çš„äº¤æ˜“æµæ°´è™Ÿ trade_no å»æŸ¥è©¢ä»˜æ¬¾çµæœã€‚&lt;/p&gt;
&lt;p&gt;out_trade_no å•†å“è¨‚å–®è™Ÿç¢¼ï¼šæ˜¯åœ¨ä¸‹å–®è¦æ±‚æ™‚æŒ‡å®šçš„å•†å“è¨‚å–®è™Ÿç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;æ”¯ä»˜å¯¶çš„äº¤æ˜“æµæ°´è™Ÿ trade_noï¼šæ˜¯æ”¯ä»˜å®Œæˆå¾Œæ”¯ä»˜å¯¶é€šçŸ¥ä»˜æ¬¾çµæœæ™‚ç™¼é€çš„ trade_no&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@SpringBootTest&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AliPayTest&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_ID&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String APP_ID; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_PRIVATE_KEY&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String APP_PRIVATE_KEY; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.ALIPAY_PUBLIC_KEY&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String ALIPAY_PUBLIC_KEY; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Test&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;queryPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; AlipayApiException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayClient&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultAlipayClient&lt;/span&gt;(AlipayConfig.URL, APP_ID, APP_PRIVATE_KEY, &lt;span class=&#34;string&#34;&gt;&amp;quot;json&amp;quot;&lt;/span&gt;, AlipayConfig.CHARSET, ALIPAY_PUBLIC_KEY, AlipayConfig.SIGNTYPE); &lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayTradeQueryRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeQueryRequest&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;JSONObject&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;bizContent&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;JSONObject&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    bizContent.put(&lt;span class=&#34;string&#34;&gt;&amp;quot;out_trade_no&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;202210100010101002&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//bizContent.put(&amp;quot;trade_no&amp;quot;, &amp;quot;2014112611001004680073956707&amp;quot;); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    request.setBizContent(bizContent.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayTradeQueryResponse&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; alipayClient.execute(request); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (response.isSuccess()) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨æˆåŠŸ&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;resultJson&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; response.getBody(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è½¬map &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;resultMap&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(resultJson, Map.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipay_trade_query_response&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (Map) resultMap.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;alipay_trade_query_response&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) alipay_trade_query_response.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_status&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(trade_status); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;éŸ¿æ‡‰å›ä¾†é‡è¦çš„åƒæ•¸ç‚º:&lt;br&gt;
â€œout_trade_noâ€ : â€œ20220520010101026â€,&lt;/p&gt;
&lt;p&gt;â€œtrade_noâ€:â€œ2022100422001422760505740639â€  ï¼š æ”¯ä»˜å®äº¤æ˜“æµæ°´å·&lt;/p&gt;
&lt;p&gt;â€œtotal_amountâ€ : â€œ1.30â€&lt;/p&gt;
&lt;p&gt;â€œtrade_statusâ€ : â€œTRADE_SUCCESSâ€ï¼š&lt;/p&gt;
&lt;h2 id=&#34;æ”¯ä»˜çµæœé€šçŸ¥æ¥å£&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯ä»˜çµæœé€šçŸ¥æ¥å£&#34;&gt;#&lt;/a&gt; æ”¯ä»˜çµæœé€šçŸ¥æ¥å£&lt;/h2&gt;
&lt;p&gt;æº–å‚™ç’°å¢ƒ&lt;br&gt;
å°æ–¼æ‰‹æ©Ÿç¶²ç«™æ”¯ä»˜ç”¢ç”Ÿçš„äº¤æ˜“ï¼Œæ”¯ä»˜å¯¶æœƒé€šçŸ¥å•†å®¶æ”¯ä»˜çµæœï¼Œæœ‰å…©ç¨®é€šçŸ¥æ–¹å¼ï¼Œé€é return_urlã€notify_url é€²è¡Œé€šçŸ¥ï¼Œä½¿ç”¨ return_url ä¸èƒ½ä¿è­‰é€šçŸ¥åˆ°ä½ï¼Œæ¨è–¦ä½¿ç”¨ notify_url å®Œæˆæ”¯ä»˜çµæ§‹é€šçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;å…·é«”çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨å‘¼å«ä¸‹å–®æ¥å£çš„ API ä¸­å‚³å…¥çš„éåŒæ­¥é€šçŸ¥ä½å€ notify_urlï¼Œé€é POST è«‹æ±‚çš„å½¢å¼å°‡æ”¯ä»˜çµæœä½œç‚ºåƒæ•¸é€šçŸ¥åˆ°å•†å®¶ç³»çµ±ã€‚ è©³æƒ…å¯æŸ¥çœ‹ æ”¯ä»˜å¯¶éåŒæ­¥é€šçŸ¥èªªæ˜ ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuZG9jcy5hbGlwYXkuY29tL29wZW4vMjAzLzEwNTI4Ng==&#34;&gt;https://opendocs.alipay.com/open/203/105286&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ“šä¸‹å–®åŸ·è¡Œæµç¨‹ï¼Œè¨‚å–®æœå‹™æ”¶åˆ°ä»˜æ¬¾çµæœéœ€è¦å°å…§å®¹é€²è¡Œé©—ç°½ï¼Œé©—ç°½æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£åœ¨é€šçŸ¥å›å‚³åƒæ•¸æ¸…å–®ä¸­ï¼Œé™¤å» signã€sign_type å…©å€‹åƒæ•¸å¤–ï¼Œå‡¡æ˜¯é€šçŸ¥å›å‚³å›ä¾†çš„åƒæ•¸éƒ½æ˜¯å¾…é©—ç°½çš„åƒæ•¸ã€‚ å°‡å‰©é¤˜åƒæ•¸é€²è¡Œ url_decodeï¼Œç„¶å¾Œé€²è¡Œå­—å…¸æ’åºï¼Œçµ„æˆå­—ä¸²ï¼Œå¾—åˆ°å¾…ç°½åå­—ä¸²ï¼› ç”Ÿæ´»è™ŸéåŒæ­¥é€šçŸ¥çµ„æˆçš„å¾…é©—ç°½ä¸²è£¡éœ€è¦ä¿ç•™ sign_type åƒæ•¸ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å°‡ç°½ç« åƒæ•¸ï¼ˆsignï¼‰ä½¿ç”¨ base64 è§£ç¢¼ç‚ºå­—ç¯€ç¢¼å­—ä¸²ï¼›&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ä½¿ç”¨ RSA çš„é©—ç°½æ–¹æ³•ï¼Œé€éç°½ç« å­—ä¸²ã€ç°½ç« åƒæ•¸ï¼ˆç¶“é base64 è§£ç¢¼ï¼‰åŠæ”¯ä»˜å¯¶å…¬é‘°é©—è­‰ç°½ç« ã€‚&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£é©—è­‰ç°½ç« æ­£ç¢ºå¾Œï¼Œå¿…é ˆå†åš´æ ¼ä¾ç…§ä»¥ä¸‹æè¿°æ ¡é©—é€šçŸ¥è³‡æ–™çš„æ­£ç¢ºæ€§ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šè¿°é©—è­‰é€šéå¾Œï¼Œå•†å®¶å¿…é ˆæ ¹æ“šæ”¯ä»˜å¯¶ä¸åŒé¡å‹çš„æ¥­å‹™é€šçŸ¥ï¼Œæ­£ç¢ºçš„é€²è¡Œä¸åŒçš„æ¥­å‹™è™•ç†ï¼Œä¸¦ä¸”éæ¿¾é‡è¤‡çš„é€šçŸ¥çµæœè³‡æ–™ã€‚&lt;/p&gt;
&lt;p&gt;é€éé©—è­‰ out_trade_noã€total_amountã€appid åƒæ•¸çš„æ­£ç¢ºæ€§ä¾†åˆ¤æ–·é€šçŸ¥è«‹æ±‚çš„åˆæ³•æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç·¨å¯«æ¸¬è©¦ç¨‹å¼ç¢¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·¨å¯«æ¸¬è©¦ç¨‹å¼ç¢¼&#34;&gt;#&lt;/a&gt; ç·¨å¯«æ¸¬è©¦ç¨‹å¼ç¢¼&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸‹å–®è«‹æ±‚æ™‚è¨­å®šé€šçŸ¥ä½å€ request.setNotifyUrl (â€œå•†å®¶è‡ªå·±çš„ notify_url ä½å€â€);&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/alipaytest&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;alipaytest&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpServletRequest httpRequest, &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;params&#34;&gt;                           HttpServletResponse httpResponse)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; ServletException, IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ„é€ sdkçš„å®¢æˆ·ç«¯å¯¹è±¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayClient&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultAlipayClient&lt;/span&gt;(serverUrl, APP_ID, APP_PRIVATE_KEY, &lt;span class=&#34;string&#34;&gt;&amp;quot;json&amp;quot;&lt;/span&gt;, CHARSET, ALIPAY_PUBLIC_KEY, sign_type); &lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayRequest&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt;();&lt;span class=&#34;comment&#34;&gt;//åˆ›å»ºAPIå¯¹åº”çš„request &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        alipayRequest.setReturnUrl(&amp;quot;http://domain.com/CallBack/return_url.jsp&amp;quot;); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        alipayRequest.setNotifyUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://tjxt-user-t.itheima.net/xuecheng/orders/paynotify&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ..... &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;span class=&#34;yellow&#34;&gt;æ³¨æ„ç”±æ–¼å›å‘¼ä½å€å¿…é ˆå¤–ç¶²å¯å­˜å–çš„ä½å€ï¼Œæ‰€ä»¥é€™è£¡éœ€è¦å…§ç¶²ç©¿é€å·¥å…·ï¼Œå¯ä»¥ç”¨ NatApp æˆ–è€…èŠ±ç”Ÿæ®¼&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ç·¨å¯«æ¥æ”¶é€šçŸ¥æ¥å£ï¼Œæ¥æ”¶åƒæ•¸ä¸¦é©—ç°½&lt;/p&gt;
&lt;p&gt;åƒè€ƒèª²ç¨‹è³‡æ–™ä¸‹çš„ alipay.trade.wap.pay-java-utf-8\WebContent\notify_url.jsp, ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//æ¥æ”¶é€šçŸ¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@PostMapping(&amp;quot;/paynotify&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;paynotify&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpServletRequest request,HttpServletResponse response)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UnsupportedEncodingException, AlipayApiException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String,String&amp;gt; params = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;HashMap&lt;/span&gt;&amp;lt;String,String&amp;gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;requestParams&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; request.getParameterMap(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;type&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;iter&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; requestParams.keySet().iterator(); iter.hasNext();) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) iter.next(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        String[] values = (String[]) requestParams.get(name); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;valueStr&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;; i &amp;lt; values.length; i++) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            valueStr = (i == values.length - &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;) ? valueStr + values[i] &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    : valueStr + values[i] + &lt;span class=&#34;string&#34;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ä¹±ç è§£å†³ï¼Œè¿™æ®µä»£ç åœ¨å‡ºç°ä¹±ç æ—¶ä½¿ç”¨ã€‚å¦‚æœmysignå’Œsignä¸ç›¸ç­‰ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ®µä»£ç è½¬åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//valueStr = new String(valueStr.getBytes(&amp;quot;ISO-8859-1&amp;quot;), &amp;quot;gbk&amp;quot;); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        params.put(name, valueStr); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è·å–æ”¯ä»˜å®çš„é€šçŸ¥è¿”å›å‚æ•°ï¼Œå¯å‚è€ƒæŠ€æœ¯æ–‡æ¡£ä¸­é¡µé¢è·³è½¬åŒæ­¥é€šçŸ¥å‚æ•°åˆ—è¡¨(ä»¥ä¸Šä»…ä¾›å‚è€ƒ)// &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®¡ç®—å¾—å‡ºé€šçŸ¥éªŒè¯ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//boolean AlipaySignature.rsaCheckV1(Map&amp;lt;String, String&amp;gt; params, String publicKey, String charset, String sign_type) &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;verify_result&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; AlipaySignature.rsaCheckV1(params, ALIPAY_PUBLIC_KEY, AlipayConfig.CHARSET, &lt;span class=&#34;string&#34;&gt;&amp;quot;RSA2&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(verify_result) &amp;#123;&lt;span class=&#34;comment&#34;&gt;//éªŒè¯æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;////////////////////////////////////////////////////////////////////////////////////////// &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¯·åœ¨è¿™é‡ŒåŠ ä¸Šå•†æˆ·çš„ä¸šåŠ¡é€»è¾‘ç¨‹åºä»£ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;span class=&#34;comment&#34;&gt;//å•†æˆ·è®¢å•å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;out_trade_no&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;out_trade_no&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜å®äº¤æ˜“å·     &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_no&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_no&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//äº¤æ˜“çŠ¶æ€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_status&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//â€”â€”è¯·æ ¹æ®æ‚¨çš„ä¸šåŠ¡é€»è¾‘æ¥ç¼–å†™ç¨‹åºï¼ˆä»¥ä¸‹ä»£ç ä»…ä½œå‚è€ƒï¼‰â€”â€” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (trade_status.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;TRADE_FINISHED&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;span class=&#34;comment&#34;&gt;//äº¤æ˜“ç»“æŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//åˆ¤æ–­è¯¥ç¬”è®¢å•æ˜¯å¦åœ¨å•†æˆ·ç½‘ç«™ä¸­å·²ç»åšè¿‡å¤„ç† &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæ²¡æœ‰åšè¿‡å¤„ç†ï¼Œæ ¹æ®è®¢å•å·ï¼ˆout_trade_noï¼‰åœ¨å•†æˆ·ç½‘ç«™çš„è®¢å•ç³»ç»Ÿä¸­æŸ¥åˆ°è¯¥ç¬”è®¢å•çš„è¯¦ç»†ï¼Œå¹¶æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//è¯·åŠ¡å¿…åˆ¤æ–­è¯·æ±‚æ—¶çš„total_feeã€seller_idä¸é€šçŸ¥æ—¶è·å–çš„total_feeã€seller_idä¸ºä¸€è‡´çš„ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæœ‰åšè¿‡å¤„ç†ï¼Œä¸æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//æ³¨æ„ï¼š &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœç­¾çº¦çš„æ˜¯å¯é€€æ¬¾åè®®ï¼Œé€€æ¬¾æ—¥æœŸè¶…è¿‡å¯é€€æ¬¾æœŸé™åï¼ˆå¦‚ä¸‰ä¸ªæœˆå¯é€€æ¬¾ï¼‰ï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæ²¡æœ‰ç­¾çº¦å¯é€€æ¬¾åè®®ï¼Œé‚£ä¹ˆä»˜æ¬¾å®Œæˆåï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥ã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (trade_status.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;TRADE_SUCCESS&amp;quot;&lt;/span&gt;)) &amp;#123;&lt;span class=&#34;comment&#34;&gt;//äº¤æ˜“æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            System.out.println(trade_status); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//åˆ¤æ–­è¯¥ç¬”è®¢å•æ˜¯å¦åœ¨å•†æˆ·ç½‘ç«™ä¸­å·²ç»åšè¿‡å¤„ç† &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæ²¡æœ‰åšè¿‡å¤„ç†ï¼Œæ ¹æ®è®¢å•å·ï¼ˆout_trade_noï¼‰åœ¨å•†æˆ·ç½‘ç«™çš„è®¢å•ç³»ç»Ÿä¸­æŸ¥åˆ°è¯¥ç¬”è®¢å•çš„è¯¦ç»†ï¼Œå¹¶æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//è¯·åŠ¡å¿…åˆ¤æ–­è¯·æ±‚æ—¶çš„total_feeã€seller_idä¸é€šçŸ¥æ—¶è·å–çš„total_feeã€seller_idä¸ºä¸€è‡´çš„ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæœ‰åšè¿‡å¤„ç†ï¼Œä¸æ‰§è¡Œå•†æˆ·çš„ä¸šåŠ¡ç¨‹åº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//æ³¨æ„ï¼š &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å¦‚æœç­¾çº¦çš„æ˜¯å¯é€€æ¬¾åè®®ï¼Œé‚£ä¹ˆä»˜æ¬¾å®Œæˆåï¼Œæ”¯ä»˜å®ç³»ç»Ÿå‘é€è¯¥äº¤æ˜“çŠ¶æ€é€šçŸ¥ã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        response.getWriter().write(&lt;span class=&#34;string&#34;&gt;&amp;quot;success&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        response.getWriter().write(&lt;span class=&#34;string&#34;&gt;&amp;quot;fail&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€šçŸ¥æ¥å£æ¸¬è©¦&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£é‡å•Ÿè¨‚å–®æœå‹™ï¼Œä¸¦åœ¨æ¥æ”¶é€šçŸ¥æ¥å£ä¸­æ‰“ä¸Šæ–·é»&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£é…ç½®å…§éƒ¨ç¶²è·¯ç©¿é€çš„æœ¬åœ°ç«¯å£ç‚ºè¨‚å–®æœå‹™ç«¯å£ï¼Œå•Ÿå‹•å…§éƒ¨ç¶²è·¯ç©¿é€å®¢æˆ¶ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£æ‰“é–‹æ¨¡æ“¬å™¨ã€æ”¯ä»˜å¯¶æ²™ç®±ï¼Œæƒç¢¼ã€ä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£è§€å¯Ÿæ¥æ”¶è¨‚å–®æ”¯ä»˜è³‡æ–™ç­‰æ˜¯å¦æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;é€™é‡ŒæˆåŠŸé€²å…¥åˆ°äº†é€šçŸ¥æ¥å£&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/4.png&#34; class=&#34;abc&#34;&gt;
&lt;h1 id=&#34;ç”Ÿæˆæ”¯ä»˜äºŒç¶­ç¢¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç”Ÿæˆæ”¯ä»˜äºŒç¶­ç¢¼&#34;&gt;#&lt;/a&gt; ç”Ÿæˆæ”¯ä»˜äºŒç¶­ç¢¼&lt;/h1&gt;
&lt;h2 id=&#34;åŸ·è¡Œæµç¨‹-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åŸ·è¡Œæµç¨‹-2&#34;&gt;#&lt;/a&gt; åŸ·è¡Œæµç¨‹&lt;/h2&gt;
&lt;p&gt;é»é¸ã€Œæ”¯ä»˜å¯¶æ”¯ä»˜ã€æ­¤æ™‚é–‹å•Ÿæ”¯ä»˜äºŒç¶­ç¢¼ï¼Œç”¨æˆ¶æƒç¢¼æ”¯ä»˜ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/5.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;åŸ·è¡Œæµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1. å‰ç«¯èª¿ç”¨å­¸ç¿’ä¸­å¿ƒæœå‹™çš„æ–°å¢é¸èª²æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;2. æ–°å¢é¸èª²æˆåŠŸè«‹æ±‚è¨‚å–®æœå‹™ç”¢ç”Ÿæ”¯ä»˜äºŒç¶­ç¢¼æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;3. ç”¢ç”ŸäºŒç¶­ç¢¼æ¥å£ï¼šå»ºç«‹å•†å“è¨‚å–®ã€ç”¢ç”Ÿæ”¯ä»˜äº¤æ˜“è¨˜éŒ„ã€ç”¢ç”ŸäºŒç¶­ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;4. å°‡äºŒç¶­ç¢¼è¿”å›å‰ç«¯ï¼Œç”¨æˆ¶æƒç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è€…æƒç¢¼æ”¯ä»˜æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/6.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1. ç”¨æˆ¶è¼¸å…¥æ”¯ä»˜å¯†ç¢¼ï¼Œä»˜æ¬¾æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ¥æ”¶ç¬¬ä¸‰æ–¹å¹³å°é€šçŸ¥çš„ä»˜æ¬¾çµæœã€‚&lt;/p&gt;
&lt;p&gt;3ã€æ ¹æ“šæ”¯ä»˜çµæœæ›´æ–°æ”¯ä»˜äº¤æ˜“è¨˜éŒ„çš„æ”¯ä»˜ç‹€æ…‹ç‚ºæ”¯ä»˜æˆåŠŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•¸æ“šæ¨¡å‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ•¸æ“šæ¨¡å‹&#34;&gt;#&lt;/a&gt; æ•¸æ“šæ¨¡å‹&lt;/h2&gt;
&lt;p&gt;è¨‚å–®æ”¯ä»˜æ¨¡å¼çš„æ ¸å¿ƒç”±ä¸‰å¼µè¡¨çµ„æˆï¼šè¨‚å–®è¡¨ã€è¨‚å–®æ˜ç´°è¡¨ã€æ”¯ä»˜äº¤æ˜“è¨˜éŒ„è¡¨ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/7.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;è¨‚å–®è™Ÿç¢¼æ³¨æ„å”¯ä¸€æ€§ã€å®‰å…¨æ€§ã€ç›¡é‡çŸ­ç­‰ç‰¹é»ï¼Œç”Ÿæˆæ–¹æ¡ˆå¸¸ç”¨çš„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1. æ™‚é–“æˆ³ + éš¨æ©Ÿæ•¸&lt;/p&gt;
&lt;p&gt;å¹´æœˆæ—¥æ™‚åˆ†ç§’æ¯«ç§’ + éš¨æ©Ÿæ•¸&lt;/p&gt;
&lt;p&gt;2ã€é«˜ä¸¦ç™¼å ´æ™¯&lt;/p&gt;
&lt;p&gt;å¹´æœˆæ—¥æ™‚åˆ†ç§’æ¯«ç§’ + éš¨æ©Ÿæ•¸ + redis è‡ªå¢åºåˆ—&lt;/p&gt;
&lt;p&gt;3. è¨‚å–®è™Ÿç¢¼ä¸­åŠ ä¸Šæ¥­å‹™æ¨™è­˜&lt;/p&gt;
&lt;p&gt;è¨‚å–®è™Ÿç¢¼åŠ ä¸Šæ¥­å‹™è­˜åˆ¥æ–¹ä¾¿å®¢æœï¼Œä¾‹å¦‚ï¼šç¬¬ 10 ä½æ˜¯æ¥­å‹™é¡å‹ï¼Œç¬¬ 11 ä½æ˜¯ä½¿ç”¨è€…é¡å‹ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;4ã€é›ªèŠ±æ¼”ç®—æ³•&lt;/p&gt;
&lt;p&gt;é›ªèŠ±æ¼”ç®—æ³•æ˜¯æ¨ç‰¹å…§éƒ¨ä½¿ç”¨çš„åˆ†æ•£å¼ç’°å¢ƒä¸‹çš„å”¯ä¸€ ID ç”Ÿæˆæ¼”ç®—æ³•ï¼Œå®ƒåŸºæ–¼æ™‚é–“æˆ³ç”Ÿæˆï¼Œä¿è­‰æœ‰åºéå¢ï¼ŒåŠ ä»¥å…¥é›»è…¦ç¡¬é«”ç­‰å…ƒç´ ï¼Œå¯ä»¥æ»¿è¶³é«˜ä¸¦ç™¼ç’°å¢ƒä¸‹ ID ä¸é‡è¤‡ã€‚&lt;br&gt;
æœ¬é …ç›®è¨‚å–®ç·¨è™Ÿç”¢ç”Ÿæ¡ç”¨é›ªèŠ±æ¼”ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬å°ˆæ¡ˆè¨‚å–®è™Ÿç¢¼ç”¢ç”Ÿç­–ç•¥æ¡ç”¨é›ªèŠ±æ¼”ç®—æ³•ï¼Œå°å…¥é»‘é¦¬æä¾›çš„ IdWorkerUtils.java åˆ° base å·¥ç¨‹çš„ utils åŒ…ä¸‹&lt;/p&gt;
&lt;h2 id=&#34;æ¥å£å®šç¾©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å£å®šç¾©&#34;&gt;#&lt;/a&gt; æ¥å£å®šç¾©&lt;/h2&gt;
&lt;p&gt;åœ¨è¨‚å–®æœå‹™ä¸­å®šç¾©ç”¢ç”Ÿæ”¯ä»˜äºŒç¶­ç¢¼æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;è«‹æ±‚ï¼šè¨‚å–®è¨Šæ¯&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Data&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ToString&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AddOrderDto&lt;/span&gt;  &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ€»ä»· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; Float totalPrice; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®¢å•ç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String orderType; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®¢å•åç§° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String orderName; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®¢å•æè¿° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String orderDescrip; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// è®¢å•æ˜ç»†jsonï¼Œä¸å¯ä¸ºç©º &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//[&amp;#123;&amp;quot;goodsId&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;goodsType&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;goodsName&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;goodsPrice&amp;quot;:&amp;quot;&amp;quot;,&amp;quot;goodsDetail&amp;quot;:&amp;quot;&amp;quot;&amp;#125;,&amp;#123;...&amp;#125;] &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String orderDetail; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å¤–éƒ¨ç³»ç»Ÿä¸šåŠ¡id &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String outBusinessId; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;éŸ¿æ‡‰ï¼šæ”¯ä»˜äº¤æ˜“è¨˜éŒ„è³‡è¨ŠåŠäºŒç¶­ç¢¼è¨Šæ¯&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Data&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ToString&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayRecordDto&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcPayRecord&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//äºŒç»´ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String qrcode; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥å£å®šç¾©å¦‚ä¸‹&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Api(value = &amp;quot;è®¢å•æ”¯ä»˜æ¥å£&amp;quot;, tags = &amp;quot;è®¢å•æ”¯ä»˜æ¥å£&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Controller&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OrderController&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;ç”Ÿæˆæ”¯ä»˜äºŒç»´ç &amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@PostMapping(&amp;quot;/generatepaycode&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@ResponseBody&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;generatePayCode&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@RequestBody&lt;/span&gt; AddOrderDto addOrderDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”¨æˆ·æ‰«ç è¯·æ±‚ä¸‹å•ï¼Œå®šä¹‰ä¸‹å•æ¥å£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;æ‰«ç ä¸‹å•æ¥å£&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/requestpay&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;requestpay&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo,HttpServletResponse httpResponse)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ¥å£å¯¦ç¾&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å£å¯¦ç¾&#34;&gt;#&lt;/a&gt; æ¥å£å¯¦ç¾&lt;/h2&gt;
&lt;p&gt;åœ¨å‰é¢çš„åˆ†æä¸­ï¼Œç”¢ç”Ÿæ”¯ä»˜äºŒç¶­ç¢¼æ“ä½œï¼Œå…¶ä¸­åŒ…å«äº†ä¸‰å€‹å°æ“ä½œ&lt;br&gt;
1ï¸âƒ£æ’å…¥è¨‚å–®è¨Šæ¯&lt;br&gt;
2ï¸âƒ£æ’å…¥ä»˜æ¬¾è¨˜éŒ„&lt;br&gt;
3ï¸âƒ£ç”¢ç”ŸäºŒç¶­ç¢¼è¿”å›&lt;br&gt;
ä¸‹é‚Šè¦åšçš„å°±æ˜¯å¯¦ç¾é€™ä¸‰å€‹æ¥å£&lt;/p&gt;
&lt;p&gt;å®šç¾©ä¿å­˜è¨‚å–®è³‡è¨Šæ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OrderService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@description&lt;/span&gt; åˆ›å»ºå•†å“è®¢å• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; addOrderDto è®¢å•ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; PayRecordDto æ”¯ä»˜äº¤æ˜“è®°å½•(åŒ…æ‹¬äºŒç»´ç ) &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@author&lt;/span&gt; Mr.M &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@date&lt;/span&gt; 2022/10/4 11:02 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;*/&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;createOrder&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String userId,AddOrderDto addOrderDto)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åœ¨ä¿å­˜è¨‚å–®æ¥å£ä¸­éœ€è¦å®Œæˆå»ºç«‹å•†å“è¨‚å–®ã€å»ºç«‹æ”¯ä»˜äº¤æ˜“è¨˜éŒ„ï¼Œæ¥å£å¯¦ä½œæ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OrderServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OrderService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcOrdersMapper ordersMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcOrdersGoodsMapper ordersGoodsMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcPayRecordMapper payRecordMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;createOrder&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String userId, AddOrderDto addOrderDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ·»åŠ å•†å“è®¢å• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ·»åŠ æ”¯ä»˜äº¤æ˜“è®°å½• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ç”ŸæˆäºŒç»´ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç·¨å¯«å»ºç«‹å•†å“è¨‚å–®æ–¹æ³•ï¼Œå•†å“è¨‚å–®çš„è³‡æ–™ä¾†è‡ªé¸èª²è¨˜éŒ„ï¼Œåœ¨è¨‚å–®è¡¨éœ€è¦å­˜å…¥é¸èª²è¨˜éŒ„çš„ IDï¼Œé€™è£¡éœ€è¦ä½œå¥½å†ªç­‰è™•ç†ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcOrders &lt;span class=&#34;title function_&#34;&gt;saveOrders&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String userId, AddOrderDto addOrderDto)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 1. å¹‚ç­‰æ€§åˆ¤æ–­&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcOrders&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;order&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getOrderByBusinessId(addOrderDto.getOutBusinessId());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (order != &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; order;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 2. æ’å…¥è®¢å•è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    order = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcOrders&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    BeanUtils.copyProperties(addOrderDto, order);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    order.setId(IdWorkerUtils.getInstance().nextId());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    order.setCreateDate(LocalDateTime.now());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    order.setUserId(userId);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    order.setStatus(&lt;span class=&#34;string&#34;&gt;&amp;quot;600001&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;insert&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcOrdersMapper.insert(order);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (insert &amp;lt;= &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ’å…¥è®¢å•è®°å½•å¤±è´¥&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 3. æ’å…¥è®¢å•æ˜ç»†è¡¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orderId&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; order.getId();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orderDetail&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; addOrderDto.getOrderDetail();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    List&amp;lt;XcOrdersGoods&amp;gt; xcOrdersGoodsList = JSON.parseArray(orderDetail, XcOrdersGoods.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcOrdersGoodsList.forEach(goods -&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        goods.setOrderId(orderId);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;insert1&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcOrdersGoodsMapper.insert(goods);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (insert1 &amp;lt;= &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ’å…¥è®¢å•æ˜ç»†å¤±è´¥&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; order;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//æ ¹æ®ä¸šåŠ¡idæŸ¥è¯¢è®¢å• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcOrders &lt;span class=&#34;title function_&#34;&gt;getOrderByBusinessId&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String businessId)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcOrders&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orders&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ordersMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcOrders&amp;gt;().eq(XcOrders::getOutBusinessId, businessId)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; orders; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å»ºç«‹æ”¯ä»˜äº¤æ˜“è¨˜éŒ„&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å»ºç«‹æ”¯ä»˜äº¤æ˜“è¨˜éŒ„&#34;&gt;#&lt;/a&gt; å»ºç«‹æ”¯ä»˜äº¤æ˜“è¨˜éŒ„&lt;/h2&gt;
&lt;p&gt;&lt;span class=&#34;red&#34;&gt;ç‚ºä»€éº¼è¦å‰µå»ºæ”¯ä»˜äº¤æ˜“è¨˜éŒ„ï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;åœ¨è«‹æ±‚å¾®ä¿¡æˆ–æ”¯ä»˜å¯¶ä¸‹å–®æ¥å£æ™‚éœ€è¦å‚³å…¥å•†å“è¨‚å–®è™Ÿï¼Œåœ¨èˆ‡ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°å°æ¥æ™‚ç™¼ç¾ï¼Œç•¶ç”¨æˆ¶æ”¯ä»˜å¤±æ•—æˆ–å› ç‚ºå…¶å®ƒåŸå› æœ€çµ‚è©²è¨‚å–®æ²’æœ‰æ”¯ä»˜æˆåŠŸï¼Œæ­¤æ™‚å†æ¬¡èª¿ç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„ ä¸‹å–®æ¥å£ç™¼ç¾å ±éŒ¯ â€œè¨‚å–®è™Ÿç¢¼å·²å­˜åœ¨â€ï¼Œæ­¤æ™‚å¦‚æœæˆ‘å€‘å‚³å…¥ä¸€å€‹æ²’æœ‰ä½¿ç”¨éçš„è¨‚å–®è™Ÿç¢¼å°±å¯ä»¥è§£æ±ºå•é¡Œï¼Œä½†æ˜¯å•†å“è¨‚å–®å·²ç¶“å‰µå»ºï¼Œå› ç‚ºæ²’æœ‰æ”¯ä»˜æˆåŠŸé‡æ–°å‰µå»ºä¸€å€‹æ–°è¨‚å–®æ˜¯ä¸åˆç†çš„ã€‚&lt;/p&gt;
&lt;p&gt;è§£æ±ºä»¥ä¸Šå•é¡Œçš„æ–¹æ¡ˆæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ç”¨æˆ¶æ¯æ¬¡ç™¼èµ·éƒ½å»ºç«‹ä¸€å€‹æ–°çš„æ”¯ä»˜äº¤æ˜“è¨˜éŒ„ ï¼Œæ­¤äº¤æ˜“è¨˜éŒ„èˆ‡å•†å“è¨‚å–®é—œè¯ã€‚&lt;/p&gt;
&lt;p&gt;2ã€å°‡æ”¯ä»˜äº¤æ˜“è¨˜éŒ„çš„æµæ°´è™Ÿå‚³çµ¦ç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»çµ±ä¸‹å–®æ¥å£ï¼Œé€™æ¨£å°±å³ä½¿æ²’æœ‰æ”¯ä»˜æˆåŠŸå°±ä¸æœƒå‡ºç¾ä¸Šé‚Šçš„å•é¡Œã€‚&lt;/p&gt;
&lt;p&gt;3ã€éœ€è¦æé†’ç”¨æˆ¶ä¸è¦é‡è¤‡ä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç·¨å¯«å»ºç«‹æ”¯ä»˜äº¤æ˜“è¨˜éŒ„çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcPayRecord &lt;span class=&#34;title function_&#34;&gt;createPayRecord&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(XcOrders orders)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(order==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¢å•ä¸å­˜åœ¨&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(orders.getStatus().equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;600002&amp;quot;&lt;/span&gt;))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¢å•å·²æ”¯ä»˜&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcPayRecord&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ç”Ÿæˆæ”¯ä»˜äº¤æ˜“æµæ°´å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payNo&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; IdWorkerUtils.getInstance().nextId(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setPayNo(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setOrderId(orders.getId());&lt;span class=&#34;comment&#34;&gt;//å•†å“è®¢å•å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setOrderName(orders.getOrderName()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setTotalPrice(orders.getTotalPrice()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setCurrency(&lt;span class=&#34;string&#34;&gt;&amp;quot;CNY&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setCreateDate(LocalDateTime.now()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setStatus(&lt;span class=&#34;string&#34;&gt;&amp;quot;601001&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//æœªæ”¯ä»˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord.setUserId(orders.getUserId()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecordMapper.insert(payRecord); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payRecord; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç”¢æˆæ”¯ä»˜äºŒç¶­ç¢¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç”¢æˆæ”¯ä»˜äºŒç¶­ç¢¼&#34;&gt;#&lt;/a&gt; ç”¢æˆæ”¯ä»˜äºŒç¶­ç¢¼&lt;/h2&gt;
&lt;p&gt;1ã€åœ¨ nacos ä¸­ orders-service-dev.yaml é…ç½®äºŒç¶­ç¢¼çš„ url&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;pay:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;attr&#34;&gt;qrcodeurl:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;http://192.168.101.1/api/orders/requestpay?payNo=%s&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ã€ç”¨ format æ‹¼æ¥æ”¯ä»˜ URL, å®Œå–„å»ºç«‹è¨‚å–® service æ–¹æ³•:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.qrcodeurl&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String qrcodeurl; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;createOrder&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String userId, AddOrderDto addOrderDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//åˆ›å»ºå•†å“è®¢å• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcOrders&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orders&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; saveXcOrders(userId, addOrderDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(orders==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¢å•åˆ›å»ºå¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(orders.getStatus().equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;600002&amp;quot;&lt;/span&gt;))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¢å•å·²æ”¯ä»˜&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ç”Ÿæˆæ”¯ä»˜è®°å½• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; createPayRecord(orders); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ç”ŸæˆäºŒç»´ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;qrCode&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//urlè¦å¯ä»¥è¢«æ¨¡æ‹Ÿå™¨è®¿é—®åˆ°ï¼Œurlä¸ºä¸‹å•æ¥å£(ç¨åå®šä¹‰) &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; String.format(qrcodeurl, payRecord.getPayNo()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        qrCode = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;QRCodeUtil&lt;/span&gt;().createQRCode(url, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;, &lt;span class=&#34;number&#34;&gt;200&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (IOException e) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;ç”ŸæˆäºŒç»´ç å‡ºé”™&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PayRecordDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecordDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayRecordDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    BeanUtils.copyProperties(payRecord,payRecordDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecordDto.setQrcode(qrCode); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payRecordDto; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç”ŸæˆäºŒç¶­ç¢¼æ¥å£å®Œå–„&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç”ŸæˆäºŒç¶­ç¢¼æ¥å£å®Œå–„&#34;&gt;#&lt;/a&gt; ç”ŸæˆäºŒç¶­ç¢¼æ¥å£å®Œå–„&lt;/h2&gt;
&lt;p&gt;å®Œå–„ç”Ÿæˆæ”¯ä»˜äºŒç»´ç  controller æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;OrderService orderService; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;ç”Ÿæˆæ”¯ä»˜äºŒç»´ç &amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@PostMapping(&amp;quot;/generatepaycode&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ResponseBody&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;generatePayCode&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@RequestBody&lt;/span&gt; AddOrderDto addOrderDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ç™»å½•ç”¨æˆ· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    SecurityUtil.&lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; SecurityUtil.getUser(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(user == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·ç™»å½•åç»§ç»­é€‰è¯¾&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; orderService.createOrder(user.getId(), addOrderDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆäº†æ”¯ä»˜äºŒç¶­ç¢¼ï¼Œç”¨æˆ¶æƒç¢¼è«‹æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ä¸‹å–®ã€ä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;1. å®šç¾©æŸ¥è©¢æ”¯ä»˜äº¤æ˜“è¨˜éŒ„çš„ Service æ¥å£èˆ‡å¯¦ä½œæ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcPayRecord &lt;span class=&#34;title function_&#34;&gt;getPayRecordByPayno&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¦ç¾å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcPayRecord &lt;span class=&#34;title function_&#34;&gt;getPayRecordByPayno&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcPayRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecordMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcPayRecord&amp;gt;().eq(XcPayRecord::getPayNo, payNo)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcPayRecord; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2 å®šç¾©ä¸‹å–®æ¥å£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_ID&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String APP_ID; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.APP_PRIVATE_KEY&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String APP_PRIVATE_KEY; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;pay.alipay.ALIPAY_PUBLIC_KEY&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String ALIPAY_PUBLIC_KEY; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;æ‰«ç ä¸‹å•æ¥å£&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/requestpay&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;requestpay&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo,HttpServletResponse httpResponse)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å¦‚æœpayNoä¸å­˜åœ¨åˆ™æç¤ºé‡æ–°å‘èµ·æ”¯ä»˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; orderService.getPayRecordByPayno(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(payRecord == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·é‡æ–°ç‚¹å‡»æ”¯ä»˜è·å–äºŒç»´ç &amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜çŠ¶æ€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecord.getStatus(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;601002&amp;quot;&lt;/span&gt;.equals(status))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ”¯ä»˜ã€‚&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ„é€ sdkçš„å®¢æˆ·ç«¯å¯¹è±¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;client&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultAlipayClient&lt;/span&gt;(AlipayConfig.URL, APP_ID, APP_PRIVATE_KEY, AlipayConfig.FORMAT, AlipayConfig.CHARSET, ALIPAY_PUBLIC_KEY, AlipayConfig.SIGNTYPE);&lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayRequest&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeWapPayRequest&lt;/span&gt;();&lt;span class=&#34;comment&#34;&gt;//åˆ›å»ºAPIå¯¹åº”çš„request &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        alipayRequest.setReturnUrl(&amp;quot;http://domain.com/CallBack/return_url.jsp&amp;quot;); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        alipayRequest.setNotifyUrl(&amp;quot;http://tjxt-user-t.itheima.net/xuecheng/orders/paynotify&amp;quot;);//åœ¨å…¬å…±å‚æ•°ä¸­è®¾ç½®å›è·³å’Œé€šçŸ¥åœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        alipayRequest.setBizContent(&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;#123;&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot; \&amp;quot;out_trade_no\&amp;quot;:\&amp;quot;&amp;quot;&lt;/span&gt;+payRecord.getPayNo()+&lt;span class=&#34;string&#34;&gt;&amp;quot;\&amp;quot;,&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot; \&amp;quot;total_amount\&amp;quot;:\&amp;quot;&amp;quot;&lt;/span&gt;+payRecord.getTotalPrice()+&lt;span class=&#34;string&#34;&gt;&amp;quot;\&amp;quot;,&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot; \&amp;quot;subject\&amp;quot;:\&amp;quot;&amp;quot;&lt;/span&gt;+payRecord.getOrderName()+&lt;span class=&#34;string&#34;&gt;&amp;quot;\&amp;quot;,&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot; \&amp;quot;product_code\&amp;quot;:\&amp;quot;QUICK_WAP_PAY\&amp;quot;&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;string&#34;&gt;&amp;quot; &amp;#125;&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//å¡«å……ä¸šåŠ¡å‚æ•° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;form&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//è¯·æ±‚æ”¯ä»˜å®ä¸‹å•æ¥å£,å‘èµ·httpè¯·æ±‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            form = client.pageExecute(alipayRequest).getBody(); &lt;span class=&#34;comment&#34;&gt;//è°ƒç”¨SDKç”Ÿæˆè¡¨å• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (AlipayApiException e) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            e.printStackTrace(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.setContentType(&lt;span class=&#34;string&#34;&gt;&amp;quot;text/html;charset=&amp;quot;&lt;/span&gt; + AlipayConfig.CHARSET); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.getWriter().write(form);&lt;span class=&#34;comment&#34;&gt;//ç›´æ¥å°†å®Œæ•´çš„è¡¨å•htmlè¾“å‡ºåˆ°é¡µé¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.getWriter().flush(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        httpResponse.getWriter().close(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ”¯ä»˜æ¸¬è©¦&lt;br&gt;
æ¸¬è©¦æº–å‚™ï¼š&lt;/p&gt;
&lt;p&gt;1ã€å•Ÿå‹•ç¶²é—œæœå‹™ã€èªè­‰æœå‹™ã€é©—è­‰ç¢¼æœå‹™ã€å­¸ç¿’ä¸­å¿ƒæœå‹™ã€è¨‚å–®æœå‹™ã€å…§å®¹ç®¡ç†æœå‹™ã€‚&lt;/p&gt;
&lt;p&gt;2ã€ç™¼å¸ƒä¸€é–€æ”¶è²»èª²ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;3. ä½¿ç”¨è³‡æ–™ç›®éŒ„ä¸­çš„æ–°æ¨¡æ¿ course_template.ftl&lt;/p&gt;
&lt;p&gt;æ¸¬è©¦æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1. é€²å…¥æ”¶è²»èª²ç¨‹è©³ç´°é é¢ï¼Œé»é¸é¦¬ä¸Šå­¸ç¿’ã€‚&lt;/p&gt;
&lt;p&gt;2. è¿½è¹¤ç€è¦½å™¨åŠå¾®æœå‹™ï¼Œè§€å¯Ÿé¸èª²è¨˜éŒ„æ˜¯å¦å‰µå»ºæˆåŠŸã€å•†å“è¨‚å–®æ˜¯å¦å‰µå»ºæˆåŠŸã€æ”¯ä»˜äº¤æ˜“è¨˜éŒ„æ˜¯å¦å‰µå»ºæˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;3. è§€å¯Ÿç”¢ç”ŸäºŒç¶­ç¢¼æ˜¯å¦æˆåŠŸ&lt;/p&gt;
&lt;p&gt;4. ä½¿ç”¨æ¨¡æ“¬å™¨æƒç¢¼æ¸¬è©¦ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸ä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŸ¥è©¢ä»˜æ¬¾çµæœ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æŸ¥è©¢ä»˜æ¬¾çµæœ&#34;&gt;#&lt;/a&gt; æŸ¥è©¢ä»˜æ¬¾çµæœ&lt;/h2&gt;
&lt;p&gt;æ¥å£å®šä¹‰:&lt;/p&gt;
&lt;p&gt;æ ¹æ“šå‰é‚Šæˆ‘å€‘èª¿æŸ¥çš„ç²å–æ”¯ä»˜çµæœçš„æ¥å£ï¼ŒåŒ…æ‹¬ï¼šä¸»å‹•æŸ¥è©¢æ”¯ä»˜çµæœã€è¢«å‹•æ¥æ”¶æ”¯ä»˜çµæœã€‚&lt;br&gt;
é€™è£¡å…ˆå¯¦ç¾ä¸»å‹•æŸ¥è©¢æ”¯ä»˜çµæœï¼Œç•¶æ”¯ä»˜å®Œæˆç”¨æˆ¶é»æ“Šã€Œæ”¯ä»˜çµæœã€å°‡è«‹æ±‚ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°æŸ¥è©¢æ”¯ä»˜çµæœã€‚&lt;br&gt;
åœ¨ OrderController é¡åˆ¥ä¸­å®šç¾©æ¥å£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;æŸ¥è¯¢æ”¯ä»˜ç»“æœ&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/payresult&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ResponseBody&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;payresult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1ã€å®šç¾©æŸ¥è©¢æ”¯ä»˜çµæœçš„ service&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; payNo æ”¯ä»˜è®°å½•id &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; æ”¯ä»˜è®°å½•ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;queryPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ã€service å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;queryPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getPayRecordByPayno(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (payRecord == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·é‡æ–°ç‚¹å‡»æ”¯ä»˜è·å–äºŒç»´ç &amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜çŠ¶æ€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecord.getStatus(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæ”¯ä»˜æˆåŠŸç›´æ¥è¿”å› &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;string&#34;&gt;&amp;quot;601002&amp;quot;&lt;/span&gt;.equals(status)) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;PayRecordDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecordDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayRecordDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        BeanUtils.copyProperties(payRecord, payRecordDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payRecordDto; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ä»æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PayStatusDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payStatusDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; queryPayResultFromAlipay(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ä¿å­˜æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    currentProxy.saveAliPayStatus( payStatusDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//é‡æ–°æŸ¥è¯¢æ”¯ä»˜è®°å½• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payRecord = getPayRecordByPayno(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PayRecordDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecordDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayRecordDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    BeanUtils.copyProperties(payRecord, payRecordDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payRecordDto; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®šä¹‰ä»æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœçš„æ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayStatusDto &lt;span class=&#34;title function_&#34;&gt;queryPayResultFromAlipay&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//========è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœ============= &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayClient&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipayClient&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultAlipayClient&lt;/span&gt;(AlipayConfig.URL, APP_ID, APP_PRIVATE_KEY, &lt;span class=&#34;string&#34;&gt;&amp;quot;json&amp;quot;&lt;/span&gt;, AlipayConfig.CHARSET, ALIPAY_PUBLIC_KEY, AlipayConfig.SIGNTYPE); &lt;span class=&#34;comment&#34;&gt;//è·å¾—åˆå§‹åŒ–çš„AlipayClient &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayTradeQueryRequest&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;request&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AlipayTradeQueryRequest&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;JSONObject&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;bizContent&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;JSONObject&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    bizContent.put(&lt;span class=&#34;string&#34;&gt;&amp;quot;out_trade_no&amp;quot;&lt;/span&gt;, payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    request.setBizContent(bizContent.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;AlipayTradeQueryResponse&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        response = alipayClient.execute(request); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!response.isSuccess()) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·æ±‚æ”¯ä»˜æŸ¥è¯¢æŸ¥è¯¢å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (AlipayApiException e) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·æ±‚æ”¯ä»˜å®æŸ¥è¯¢æ”¯ä»˜ç»“æœå¼‚å¸¸:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, e.toString(), e); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;è¯·æ±‚æ”¯ä»˜æŸ¥è¯¢æŸ¥è¯¢å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è·å–æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;resultJson&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; response.getBody(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è½¬map &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;resultMap&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(resultJson, Map.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;alipay_trade_query_response&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (Map) resultMap.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;alipay_trade_query_response&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) alipay_trade_query_response.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_status&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;total_amount&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) alipay_trade_query_response.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;total_amount&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_no&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) alipay_trade_query_response.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_no&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ä¿å­˜æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PayStatusDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payStatusDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayStatusDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payStatusDto.setOut_trade_no(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payStatusDto.setTrade_status(trade_status); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payStatusDto.setApp_id(APP_ID); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payStatusDto.setTrade_no(trade_no); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    payStatusDto.setTotal_amount(total_amount); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payStatusDto; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1ã€å®šä¹‰ä¿å­˜æ”¯ä»˜ç»“æœçš„æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;saveAliPayStatus&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(PayStatusDto payStatusDto)&lt;/span&gt; ;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ã€ç¼–å†™æ¥å£å®ç°&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;saveAliPayStatus&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(PayStatusDto payStatusDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜æµæ°´å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payNo&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payStatusDto.getOut_trade_no(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getPayRecordByPayno(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (payRecord == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ”¯ä»˜è®°å½•æ‰¾ä¸åˆ°&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payStatusDto.getTrade_status(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ”¶åˆ°æ”¯ä»˜ç»“æœ:&amp;#123;&amp;#125;,æ”¯ä»˜è®°å½•:&amp;#123;&amp;#125;&amp;#125;&amp;quot;&lt;/span&gt;, payStatusDto.toString(),payRecord.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (trade_status.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;TRADE_SUCCESS&amp;quot;&lt;/span&gt;)) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜é‡‘é¢å˜ä¸ºåˆ† &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Float&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;totalPrice&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecord.getTotalPrice() * &lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Float&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;total_amount&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; Float.parseFloat(payStatusDto.getTotal_amount()) * &lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ ¡éªŒæ˜¯å¦ä¸€è‡´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!payStatusDto.getApp_id().equals(APP_ID) || totalPrice.intValue() != total_amount.intValue()) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//æ ¡éªŒå¤±è´¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ ¡éªŒæ”¯ä»˜ç»“æœå¤±è´¥,æ”¯ä»˜è®°å½•:&amp;#123;&amp;#125;,APP_ID:&amp;#123;&amp;#125;,totalPrice:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt; ,payRecord.toString(),payStatusDto.getApp_id(),total_amount.intValue()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ ¡éªŒæ”¯ä»˜ç»“æœå¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°æ”¯ä»˜ç»“æœ,æ”¯ä»˜äº¤æ˜“æµæ°´å·:&amp;#123;&amp;#125;,æ”¯ä»˜ç»“æœ:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, payNo, trade_status); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcPayRecord&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecord_u&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcPayRecord&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        payRecord_u.setStatus(&lt;span class=&#34;string&#34;&gt;&amp;quot;601002&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        payRecord_u.setOutPayChannel(&lt;span class=&#34;string&#34;&gt;&amp;quot;Alipay&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        payRecord_u.setOutPayNo(payStatusDto.getTrade_no());&lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜å®äº¤æ˜“å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        payRecord_u.setPaySuccessTime(LocalDateTime.now());&lt;span class=&#34;comment&#34;&gt;//é€šçŸ¥æ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;update1&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecordMapper.update(payRecord_u, &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcPayRecord&amp;gt;().eq(XcPayRecord::getPayNo, payNo)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (update1 &amp;gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€æˆåŠŸ:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, payRecord_u.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€å¤±è´¥:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, payRecord_u.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°æ”¯ä»˜è®°å½•çŠ¶æ€å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å…³è”çš„è®¢å•å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orderId&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; payRecord.getOrderId(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcOrders&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;orders&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ordersMapper.selectById(orderId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (orders == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ ¹æ®æ”¯ä»˜è®°å½•[&amp;#123;&amp;#125;&amp;#125;]æ‰¾ä¸åˆ°è®¢å•&amp;quot;&lt;/span&gt;, payRecord_u.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ ¹æ®æ”¯ä»˜è®°å½•æ‰¾ä¸åˆ°è®¢å•&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcOrders&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;order_u&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcOrders&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        order_u.setStatus(&lt;span class=&#34;string&#34;&gt;&amp;quot;600002&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;update&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; ordersMapper.update(order_u, &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcOrders&amp;gt;().eq(XcOrders::getId, orderId)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (update &amp;gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€æˆåŠŸ,è®¢å•å·:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, orderId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€å¤±è´¥,è®¢å•å·:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, orderId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ›´æ–°è®¢å•è¡¨çŠ¶æ€å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;æ¥å£æ¸¬è©¦-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å£æ¸¬è©¦-2&#34;&gt;#&lt;/a&gt; æ¥å£æ¸¬è©¦&lt;/h1&gt;
&lt;p&gt;1ã€å®Œå–„æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;æŸ¥è¯¢æ”¯ä»˜ç»“æœ&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/payresult&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ResponseBody&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PayRecordDto &lt;span class=&#34;title function_&#34;&gt;payresult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String payNo)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è°ƒç”¨æ”¯ä»˜å®æ¥å£æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PayRecordDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payRecordDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; orderService.queryPayResult(payNo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; payRecordDto; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å°å…¥é»‘é¦¬æä¾›çš„ LocalDateTimeConfig.java åˆ° base å·¥ç¨‹çš„ config åŒ…ä¸‹ï¼Œç”¨æ–¼è™•ç†å‰ç«¯ Long ç²¾åº¦éºå¤±çš„å•é¡Œï¼Œç„¶å¾Œä½¿ç”¨å‰å¾Œç«¯è¯èª¿&lt;/p&gt;
&lt;h2 id=&#34;æ¥æ”¶æ”¯ä»˜é€šçŸ¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥æ”¶æ”¯ä»˜é€šçŸ¥&#34;&gt;#&lt;/a&gt; æ¥æ”¶æ”¯ä»˜é€šçŸ¥&lt;/h2&gt;
&lt;p&gt;æ¥å£å®šä¹‰&lt;br&gt;
æ”¯ä»˜å®Œæˆåç¬¬ä¸‰æ–¹æ”¯ä»˜ç³»ç»Ÿä¼šä¸»åŠ¨é€šçŸ¥æ”¯ä»˜ç»“æœï¼Œè¦å®ç°ä¸»åŠ¨é€šçŸ¥éœ€è¦åœ¨è¯·æ±‚æ”¯ä»˜ç³»ç»Ÿä¸‹å•æ—¶ä¼ å…¥ NotifyUrlï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ª urlï¼šNotifyUrl å’Œ ReturnUrlï¼ŒReturnUrl æ˜¯æ”¯ä»˜å®Œæˆåæ”¯ä»˜ç³»ç»Ÿæºå¸¦æ”¯ä»˜ç»“æœé‡å®šå‘åˆ° ReturnUrl åœ°å€ï¼ŒNotifyUrl æ˜¯æ”¯ä»˜å®Œæˆåæ”¯ä»˜ç³»ç»Ÿåœ¨åå°å®šæ—¶å»é€šçŸ¥ï¼Œä½¿ç”¨ NotifyUrl æ¯”ä½¿ç”¨ ReturnUrl æœ‰ä¿è¯ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ¥å£æè¿°ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuZG9jcy5hbGlwYXkuY29tL29wZW4vMjAzLzEwNTI4NiVFNyU5QSU4NCVFNSU4NiU4NSVFNSVBRSVCOSVFNCVCOCU4QiVFOCVCRSVCOSVFNSU5QyVBOCVFOCVBRSVBMiVFNSU4RCU5NSVFNiU5QyU4RCVFNSU4QSVBMSVFNSVBRSU5QSVFNCVCOSU4OSVFNiU4RSVBNSVFNiU5NCVCNiVFNiU5NCVBRiVFNCVCQiU5OCVFNyVCQiU5MyVFNiU5RSU5QyVFOSU4MCU5QSVFNyU5RiVBNSVFNyU5QSU4NCVFNiU4RSVBNSVFNSU4RiVBMyVFMyU4MCU4Mg==&#34;&gt;https://opendocs.alipay.com/open/203/105286 çš„å†…å®¹ä¸‹è¾¹åœ¨è®¢å•æœåŠ¡å®šä¹‰æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥çš„æ¥å£ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåœ¨ä¸‹å•æ—¶æŒ‡å®š NotifyUrl:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;alipayRequest.setNotifyUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://tjxt-user-t.itheima.net/xuecheng/orders/receivenotify&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@PostMapping(&amp;quot;/receivenotify&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;receivenotify&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpServletRequest request)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UnsupportedEncodingException, AlipayApiException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String,String&amp;gt; params = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;HashMap&lt;/span&gt;&amp;lt;String,String&amp;gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;requestParams&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; request.getParameterMap(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;type&#34;&gt;Iterator&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;iter&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; requestParams.keySet().iterator(); iter.hasNext();) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) iter.next(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        String[] values = (String[]) requestParams.get(name); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;valueStr&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;; i &amp;lt; values.length; i++) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            valueStr = (i == values.length - &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;) ? valueStr + values[i] &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    : valueStr + values[i] + &lt;span class=&#34;string&#34;&gt;&amp;quot;,&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        params.put(name, valueStr); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//éªŒç­¾ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;verify_result&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; AlipaySignature.rsaCheckV1(params, ALIPAY_PUBLIC_KEY, AlipayConfig.CHARSET, &lt;span class=&#34;string&#34;&gt;&amp;quot;RSA2&amp;quot;&lt;/span&gt;);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(verify_result) &amp;#123;&lt;span class=&#34;comment&#34;&gt;//éªŒè¯æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å•†æˆ·è®¢å•å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;out_trade_no&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;out_trade_no&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜å®äº¤æ˜“å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_no&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_no&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//äº¤æ˜“çŠ¶æ€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;trade_status&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;trade_status&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//appid &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;app_id&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;app_id&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//total_amount &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;total_amount&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(request.getParameter(&lt;span class=&#34;string&#34;&gt;&amp;quot;total_amount&amp;quot;&lt;/span&gt;).getBytes(&lt;span class=&#34;string&#34;&gt;&amp;quot;ISO-8859-1&amp;quot;&lt;/span&gt;),&lt;span class=&#34;string&#34;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;);  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//äº¤æ˜“æˆåŠŸå¤„ç† &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (trade_status.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;TRADE_SUCCESS&amp;quot;&lt;/span&gt;)) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;PayStatusDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;payStatusDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayStatusDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            payStatusDto.setOut_trade_no(out_trade_no); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            payStatusDto.setTrade_status(trade_status); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            payStatusDto.setApp_id(app_id); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            payStatusDto.setTrade_no(trade_no); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            payStatusDto.setTotal_amount(total_amount); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           &lt;span class=&#34;comment&#34;&gt;//å¤„ç†é€»è¾‘ã€‚ã€‚ã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            orderService.saveAliPayStatus(payStatusDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¥å£æµ‹è¯•:&lt;/p&gt;
&lt;p&gt;1ã€å¯åŠ¨ç½‘å…³æœåŠ¡ã€è®¤è¯æœåŠ¡ã€éªŒè¯ç æœåŠ¡ã€å­¦ä¹ ä¸­å¿ƒæœåŠ¡ã€å†…å®¹ç®¡ç†æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;2ã€å‘å¸ƒä¸€é—¨æ”¶è´¹è¯¾ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;æµ‹è¯•æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1ã€å¯¹é€‰è¯¾è¿›è¡Œæ”¯ä»˜&lt;/p&gt;
&lt;p&gt;2ã€æ”¯ä»˜æˆåŠŸè·Ÿè¸ª service æ–¹æ³•çš„æ—¥å¿—ï¼Œæ”¯ä»˜æˆåŠŸéœ€è¦æ›´æ–°æ”¯ä»˜äº¤æ˜“è¡¨è®°å½•çš„çŠ¶æ€ã€é€šçŸ¥æ—¶é—´ã€æ”¯ä»˜å®äº¤æ˜“å·ã€æ”¯ä»˜æ¸ é“ (Alipay)&lt;/p&gt;
&lt;p&gt;æ”¯ä»˜æˆåŠŸæ›´æ–°è®¢å•è¡¨çš„çŠ¶æ€ä¸ºç©ºã€‚&lt;/p&gt;
&lt;h1 id=&#34;æ”¯ä»˜é€šçŸ¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯ä»˜é€šçŸ¥&#34;&gt;#&lt;/a&gt; æ”¯ä»˜é€šçŸ¥&lt;/h1&gt;
&lt;p&gt;è¨‚å–®æœå‹™ä½œç‚ºé€šç”¨æœå‹™åœ¨è¨‚å–®æ”¯ä»˜æˆåŠŸå¾Œéœ€è¦å°‡æ”¯ä»˜çµæœéåŒæ­¥é€šçŸ¥çµ¦å…¶å®ƒå¾®æœå‹™ã€‚&lt;br&gt;
ä¸‹åœ–ä½¿ç”¨äº†è¨Šæ¯éšŠåˆ—å®Œæˆæ”¯ä»˜çµæœé€šçŸ¥ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/pay/alipay/8.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;å­¸ç¿’ä¸­å¿ƒæœå‹™ï¼šæ”¶è²»èª²ç¨‹é¸èª²éœ€æ”¯ä»˜ï¼Œèˆ‡è¨‚å–®æœå‹™å°æ¥å®Œæˆæ”¯ä»˜ã€‚&lt;/p&gt;
&lt;p&gt;å­¸ç¿’è³‡æºæœå‹™ï¼šæ”¶è²»çš„å­¸ç¿’è³‡æ–™éœ€è¦è³¼è²·å¾Œä¸‹è¼‰ï¼Œèˆ‡è¨‚å–®æœå‹™å°æ¥å®Œæˆä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;è¨‚å–®æœå‹™å®Œæˆä»˜æ¬¾å¾Œå°‡ä»˜æ¬¾çµæœç™¼çµ¦æ¯ä¸€å€‹èˆ‡è¨‚å–®æœå‹™å°æ¥çš„å¾®æœå‹™ï¼Œè¨‚å–®æœå‹™å°‡è¨Šæ¯ç™¼çµ¦äº¤æ›æ©Ÿï¼Œç”±äº¤æ›æ©Ÿå»£æ’­è¨Šæ¯ï¼Œæ¯å€‹è¨‚é–±è¨Šæ¯çš„å¾®æœå‹™éƒ½å¯ä»¥æ¥æ”¶åˆ°æ”¯ä»˜çµæœ.&lt;/p&gt;
&lt;p&gt;å¾®æœå‹™æ”¶åˆ°ä»˜æ¬¾çµæœæœƒæ ¹æ“šè¨‚å–®çš„é¡å‹å»æ›´æ–°è‡ªå·±çš„æ¥­å‹™è³‡æ–™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æŠ€æœ¯æ–¹æ¡ˆ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æŠ€æœ¯æ–¹æ¡ˆ&#34;&gt;#&lt;/a&gt; æŠ€æœ¯æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨è¨Šæ¯éšŠåˆ—é€²è¡ŒéåŒæ­¥é€šçŸ¥éœ€è¦ä¿è­‰è¨Šæ¯çš„å¯é æ€§ï¼Œå³ç”Ÿç”¢ç«¯å°‡è¨Šæ¯æˆåŠŸé€šçŸ¥åˆ°æ¶ˆè²»ç«¯ã€‚&lt;br&gt;
è¨Šæ¯å¾ç”Ÿç”¢ç«¯ç™¼é€åˆ°æ¶ˆè²»ç«¯ç¶“æ­·ç­å¦‚ä¸‹éç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1ã€è¨Šæ¯ç™¼é€åˆ°äº¤æ›æ©Ÿ&lt;/p&gt;
&lt;p&gt;2ã€è¨Šæ¯ç”±äº¤æ›å™¨ç™¼é€åˆ°éšŠåˆ—&lt;/p&gt;
&lt;p&gt;3. è¨Šæ¯è€…æ”¶åˆ°è¨Šæ¯é€²è¡Œè™•ç†&lt;/p&gt;
&lt;p&gt;ä¿è­‰è¨Šæ¯çš„å¯é æ€§éœ€è¦ä¿è­‰ä»¥ä¸Šéç¨‹çš„å¯é æ€§ï¼Œæœ¬å°ˆæ¡ˆä½¿ç”¨ RabbitMQ å¯ä»¥é€éä»¥ä¸‹æ–¹é¢ä¿è­‰è¨Šæ¯çš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;1. ç”Ÿç”¢è€…ç¢ºèªæ©Ÿåˆ¶&lt;/p&gt;
&lt;p&gt;ç™¼é€è¨Šæ¯å‰ä½¿ç”¨è³‡æ–™åº«äº‹å‹™å°‡è¨Šæ¯ä¿è­‰åˆ°è³‡æ–™åº«è¡¨ä¸­&lt;br&gt;
æˆåŠŸå‚³é€åˆ°äº¤æ›å™¨å°‡è¨Šæ¯å¾è³‡æ–™åº«ä¸­åˆªé™¤&lt;/p&gt;
&lt;p&gt;2ã€mq æŒä¹…åŒ–&lt;/p&gt;
&lt;p&gt;mq æ”¶åˆ°è¨Šæ¯é€²è¡ŒæŒä¹…åŒ–ï¼Œç•¶ mq é‡å•Ÿå³ä½¿è¨Šæ¯æ²’æœ‰æ¶ˆè²»å®Œä¹Ÿä¸æœƒéºå¤±ã€‚&lt;br&gt;
éœ€è¦é…ç½®äº¤æ›å™¨æŒä¹…åŒ–ã€éšŠåˆ—æŒä¹…åŒ–ã€ç™¼é€è¨Šæ¯æ™‚è¨­å®šæŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;3. æ¶ˆè²»è€…ç¢ºèªæ©Ÿåˆ¶&lt;/p&gt;
&lt;p&gt;æ¶ˆè²»è€…æ¶ˆè²»æˆåŠŸè‡ªå‹•ç™¼é€ ackï¼Œå¦å‰‡é‡è©¦æ¶ˆè²»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¨‚å–®æœå‹™æ•´åˆmq&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#è¨‚å–®æœå‹™æ•´åˆmq&#34;&gt;#&lt;/a&gt; è¨‚å–®æœå‹™æ•´åˆ MQ&lt;/h2&gt;
&lt;p&gt;1. é¦–å…ˆåœ¨è¨‚å–®æœå‹™æ–°å¢è¨Šæ¯éšŠåˆ—ä¾è³´&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;XML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-amqp&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2. åœ¨ nacos é…ç½® rabbitmq-dev.yaml ç‚ºé€šç”¨é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spring:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;rabbitmq:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;host:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.101&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.65&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;5672&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;username:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;guest&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;password:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;guest&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;virtual-host:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;publisher-confirm-type:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;correlated&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#correlated å¼‚æ­¥å›è°ƒï¼Œå®šä¹‰ConfirmCallbackï¼ŒMQè¿”å›ç»“æœæ—¶ä¼šå›è°ƒè¿™ä¸ªConfirmCallback &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;publisher-returns:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#å¼€å¯publish-returnåŠŸèƒ½ï¼ŒåŒæ ·æ˜¯åŸºäºcallbackæœºåˆ¶ï¼Œéœ€è¦å®šä¹‰ReturnCallback &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;template:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;mandatory:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#å®šä¹‰æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„ç­–ç•¥ã€‚trueï¼Œåˆ™è°ƒç”¨ReturnCallbackï¼›falseï¼šåˆ™ç›´æ¥ä¸¢å¼ƒæ¶ˆæ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;listener:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;simple:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;acknowledge-mode:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;none&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#å‡ºç°å¼‚å¸¸æ—¶è¿”å›unackï¼Œæ¶ˆæ¯å›æ»šåˆ°mqï¼›æ²¡æœ‰å¼‚å¸¸ï¼Œè¿”å›ack ,manual:æ‰‹åŠ¨æ§åˆ¶,none:ä¸¢å¼ƒæ¶ˆæ¯ï¼Œä¸å›æ»šåˆ°mq &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;attr&#34;&gt;retry:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;enabled:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#å¼€å¯æ¶ˆè´¹è€…å¤±è´¥é‡è¯• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;initial-interval:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;1000ms&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#åˆè¯†çš„å¤±è´¥ç­‰å¾…æ—¶é•¿ä¸º1ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;multiplier:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#å¤±è´¥çš„ç­‰å¾…æ—¶é•¿å€æ•°ï¼Œä¸‹æ¬¡ç­‰å¾…æ—¶é•¿ = multiplier * last-interval &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;max-attempts:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#æœ€å¤§é‡è¯•æ¬¡æ•° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;attr&#34;&gt;stateless:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;#trueæ— çŠ¶æ€ï¼›falseæœ‰çŠ¶æ€ã€‚å¦‚æœä¸šåŠ¡ä¸­åŒ…å«äº‹åŠ¡ï¼Œè¿™é‡Œæ”¹ä¸ºfalse &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;`3. åœ¨è¨‚å–®æœå‹™éšŠåˆ—å·¥ç¨‹å¼•å…¥ rabbitmq-dev.yaml è¨­å®šæª”&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;shared-configs:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;data-id:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rabbitmq-$&amp;#123;spring.profiles.active&amp;#125;.yaml&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;group:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;xuecheng-plus-common&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;refresh:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;4. åœ¨è¨‚å–®æœå‹™ service å·¥ç¨‹ç·¨å¯« MQ é…ç½®é¡ï¼Œé…ç½®äº¤æ›æ©Ÿ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Configuration&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayNotifyConfig&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ApplicationContextAware&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//äº¤æ¢æœº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;PAYNOTIFY_EXCHANGE_FANOUT&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;paynotify_exchange_fanout&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜ç»“æœé€šçŸ¥æ¶ˆæ¯ç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;MESSAGE_TYPE&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;payresult_notify&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜é€šçŸ¥éšŠåˆ— &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;PAYNOTIFY_QUEUE&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;paynotify_queue&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å£°æ˜äº¤æ¢æœºï¼Œä¸”æŒä¹…åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean(PAYNOTIFY_EXCHANGE_FANOUT)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; FanoutExchange &lt;span class=&#34;title function_&#34;&gt;paynotify_exchange_fanout&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;FanoutExchange&lt;/span&gt;(PAYNOTIFY_EXCHANGE_FANOUT, &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;, &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜é€šçŸ¥éšŠåˆ—,ä¸”æŒä¹…åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean(PAYNOTIFY_QUEUE)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Queue &lt;span class=&#34;title function_&#34;&gt;course_publish_queue&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; QueueBuilder.durable(PAYNOTIFY_QUEUE).build(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//äº¤æ¢æœºå’Œæ”¯ä»˜é€šçŸ¥éšŠåˆ—ç»‘å®š &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Binding &lt;span class=&#34;title function_&#34;&gt;binding_course_publish_queue&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@Qualifier(PAYNOTIFY_QUEUE)&lt;/span&gt; Queue queue, &lt;span class=&#34;meta&#34;&gt;@Qualifier(PAYNOTIFY_EXCHANGE_FANOUT)&lt;/span&gt; FanoutExchange exchange)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; BindingBuilder.bind(queue).to(exchange); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;setApplicationContext&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(ApplicationContext applicationContext)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; BeansException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è·å–RabbitTemplate &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;RabbitTemplate&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;rabbitTemplate&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; applicationContext.getBean(RabbitTemplate.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ¶ˆæ¯å¤„ç†service &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;MqMessageService&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;mqMessageService&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; applicationContext.getBean(MqMessageService.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è®¾ç½®ReturnCallback &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        rabbitTemplate.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -&amp;gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;// æŠ•é€’å¤±è´¥ï¼Œè®°å½•æ—¥å¿— &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œåº”ç­”ç &amp;#123;&amp;#125;ï¼ŒåŸå› &amp;#123;&amp;#125;ï¼Œäº¤æ¢æœº&amp;#123;&amp;#125;ï¼Œè·¯ç”±é”®&amp;#123;&amp;#125;,æ¶ˆæ¯&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    replyCode, replyText, exchange, routingKey, message.toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;MqMessage&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;mqMessage&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(message.toString(), MqMessage.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å°†æ¶ˆæ¯å†æ·»åŠ åˆ°æ¶ˆæ¯è¡¨ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            mqMessageService.addMessage(mqMessage.getMessageType(),mqMessage.getBusinessKey1(),mqMessage.getBusinessKey2(),mqMessage.getBusinessKey3()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç™¼é€æ”¯ä»˜çµæœ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç™¼é€æ”¯ä»˜çµæœ&#34;&gt;#&lt;/a&gt; ç™¼é€æ”¯ä»˜çµæœ&lt;/h2&gt;
&lt;p&gt;åœ¨ OrderService ä¸­å®šä¹‰æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * å‘é€é€šçŸ¥ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; message &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;notifyPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(MqMessage message)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç·¨å¯«æ¥å£å¯¦ä½œæ–¹æ³•ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;notifyPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(MqMessage message)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//1ã€æ¶ˆæ¯ä½“ï¼Œè½¬json &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.toJSONString(message); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;Message&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;msgObj&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; MessageBuilder.withBody(msg.getBytes(StandardCharsets.UTF_8)) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            .setDeliveryMode(MessageDeliveryMode.PERSISTENT) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            .build(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 2.å…¨å±€å”¯ä¸€çš„æ¶ˆæ¯IDï¼Œéœ€è¦å°è£…åˆ°CorrelationDataä¸­ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;CorrelationData&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;correlationData&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CorrelationData&lt;/span&gt;(message.getId().toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// 3.æ·»åŠ callback &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    correlationData.getFuture().addCallback( &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            result -&amp;gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(result.isAck())&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;comment&#34;&gt;// 3.1.ackï¼Œæ¶ˆæ¯æˆåŠŸ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;é€šçŸ¥æ”¯ä»˜ç»“æœæ¶ˆæ¯å‘é€æˆåŠŸ, ID:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, correlationData.getId()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;comment&#34;&gt;//åˆ é™¤æ¶ˆæ¯è¡¨ä¸­çš„è®°å½• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    mqMessageService.completed(message.getId()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;comment&#34;&gt;// 3.2.nackï¼Œæ¶ˆæ¯å¤±è´¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;é€šçŸ¥æ”¯ä»˜ç»“æœæ¶ˆæ¯å‘é€å¤±è´¥, ID:&amp;#123;&amp;#125;, åŸå› &amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,correlationData.getId(), result.getReason()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            ex -&amp;gt; log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ¶ˆæ¯å‘é€å¼‚å¸¸, ID:&amp;#123;&amp;#125;, åŸå› &amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,correlationData.getId(),ex.getMessage()) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// å‘é€æ¶ˆæ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    rabbitTemplate.convertAndSend(PayNotifyConfig.PAYNOTIFY_EXCHANGE_FANOUT, &lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;quot;&lt;/span&gt;, msgObj,correlationData); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è®¢å•æœåŠ¡æ”¶åˆ°ç¬¬ä¸‰æ–¹å¹³å°çš„æ”¯ä»˜ç»“æœæ—¶ï¼Œåœ¨ saveAliPayStatus æ–¹æ³•ä¸­æ·»åŠ ä»£ç ï¼Œå‘æ•°æ®åº“æ¶ˆæ¯è¡¨æ·»åŠ æ¶ˆæ¯å¹¶è¿›è¡Œå‘é€æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;saveAliPayStatus&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(PayStatusDto payStatusDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ....... &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ä¿å­˜æ¶ˆæ¯è®°å½•,å‚æ•°1ï¼šæ”¯ä»˜ç»“æœé€šçŸ¥ç±»å‹ï¼Œ2: ä¸šåŠ¡idï¼Œ3:ä¸šåŠ¡ç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;MqMessage&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;mqMessage&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; mqMessageService.addMessage(&lt;span class=&#34;string&#34;&gt;&amp;quot;payresult_notify&amp;quot;&lt;/span&gt;, orders.getOutBusinessId(), orders.getOrderType(), &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//é€šçŸ¥æ¶ˆæ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        notifyPayResult(mqMessage); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é…ç½®äº¤æ¢æœºå’ŒéšŠåˆ—&lt;/p&gt;
&lt;p&gt;åœ¨ order-service å·¥ç¨‹é…ç½®&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯å‘é€æ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * å‘é€é€šçŸ¥ç»“æœ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; message &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;notifyPayResult&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(MqMessage message)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å­¸ç¿’ä¸­å¿ƒæœå‹™é›†æˆmq&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å­¸ç¿’ä¸­å¿ƒæœå‹™é›†æˆmq&#34;&gt;#&lt;/a&gt; å­¸ç¿’ä¸­å¿ƒæœå‹™é›†æˆ MQ&lt;/h2&gt;
&lt;p&gt;1ã€åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ·»åŠ æ¶ˆæ¯éšŠåˆ—ä¾èµ–&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;XML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-amqp&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ã€åœ¨å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ¥å£å·¥ç¨‹å¼•å…¥ rabbitmq-dev.yaml é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;shared-configs:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;attr&#34;&gt;data-id:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;rabbitmq-$&amp;#123;spring.profiles.active&amp;#125;.yaml&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;group:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;xuecheng-plus-common&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;refresh:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ã€æ·»åŠ é…ç½®ç±»&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Configuration&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PayNotifyConfig&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//äº¤æ¢æœº &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;PAYNOTIFY_EXCHANGE_FANOUT&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;paynotify_exchange_fanout&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜ç»“æœé€šçŸ¥æ¶ˆæ¯ç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;MESSAGE_TYPE&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;payresult_notify&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜é€šçŸ¥éšŠåˆ— &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;PAYNOTIFY_QUEUE&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;paynotify_queue&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å£°æ˜äº¤æ¢æœºï¼Œä¸”æŒä¹…åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean(PAYNOTIFY_EXCHANGE_FANOUT)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; FanoutExchange &lt;span class=&#34;title function_&#34;&gt;paynotify_exchange_fanout&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// ä¸‰ä¸ªå‚æ•°ï¼šäº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€å½“æ²¡æœ‰queueä¸å…¶ç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;FanoutExchange&lt;/span&gt;(PAYNOTIFY_EXCHANGE_FANOUT, &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;, &lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¯ä»˜é€šçŸ¥éšŠåˆ—,ä¸”æŒä¹…åŒ– &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean(PAYNOTIFY_QUEUE)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Queue &lt;span class=&#34;title function_&#34;&gt;course_publish_queue&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; QueueBuilder.durable(PAYNOTIFY_QUEUE).build(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//äº¤æ¢æœºå’Œæ”¯ä»˜é€šçŸ¥éšŠåˆ—ç»‘å®š &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Binding &lt;span class=&#34;title function_&#34;&gt;binding_course_publish_queue&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@Qualifier(PAYNOTIFY_QUEUE)&lt;/span&gt; Queue queue, &lt;span class=&#34;meta&#34;&gt;@Qualifier(PAYNOTIFY_EXCHANGE_FANOUT)&lt;/span&gt; FanoutExchange exchange)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; BindingBuilder.bind(queue).to(exchange); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ¥æ”¶æ”¯ä»˜ç»“æœ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥æ”¶æ”¯ä»˜ç»“æœ&#34;&gt;#&lt;/a&gt; æ¥æ”¶æ”¯ä»˜ç»“æœ&lt;/h2&gt;
&lt;p&gt;ç›‘å¬ MQï¼Œæ¥æ”¶æ”¯ä»˜ç»“æœï¼Œå®šä¹‰ ReceivePayNotifyService ç±»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;ReceivePayNotifyService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; RabbitTemplate rabbitTemplate; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    MqMessageService mqMessageService; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    MyCourseTablesService myCourseTablesService; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ç›‘å¬æ¶ˆæ¯éšŠåˆ—æ¥æ”¶æ”¯ä»˜ç»“æœé€šçŸ¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RabbitListener(queues = PayNotifyConfig.PAYNOTIFY_QUEUE)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;receive&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Message message, Channel channel)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Thread.sleep(&lt;span class=&#34;number&#34;&gt;5000&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (InterruptedException e) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(e); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è·å–æ¶ˆæ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;MqMessage&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;mqMessage&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(message.getBody(), MqMessage.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;å­¦ä¹ ä¸­å¿ƒæœåŠ¡æ¥æ”¶æ”¯ä»˜ç»“æœ:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, mqMessage); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ¶ˆæ¯ç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;messageType&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; mqMessage.getMessageType(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è®¢å•ç±»å‹,60201è¡¨ç¤ºè´­ä¹°è¯¾ç¨‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;businessKey2&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; mqMessage.getBusinessKey2(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¿™é‡Œåªå¤„ç†æ”¯ä»˜ç»“æœé€šçŸ¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (PayNotifyConfig.MESSAGE_TYPE.equals(messageType) &amp;amp;&amp;amp; &lt;span class=&#34;string&#34;&gt;&amp;quot;60201&amp;quot;&lt;/span&gt;.equals(businessKey2)) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//é€‰è¯¾è®°å½•id &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;choosecourseId&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; mqMessage.getBusinessKey1(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//æ·»åŠ é€‰è¯¾ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; myCourseTablesService.saveChooseCourseStauts(choosecourseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!b)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//æ·»åŠ é€‰è¯¾å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ¶ˆæ¯é‡å›éšŠåˆ— &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                XueChengPlusException.cast(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ”¶åˆ°æ”¯ä»˜ç»“æœï¼Œæ·»åŠ é€‰è¯¾å¤±è´¥&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;é€šçŸ¥æ”¯ä»˜ç»“æœæ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é€šçŸ¥æ”¯ä»˜ç»“æœæ¸¬è©¦&#34;&gt;#&lt;/a&gt; é€šçŸ¥æ”¯ä»˜ç»“æœæ¸¬è©¦&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•å‡†å¤‡ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£æ‰¾ä¸€é–€å·²ç™¼å¸ƒçš„æ”¶è²»èª²ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å¦‚æœåœ¨æˆ‘çš„èª²ç¨‹è¡¨å„²å­˜å‰‡åˆªé™¤ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£åˆªé™¤æ­¤èª²ç¨‹çš„é¸èª²ç´€éŒ„åŠè¨‚å–®è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;æ¸¬è©¦æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£é€²å…¥èª²ç¨‹è©³ç´°é é¢ï¼Œé»é¸é¦¬ä¸Šå­¸ç¿’ï¼Œç”¢ç”ŸäºŒç¶­ç¢¼é€²è¡Œä»˜æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£ä»˜æ¬¾å®Œæˆé»æ“Š â€œä»˜æ¬¾å®Œæˆâ€ï¼Œè§€å¯Ÿè¨‚å–®æœå‹™æ§åˆ¶å°æ˜¯å¦ç™¼é€è¨Šæ¯ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£è§€å¯Ÿå­¸ç¿’ä¸­å¿ƒæœå‹™æ§åˆ¶å°æ˜¯å¦æ¥æ”¶åˆ°è¨Šæ¯ã€‚&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£è§€å¯Ÿè³‡æ–™åº«ä¸­çš„æ¶ˆæ¯è¡¨çš„ç›¸æ‡‰è¨˜éŒ„æ˜¯å¦å·²åˆªé™¤ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè²»é‡è©¦æ¸¬è©¦ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£åœ¨å­¸ç¿’ä¸­å¿ƒæœå‹™æ¥æ”¶æ”¯ä»˜çµæœæ–¹æ³•ä¸­è£½é€ ç•°å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£é‡æ–°åŸ·è¡Œä¸Šé‚Šçš„æ¸¬è©¦æµç¨‹ï¼Œè§€å¯Ÿæ˜¯å¦æ¶ˆè²»é‡è©¦ã€‚&lt;/p&gt;
&lt;img data-src=&#34;https://usagif.com/wp-content/uploads/gifs/thanks-for-watching-9.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;</content>
        <category term="æ”¯ä»˜" />
        <updated>2023-11-08T09:27:06.236Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/11/07/java/radis/redis_interview</id>
        <title>Redisé¢è©¦é¡Œæ•´ç†</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/11/07/java/radis/redis_interview"/>
        <content type="html">&lt;p&gt;å‰è¨€:&lt;br&gt;
 å…§å®¹å‡ºè‡ª&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMXlUNDExSDdZSy8/dmRfc291cmNlPTA5ZDY2YTFmMDcyNWM1NDU5MzQ4OTJmMDhlZjZjYmE1&#34;&gt;é»‘é¦¬é«˜é »é¢è©¦é¡Œ&lt;/span&gt;&lt;br&gt;
ç¶“æ¶ˆåŒ–æ•´ç†å…§å®¹å¾Œå†ä½œå‡ºè¨˜éŒ„&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜ç©¿é€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜ç©¿é€&#34;&gt;#&lt;/a&gt; ç·©å­˜ç©¿é€&lt;/h1&gt;
&lt;p&gt;ç·©å­˜ç©¿é€ï¼šæŸ¥è©¢ä¸€å€‹ä¸å­˜åœ¨çš„æ•¸æ“šï¼Œå›  MySQL æŸ¥ä¸åˆ°æ•¸æ“šå°è‡´ç·©å­˜ä¹Ÿæ²’æœ‰æ•¸æ“šï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½æœƒè«‹æ±‚æ•¸æ“šåº«&lt;br&gt;
è§£æ±ºæ–¹æ³•ä¸€ï¼šæŸ¥è©¢ MYSQL ä¹Ÿæ²’æœ‰æ•¸æ“šæ™‚ï¼Œè¿”å›ç©ºå€¼åˆ°ç·©å­˜ï¼Œé€™æ–¹æ³•ç°¡å–®ï¼Œä½†æœƒæ¶ˆè€—å…§å­˜ï¼Œæœ‰å¯èƒ½ç™¼ç”Ÿä¸ä¸€è‡´å•é¡Œ&lt;br&gt;
è§£æ±ºæ–¹æ³•äºŒï¼šå¸ƒéš†éæ¿¾å™¨ï¼Œå¯¦ç¾æ¨¡è¤‡é›œï¼Œä½†æŸ¥è©¢ç©ºé–“å’Œæ™‚é–“éƒ½å¤§å¹…æå‡&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜æ“Šç©¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜æ“Šç©¿&#34;&gt;#&lt;/a&gt; ç·©å­˜æ“Šç©¿&lt;/h1&gt;
&lt;p&gt;ç·©å­˜æ“Šç©¿ï¼šæŸä¸€å€‹ç†±é–€ KEY çš„éæœŸæ™‚é–“éæœŸæ™‚ï¼Œå‰›å¥½å°é€™ KEY æœ‰å¤§é‡çš„è«‹æ±‚ï¼Œå› ç‚ºæ²’æœ‰ç·©å­˜é˜»æ“‹æ‰€ä»¥ç›´æ¥åˆ°é”æ•¸æ“šåº«ï¼Œå¯èƒ½æœƒæŠŠ DB å£“å®&lt;br&gt;
è§£æ±ºä¸€ï¼šåœ¨å¼·ä¸€è‡´å ´æ™¯ç”¨äº’æ–¥é–ï¼Œå› ç‚ºåœ¨ç·šç¨‹åŠ ä¸Šé–å¾Œï¼Œç²å¾—é–çš„ç·šç¨‹æ‰èƒ½æŸ¥æ•¸æ“šåº«ï¼Œé˜²æ­¢é«˜ä½µç™¼å ´æ™¯ä¸‹è«‹æ±‚æ•¸æ“šåº«ï¼Œä½¿ç”¨é–çš„é—œä¿‚æ€§èƒ½è¼ƒå·®&lt;br&gt;
è§£æ±ºäºŒï¼šåœ¨é«˜å¯ç”¨çš„å ´æ™¯ç”¨é‚è¼¯éæœŸï¼Œå› ç‚ºé€™å€‹ KEY æ˜¯ç†±é–€ KEY æ‰€ä»¥ä¸è¨­éæœŸæ™‚é–“æ‰‹å‹•ç¶­è­·ï¼Œä½†è¨­é‚è¼¯éæœŸå€¼ï¼Œç•¶é‡ç½®é‚è¼¯éæœŸæ™‚é–“æ›´æ–°æ•¸æ“šæ™‚ï¼Œç”¨æˆ¶é‚„æ˜¯å¯ä»¥æŸ¥è©¢åˆ°ç·©å­˜ï¼Œä½†ä¸ä¿è­‰æ•¸æ“šçµ•å°ä¸€è‡´&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜é›ªå´©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜é›ªå´©&#34;&gt;#&lt;/a&gt; ç·©å­˜é›ªå´©&lt;/h1&gt;
&lt;p&gt;ç·©å­˜é›ªå´©ï¼šæŒ‡åŒä¸€æ™‚é–“å¤§é‡çš„ KEY åŒæ™‚éæœŸæˆ–è€… redis æœå‹™å®•æ©Ÿï¼Œå°è‡´å¤§é‡è«‹æ±‚åˆ°æ•¸æ“šåº«ï¼Œé€ æˆå£“åŠ›&lt;br&gt;
è§£æ±º KEY å¤±æ•ˆï¼šçµ¦ key è¨­å¤±æ•ˆæ™‚é–“ç‚ºéš¨æ©Ÿå€¼&lt;br&gt;
è§£æ±ºå®•æ©Ÿï¼šé›†ç¾¤ã€é™ç´šé™æµã€å¤šç´šç·©å­˜&lt;/p&gt;
&lt;h1 id=&#34;æ•¸æ“šåº«èˆ‡rediså¦‚ä½•é€²è¡ŒåŒæ­¥é›™å¯«ä¸€è‡´&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ•¸æ“šåº«èˆ‡rediså¦‚ä½•é€²è¡ŒåŒæ­¥é›™å¯«ä¸€è‡´&#34;&gt;#&lt;/a&gt; æ•¸æ“šåº«èˆ‡ redis å¦‚ä½•é€²è¡ŒåŒæ­¥ (é›™å¯«ä¸€è‡´)&lt;/h1&gt;
&lt;p&gt;æ”¹æ•¸æ“šåº«çš„æ•¸æ“šæ™‚ï¼ŒåŒæ™‚æ›´æ–°ç·©å­˜ï¼Œè®“æ•¸æ“šåº«å’Œç·©å­˜ä¿æŒä¸€è‡´&lt;br&gt;
å¼·ä¸€è‡´æ™‚ï¼Œå¯ä»¥ç”¨æ’ä»–é–é˜»å¡å…¶ä»–ç·šç¨‹å¯«æ“ä½œ&lt;br&gt;
é«˜å¯ç”¨æ™‚ï¼Œå¯ä»¥åˆ©ç”¨ MQ, è®“æ•¸æ“šæœ€çµ‚ä¸€è‡´&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜æŒä¹…åŒ–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜æŒä¹…åŒ–&#34;&gt;#&lt;/a&gt; ç·©å­˜æŒä¹…åŒ–&lt;/h1&gt;
&lt;p&gt;æœ‰ AOF å’Œ RDB å…©ç¨®æ–¹æ³•ï¼Œé€šå¸¸å…©ç¨®ä¸€èµ·ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;AOF:redis æ¯ä¸€å€‹å¯«å…¥å‘½ä»¤éƒ½è¢«è¨˜éŒ„åœ¨ AOF æ–‡ä»¶ï¼Œä¿®æ”¹ redis.com é…ç½®æ–‡ä»¶é–‹å•Ÿï¼Œå› ç‚ºè¨˜éŒ„å‘½ä»¤æ‰€ä»¥æ–‡ä»¶è¼ƒå¤§&lt;br&gt;
 RDB:background save æ™‚ä¸»é€²ç¨‹ fork åˆ°å­é€²ç¨‹ï¼Œè¤‡è£½é è¡¨çµ¦å­é€²ç¨‹ï¼Œé è¡¨å°±æ˜¯è™›æ“¬æ©Ÿèˆ‡å…§å­˜ä¹‹é–“çš„æ˜ å°„é—œä¿‚ï¼Œè€Œå­é€²ç¨‹æœƒå°‡æ–°æ•¸æ“šå¯«å…¥ç£ç›¤ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜éæœŸç­–ç•¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜éæœŸç­–ç•¥&#34;&gt;#&lt;/a&gt; ç·©å­˜éæœŸç­–ç•¥&lt;/h1&gt;
&lt;p&gt;å®šæœŸåˆªé™¤ï¼šæ¯éš”ä¸€æ®µæ™‚é–“ï¼ŒæŸ¥è©¢ä¸€äº› KEY åˆªé™¤é‡Œé¢éæœŸçš„ KEY, å¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶èª¿æ•´æ¸…ç†æ¨¡å¼ï¼Œå° CPU å’Œå…§å­˜è¼ƒå¥½ï¼Œä½†åˆªé™¤æ™‚é–“å’Œé »ç‡é›£ä»¥ç¢ºå®š&lt;br&gt;
æƒ°æ€§åˆªé™¤ï¼šç•¶æˆ‘å€‘æŸ¥è©¢ KEY æ™‚ï¼Œæœƒæª¢æŸ¥å…¶æ˜¯å¦éæœŸï¼ŒéæœŸå°±åˆªé™¤ï¼Œåä¹‹è¿”å› KEY, å° CPU å‹å¥½ï¼Œä½†å°å…§å­˜ä¸å‹å¥½&lt;/p&gt;
&lt;h1 id=&#34;æ·˜æ±°ç­–ç•¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ·˜æ±°ç­–ç•¥&#34;&gt;#&lt;/a&gt; æ·˜æ±°ç­–ç•¥&lt;/h1&gt;
&lt;p&gt;ç•¶ redis ä¸­çš„å…§å­˜ä¸å¤ æ™‚ï¼Œæ­¤æ™‚åˆæœ‰æ–°çš„ KEY æ·»åŠ ï¼Œredis æœƒä»¥æŸç¨®è¦å‰‡å°‡å…§å­˜ä¸­çš„æ•¸æ“šåˆªé™¤&lt;br&gt;
æœ‰ 8 ç¨®ä¸åŒçš„ç­–ç•¥ï¼Œæœ€å¸¸ç”¨çš„æœ‰ 2 ç¨®:&lt;br&gt;
LRU: æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œç”¨ç•¶å‰æ™‚é–“æ¸›å»æœ€å¾Œä¸€æ¬¡è¨ªå•æ™‚é–“ï¼Œå€¼æ„ˆå¤§å‰‡æ·˜æ±°å„ªå…ˆæ„ˆé«˜&lt;br&gt;
 LFU: æœ€å°‘é »ç‡ä½¿ç”¨ï¼Œæœƒçµ±è¨ˆæ¯å€‹ KEY çš„è¨ªå•é »ç‡ï¼Œå€¼æ„ˆå°æ·˜æ±°å„ªå…ˆæ„ˆé«˜&lt;/p&gt;
&lt;p&gt;1. å„ªå…ˆä½¿ç”¨ allkeys-lru, æŠŠæœ€è¿‘å¸¸è¨ªå•çš„æ•¸æ“šç•™åœ¨ç·©å­˜&lt;br&gt;
 2. è¨ªå•é »ç‡å·®ä¸å¤šï¼Œå¯ä»¥ç”¨ allkeys-random&lt;br&gt;
3. æ¥­å‹™æœ‰ç½®é ‚éœ€æ±‚ï¼Œå¯ä»¥ç”¨ volatile-lru&lt;br&gt;
4. å¦‚æœæ•¸æ“šåº«æœ‰ 1000 è¬æ•¸æ“šï¼ŒRedis åªèƒ½ç·©å­˜ 20 è¬æ•¸æ“šï¼Œå¦‚ä½•ä¿è­‰ Redis ä¸­éƒ½æ˜¯ç†±é»æ•¸æ“šï¼Ÿ&lt;br&gt;
 ä½¿ç”¨ allkeys-lru æ·˜æ±°ç­–ç•¥ï¼Œç•™ä¸‹ä¾†çš„éƒ½æ˜¯ç†±é»æ•¸æ“šã€‚&lt;br&gt;
5.Redis çš„å…§å­˜ç”¨å®Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ&lt;br&gt;
 è¦çœ‹æ•¸æ“šæ·˜æ±°ç­–ç•¥æ˜¯ä»€éº¼ï¼Œå¦‚æœæ˜¯é»˜èªé…ç½® (noeviction), ä¸å…è¨±å­˜å…¥æ–°æ•¸æ“šï¼Œæœƒå ±éŒ¯&lt;/p&gt;
&lt;h1 id=&#34;å¦‚ä½•å¯¦ç¾åˆ†å¸ƒå¼é–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¦‚ä½•å¯¦ç¾åˆ†å¸ƒå¼é–&#34;&gt;#&lt;/a&gt; å¦‚ä½•å¯¦ç¾åˆ†å¸ƒå¼é–&lt;/h1&gt;
&lt;p&gt;ä½¿ç”¨å ´æ™¯ï¼šå®šæ™‚ä»»å‹™ï¼Œæ¶å–®ï¼Œå†ªç­‰æ€§å ´æ™¯&lt;br&gt;
å•é¡Œï¼šå› ç‚ºåœ¨é›†ç¾¤ä¸‹é–åœ¨è‡ªå·±çš„ JVM è™›æ“¬æ©Ÿä¸Šï¼Œåªèƒ½é–ä½è‡ªå·±çš„æœå‹™ï¼Œæ‰€ä»¥é›†ç¾¤ä¸‹é–æœƒå¤±æ•ˆï¼Œå°è‡´æ•¸æ“šä¸ä¸€è‡´&lt;br&gt;
è§£æ±ºï¼šåˆ©ç”¨ redissonClient, è®“å¤šå°æœå‹™å™¨æ¶åŒä¸€æŠŠé–ï¼Œè€Œä¸”æœ‰ WatchDog ç›£è½ï¼Œç¢ºä¿æ¥­å‹™æˆåŠŸï¼ŒåŒä¸€ç·šç¨‹ä¸‹é–å¯ä»¥é‡å…¥&lt;/p&gt;
&lt;h1 id=&#34;ä¸»å¾åŒæ­¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸»å¾åŒæ­¥&#34;&gt;#&lt;/a&gt; ä¸»å¾åŒæ­¥&lt;/h1&gt;
&lt;p&gt;å¥½è™•ï¼šæé«˜ä½µç™¼ï¼Œè®€å¯«åˆ†é›¢&lt;/p&gt;
&lt;p&gt;å…¨é‡åŒæ­¥ï¼šå¾æœƒå‘ä¸»è«‹æ±‚æ•¸æ“šåŒæ­¥ï¼Œä¸»æœƒæª¢æŸ¥å¾æœ‰æ²’æœ‰ replId, æ²’æœ‰å‰‡èªªæ˜ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œè¿”å›æ•¸æ“šä¿¡æ¯ replIdã€offset, åŸ·è¡Œ BgSave ç”Ÿæˆ RDB æ–‡&lt;br&gt;
å¢é‡åŒæ­¥ï¼šå¦‚æœä¸»æª¢æŸ¥å¾ä¸æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼ŒæœƒæŸ¥çœ‹ offset å€¼ï¼Œæ ¹æ“šä¸»èˆ‡å¾çš„ offset å·®å€¼ï¼ŒåŒæ­¥å¾ŒæœŸè®ŠåŒ–çš„æ•¸æ“š&lt;/p&gt;
&lt;h1 id=&#34;å“¨å…µæ©Ÿåˆ¶&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å“¨å…µæ©Ÿåˆ¶&#34;&gt;#&lt;/a&gt; å“¨å…µæ©Ÿåˆ¶&lt;/h1&gt;
&lt;p&gt;1ï¸âƒ£ç›£æ§ï¼šå“¨å…µæœƒå‘ redis é›†ç¾¤ç™¼é€ PING å‘½ä»¤ï¼Œå¦‚æœé…ç½®ç™¼ç¾å¯¦ä¾‹æœªå®šæ™‚é–“éŸ¿æ‡‰ PONG, å‰‡èªç‚ºè©²å¯¦ä¾‹ä¸»è§€ä¸‹ç·šï¼Œæˆ–è€…è¶…éæŒ‡å®šæ•¸é‡çš„ sentinel éƒ½èªç‚ºè©²å¯¦ä¾‹ä¸‹ç·šï¼Œå‰‡å®¢è§€ä¸‹ç·šã€‚&lt;br&gt;
ä¸»ç¯€é»ä¸Šç·šå¾Œï¼Œå“¨å…µæœƒæ ¹æ“š offset æ„ˆå¤§çš„å¾ç¯€é»æˆç‚ºä¸»ï¼Œå› ç‚º offset å€¼æ„ˆå¤§èªªæ˜æ•¸æ“šæ„ˆå®Œæ•´&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£è‡ªå‹•æ•…éšœæ¢å¾©ï¼šå¦‚æœä¸»ç¯€é»æ•…éšœï¼ŒSentinel æœƒå°‡ä¸€å€‹ slave æå‡ç‚º masterã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£é€šçŸ¥ï¼šSentinel å……ç•¶ Redis å®¢æˆ¶ç«¯çš„æœå‹™ç™¼ç¾ä¾†æºï¼Œç•¶é›†ç¾¤ç™¼ç”Ÿæ•…éšœè½‰ç§»æ™‚ï¼Œæœƒå°‡æœ€æ–°ä¿¡æ¯æ¨é€çµ¦ redis çš„å®¢æˆ¶ç«¯&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£å“¨å…µè…¦è£‚ï¼šé›†ç¾¤è…¦è£‚æ˜¯ç”±æ–¼ä¸»ç¯€é»å’Œå¾ç¯€é»å’Œ sentinel è™•æ–¼ä¸åŒçš„ç¶²è·¯åˆ†å€ï¼Œä½¿å¾— sentinel æ²’æœ‰èƒ½å¤ å¿ƒè·³æ„ŸçŸ¥åˆ°ä¸»ç¯€é»ï¼Œæ‰€ä»¥é€šéé¸èˆ‰çš„æ–¹å¼æå‡äº†ä¸€å€‹å¾ç¯€é»ç‚ºä¸»ï¼Œé€™æ¨£å°±å­˜åœ¨å…©å€‹ master, å°±åƒå¤§è…¦åˆ†è£‚ä¸€æ¨£ï¼Œæœƒå°è‡´å®¢æˆ¶ç«¯é‚„åœ¨èˆŠçš„ä¸»ç¯€é»é‚£å¯«å…¥æ•¸æ“šï¼Œæ–°ç¯€é»ç„¡æ³•åŒæ­¥æ•¸æ“šï¼Œç•¶ç¶²è·¯æ¢å¾©å¾Œï¼Œsentinel æœƒå°‡èˆŠçš„ä¸»ç¯€é»é™ç‚ºå¾ç¯€é»ï¼Œé€™æ™‚å†å¾æ–°çš„ master åŒæ­¥æ•¸æ“šï¼Œå°±æœƒå°è‡´æ•¸æ“šæ‰å¤±&lt;/p&gt;
&lt;p&gt;è§£æ±ºï¼šå¯ä»¥ä¿®æ”¹ redis çš„é…ç½®ï¼Œå¯ä»¥è¨­ç½®æœ€å°‘çš„å¾ç¯€é»æ•¸é‡ä»¥åŠç¸®çŸ­ä¸»å¾æ•¸æ“šåŒæ­¥çš„å»¶é²æ™‚é–“ï¼Œé”ä¸åˆ°è¦æ±‚å°±æ‹’çµ•è«‹æ±‚ï¼Œå¯ä»¥é¿å…å¤§é‡æ•¸æ“šæ‰å¤±&lt;/p&gt;
&lt;h1 id=&#34;åˆ†ç‰‡é›†ç¾¤&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åˆ†ç‰‡é›†ç¾¤&#34;&gt;#&lt;/a&gt; åˆ†ç‰‡é›†ç¾¤&lt;/h1&gt;
&lt;p&gt;ä¸»å¾å’Œå“¨å…µè§£æ±ºäº†é«˜å¯ç”¨å’Œé«˜ä½µç™¼ï¼Œä½†æ²’æœ‰è§£æ±º:&lt;br&gt;
1ï¸âƒ£æµ·é‡æ•¸æ“šå­˜å„²å•é¡Œ&lt;br&gt;
2ï¸âƒ£é«˜ä½µç™¼å¯«çš„å•é¡Œ&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£æ±ºä¸Šè¿°å•é¡Œ:&lt;br&gt;
1ï¸âƒ£é›†ç¾¤ä¸­æœ‰å¤šå€‹ master, æ¯å€‹ master å¯ä»¥ä¿å­˜ä¸åŒæ•¸æ“šï¼Œå‡è¨­ä¸€å€‹ä¸»ä¿å­˜ 20W æ•¸æ“šï¼Œ3 å€‹å°±å¯ä»¥ä¿å­˜ 60W æ•¸æ“š&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£æ¯å€‹ä¸»ç¯€é»å¯ä»¥æœ‰å¤šå€‹å¾ç¯€é»&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ä¸»ç¯€é»ä¹‹é–“å¯ä»¥é€šé ping ç›£è½å½¼æ­¤&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£å®¢æˆ¶ç«¯è«‹æ±‚å¯ä»¥è¨ªå•é›†ç¾¤ä»»æ„ç¯€é»ï¼Œæœ€çµ‚éƒ½æœƒè¢«è½‰ç™¼åˆ°æ­£ç¢ºç¯€é»&lt;/p&gt;
&lt;p&gt;5ï¸âƒ£åˆ†ç‰‡é›†ç¾¤å¼•å…¥äº† hash æ§½æ¦‚å¿µï¼Œredis é›†ç¾¤æœ‰ 16384 å€‹å“ˆå¸Œæ§½ï¼Œæ¯å€‹ key é€šéç®—æ³•å¾Œå° 16384 å–é¤˜æ•¸ï¼Œå¦‚æœæƒ³å°‡ä¸€é¡ KEY æ”¾åœ¨ä¸€èµ·æå‡æ€§èƒ½ï¼Œkey çš„å‘½åå¯ä»¥é€™æ¨£ set {F1A} name john&lt;/p&gt;
&lt;h1 id=&#34;redisçš„ioå¤šè·¯è¤‡ç”¨æ¨¡å‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#redisçš„ioå¤šè·¯è¤‡ç”¨æ¨¡å‹&#34;&gt;#&lt;/a&gt; Redis çš„ IO å¤šè·¯è¤‡ç”¨æ¨¡å‹&lt;/h1&gt;
&lt;p&gt;1ï¸âƒ£redis æ˜¯å–®ç¨‹ç·šï¼Œä½†ç‚ºä»€éº¼é‚£éº¼å¿«ï¼Ÿå› ç‚º redis æ˜¯ç´”å…§å­˜æ“ä½œï¼ŒåŸ·è¡Œé€Ÿåº¦éå¸¸å¿«&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£æ¡ç”¨å–®ç·šç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ›ï¼Œå¤šç¨‹ç·šé‚„è¦è€ƒæ…®ç·šç¨‹å®‰å…¨&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ä½¿ç”¨ IO å¤šè·¯è¤‡ç”¨æ¨¡å‹&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ redis æ˜¯ç´”å…§å­˜æ“ä½œï¼Œå®ƒçš„æ€§èƒ½ç“¶é ¸æ˜¯ç¶²è·¯å»¶é²è€Œä¸æ˜¯åŸ·è¡Œé€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ Redis ç¶²è·¯æ¨¡å‹é€šé IO å¤šè·¯è¤‡ç”¨æé«˜æ€§èƒ½ï¼Œè€Œä¸”æ”¯æŒå„ç¨®ä¸åŒçš„å¤šè·¯è¤‡ç”¨å¯¦ç¾ï¼Œå°‡é€™äº›å¯¦ç¾é€²è¡Œå°è£ï¼Œæä¾›äº†çµ±ä¸€çš„é«˜æ€§èƒ½äº‹ä»¶åº«&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ redis åœ¨ IO å¤šè·¯è¤‡ç”¨çš„åŸºç¤ä¸‹ï¼Œæ·»åŠ äº†è‡ªå·±çš„äº‹ä»¶æ´¾ç™¼ï¼Œå°‡å¯«æ•¸æ“šå’Œè®€æ•¸æ“šæ”¹ç‚ºå¤šç¨‹ç·šæ¥æ”¶æ•¸æ“šï¼Œå¢åŠ å‘½ä»¤è½‰æ›é€Ÿåº¦ï¼Œå‘½ä»¤åŸ·è¡Œæ™‚æ˜¯ä¾ç„¶æ˜¯å–®ç·šç¨‹&lt;/p&gt;
&lt;img data-src=&#34;https://usagif.com/wp-content/uploads/gifs/thanks-for-watching-9.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;</content>
        <category term="Radis" />
        <updated>2023-11-07T14:59:14.136Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/11/03/java/SpringSecurity/WeChat_login</id>
        <title>SpringSecurity å¾®ä¿¡ç™»éŒ„</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/11/03/java/SpringSecurity/WeChat_login"/>
        <content type="html">&lt;p&gt;åœ¨æ­¤ç‰¹åˆ«æ„Ÿè¬é»‘é¦¬ç¨‹åºå“¡æä¾›çš„èª²ç¨‹: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWo4NDExTjdCbS8=&#34;&gt;å­¸æˆåœ¨ç·š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰è¨€&lt;br&gt;
æ–¼ç”±å¯¦ç¿’é …ç›®å¿«åšå®Œæ‰åšè¨˜éŒ„ï¼Œè€Œä¸”é …ç›®æ¨¡å¡Šè¼ƒå¤šï¼Œæ•…æŒ‘éƒ¨ä»½ä¾†è¨˜éŒ„ï¼Œæ‰€ä»¥é€™éä¸»è¦æ˜¯ SpringSecurity å…§å®¹ã€‚&lt;br&gt;
&lt;span class=&#34;rainbow&#34;&gt;å®Œæ•´é¡¹ç›®åœ°å€&lt;/span&gt;ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3N1cGVycmpvaG4vamF2YV93ZWI=&#34;&gt;https://github.com/superrjohn/java_web&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;ä¸Šç¯‡:&lt;/span&gt;&lt;a href=&#34;/John/2023/10/30/java/SpringSecurity/SpringSecurity&#34;&gt;èªè­‰æˆæ¬Š&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;é©—è­‰ç¢¼æœå‹™&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é©—è­‰ç¢¼æœå‹™&#34;&gt;#&lt;/a&gt; é©—è­‰ç¢¼æœå‹™&lt;/h1&gt;
&lt;h2 id=&#34;éƒ¨ç½²é©—è­‰ç¢¼æœå‹™å·¥ç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#éƒ¨ç½²é©—è­‰ç¢¼æœå‹™å·¥ç¨‹&#34;&gt;#&lt;/a&gt; éƒ¨ç½²é©—è­‰ç¢¼æœå‹™å·¥ç¨‹&lt;/h2&gt;
&lt;p&gt;ğŸ”´åœ¨èªè­‰æ™‚ä¸€èˆ¬éƒ½éœ€è¦è¼¸å…¥é©—è­‰ç¢¼ï¼Œé©—è­‰ç¢¼æœ‰ä»€éº¼ç”¨ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;é©—è­‰ç¢¼å¯ä»¥é˜²æ­¢æƒ¡æ€§æ”»æ“Šï¼Œä¾‹å¦‚ï¼šXSS è·¨ç«™è…³æœ¬æ”»æ“Šã€CSRF è·¨ç«™è«‹æ±‚å½é€ æ”»æ“Šï¼Œä¸€äº›æ¯”è¼ƒè¤‡é›œçš„åœ–å½¢é©—è­‰ç¢¼å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢æƒ¡æ€§æ”»æ“Šã€‚&lt;br&gt;
ç‚ºäº†ä¿è­·ç³»çµ±çš„å®‰å…¨æ€§åœ¨ä¸€äº›æ¯”è¼ƒé‡è¦çš„æ“ä½œéƒ½éœ€è¦é©—è­‰ç¢¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬å°ˆæ¡ˆå»ºç«‹å–®ç¨çš„é©—è­‰ç¢¼æœå‹™ç‚ºå„æ¥­å‹™æä¾›é©—è­‰ç¢¼çš„ç”¢ç”Ÿã€æ ¡é©—ç­‰æœå‹™ã€‚&lt;br&gt;
æ‹·è²èª²ç¨‹è³‡æ–™ç›®éŒ„ xuecheng-plus-checkcode é©—è­‰ç¢¼æœå‹™å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®éŒ„ã€‚&lt;br&gt;
ç„¶å¾Œå®šç¾© nacos è¨­å®šæª”&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;server:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;servlet:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;context-path:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;/checkcode&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;port:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;63075&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ³¨æ„ä¿®æ”¹ bootstrap.yml ä¸­çš„å‘½åç©ºé–“ç‚ºè‡ªå·±å®šç¾©çš„å‘½åç©ºé–“ã€‚&lt;br&gt;
é…ç½® redis-dev.yamlï¼Œå„²å­˜ redis æœå‹™å•Ÿå‹•&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;XML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;spring:  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  redis: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    host: 192.168.101.65 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    port: 6379 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    password: redis &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    database: 0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lettuce: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      pool: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        max-active: 20 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        max-idle: 10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        min-idle: 0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    timeout: 10000 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    #redisson: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      #é…ç½®æ–‡ä»¶ç›®å½• &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      #config: classpath:singleServerConfig.yaml &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;é©—è­‰ç¢¼ä»‹é¢æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é©—è­‰ç¢¼ä»‹é¢æ¸¬è©¦&#34;&gt;#&lt;/a&gt; é©—è­‰ç¢¼ä»‹é¢æ¸¬è©¦&lt;/h2&gt;
&lt;p&gt;1ï¸âƒ£é»‘é¦¬æä¾›çš„é©—è­‰ç¢¼æœå‹™ä¸­çš„ Controller ä¸­æœ‰ä¸€å€‹æ–¹æ³•ï¼Œæ˜¯ç”¨ä¾†ç”¢ç”Ÿé©—è­‰ç¢¼åœ–ç‰‡çš„&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;JAVA&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(value=&amp;quot;ç”ŸæˆéªŒè¯ä¿¡æ¯&amp;quot;, notes=&amp;quot;ç”ŸæˆéªŒè¯ä¿¡æ¯&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@PostMapping(value = &amp;quot;/pic&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CheckCodeResultDto &lt;span class=&#34;title function_&#34;&gt;generatePicCheckCode&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(CheckCodeParamsDto checkCodeParamsDto)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; picCheckCodeService.generate(checkCodeParamsDto);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£æˆ‘å€‘ä½¿ç”¨ HttpClient æ¸¬è©¦è©²ä»‹é¢&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#### è·å–éªŒè¯ç å›¾ç‰‡&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST localhost:&lt;span class=&#34;number&#34;&gt;53075&lt;/span&gt;/checkcode/pic&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£å›æ‡‰çµæœå¦‚ä¸‹ï¼Œåœ–ç‰‡æ˜¯ä»¥ base64 ç·¨ç¢¼æ ¼å¼å„²å­˜çš„ï¼Œæˆ‘å€‘å¯ä»¥è¤‡è£½ç›´æ¥åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/14.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;4ï¸âƒ£é©—è­‰ç¢¼æœå‹™å¦‚ä½•ç”¢ç”Ÿä½µæ ¡é©—é©—è­‰ç¢¼ï¼Ÿ&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/15.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1. çµ¦ç”¢ç”Ÿçš„é©—è­‰ç¢¼åˆ†é…ä¸€å€‹ keyï¼Œå°‡ key å’Œé©—è­‰ç¢¼ä¸€åŒå­˜å…¥ redisã€‚ é€™å€‹ key å’Œåœ–ç‰‡ä¸€åŒå›é çµ¦é é¢ã€‚&lt;br&gt;
2. ä½¿ç”¨è€…è¼¸å…¥é©—è­‰ç¢¼ï¼Œé€£åŒ key ä¸€åŒæäº¤è‡³èªè­‰æœå‹™ï¼Œåªæ˜¯é€™å€‹ key è¢«éš±è—èµ·ä¾†ï¼Œè‡ªå‹•è¼¸å…¥ã€‚&lt;br&gt;
3. é©—è­‰ç¢¼æœå‹™æ ¹æ“š key å¾å¿«å–å–å‡ºæ­£ç¢ºçš„é©—è­‰ç¢¼å’Œä½¿ç”¨è€…è¼¸å…¥çš„é©—è­‰ç¢¼é€²è¡Œæ¯”å°ï¼Œå¦‚æœç›¸åŒå‰‡æ ¡é©—é€šéï¼Œå¦å‰‡ä¸é€šéã€‚&lt;/p&gt;
&lt;p&gt;5ï¸âƒ£æ ¡é©—é©—è­‰ç¢¼ä»‹é¢ï¼Œcode éœ€è¦æ”¹ç‚ºåœ–ç‰‡é¡¯ç¤ºçš„å€¼&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### æ ¡éªŒéªŒè¯ç  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;checkcode_host&amp;#125;&amp;#125;/checkcode/verify?key=checkcode4506b95bddbe46cdb0d56810b747db1b&amp;amp;code=70dl &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å¸³è™Ÿå¯†ç¢¼èªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¸³è™Ÿå¯†ç¢¼èªè­‰&#34;&gt;#&lt;/a&gt; å¸³è™Ÿå¯†ç¢¼èªè­‰&lt;/h2&gt;
&lt;p&gt;åŸ·è¡Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/16.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1ã€åœ¨èªè­‰æœå‹™å®šç¾©é ç«¯å‘¼å«é©—è­‰ç¢¼æœå‹™çš„æ¥å£ï¼ŒFeignClient çš„åƒæ•¸ value ç‚ºæœå‹™åï¼ŒCheckCodeClientFactory ç‚ºé™ç´šæ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@FeignClient(value = &amp;quot;checkcode&amp;quot;,fallbackFactory = CheckCodeClientFactory.class)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/checkcode&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CheckCodeClient&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@PostMapping(value = &amp;quot;/verify&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Boolean &lt;span class=&#34;title function_&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@RequestParam(&amp;quot;key&amp;quot;)&lt;/span&gt; String key,&lt;span class=&#34;meta&#34;&gt;@RequestParam(&amp;quot;code&amp;quot;)&lt;/span&gt; String code)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.CheckCodeClientFactory:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Component&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CheckCodeClientFactory&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;FallbackFactory&lt;/span&gt;&amp;lt;CheckCodeClient&amp;gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CheckCodeClient &lt;span class=&#34;title function_&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Throwable throwable)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CheckCodeClient&lt;/span&gt;() &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Boolean &lt;span class=&#34;title function_&#34;&gt;verify&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String key, String code)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨éªŒè¯ç æœåŠ¡ç†”æ–­å¼‚å¸¸:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, throwable.getMessage()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3. å•Ÿå‹•é¡æ·»åŠ ï¼ŒbasePackages ç‚ºé ç¨‹èª¿ç”¨æ¥å£çš„ç›®éŒ„&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@EnableFeignClients(basePackages=&amp;#123;&amp;quot;com.xuecheng.*.feignclient&amp;quot;&amp;#125;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶å¼•å…¥ feign-dev.yaml&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;- data-id: feign-$&amp;#123;spring.profiles.active&amp;#125;.yaml &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  group: xuecheng-plus-common &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  refresh: &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;4. å®Œå–„ PasswordAuthServiceImpl&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;password_authservice&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PasswordAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; XcUserMapper xcUserMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; PasswordEncoder passwordEncoder; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; CheckCodeClient checkCodeClient; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//æ ¡éªŒéªŒè¯ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;checkcode&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getCheckcode(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;checkcodekey&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getCheckcodekey(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(StringUtils.isBlank(checkcodekey) || StringUtils.isBlank(checkcode))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;éªŒè¯ç ä¸ºç©º&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;Boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;verify&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; checkCodeClient.verify(checkcodekey, checkcode); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!verify)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;éªŒè¯ç è¾“å…¥é”™è¯¯&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//è´¦å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getUsername(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, username)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(user==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è´¦å·ä¸å­˜åœ¨&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//æ ¡éªŒå¯†ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//å–å‡ºæ•°æ®åº“å­˜å‚¨çš„æ­£ç¡®å¯†ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;passwordDb&lt;/span&gt;  &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;user.getPassword(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;passwordForm&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getPassword(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;matches&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; passwordEncoder.matches(passwordForm, passwordDb); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!matches)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è´¦å·æˆ–å¯†ç é”™è¯¯&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; user; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å¸³è™Ÿå¯†ç¢¼èªè­‰æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¸³è™Ÿå¯†ç¢¼èªè­‰æ¸¬è©¦&#34;&gt;#&lt;/a&gt; å¸³è™Ÿå¯†ç¢¼èªè­‰æ¸¬è©¦&lt;/h2&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/17.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1. ä½¿ç”¨ç€è¦½å™¨é€ è¨ª &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy41MXh1ZWNoZW5nLmNuL3NpZ24uaHRtbA==&#34;&gt;http://www.51xuecheng.cn/sign.html&lt;/span&gt;&lt;br&gt;
2. å…ˆæ¸¬è©¦é©—è­‰ç¢¼ï¼Œåˆ†åˆ¥è¼¸å…¥æ­£ç¢ºçš„é©—è­‰ç¢¼ã€éŒ¯èª¤çš„é©—è­‰ç¢¼é€²è¡Œæ¸¬è©¦&lt;br&gt;
 3. è¼¸å…¥æ­£ç¢ºçš„å¸³è™Ÿå¯†ç¢¼å’ŒéŒ¯èª¤çš„å¸³è™Ÿå¯†ç¢¼é€²è¡Œæ¸¬è©¦&lt;br&gt;
ç™»å…¥æˆåŠŸå°‡ jwt ä»¤ç‰Œå„²å­˜ cookie.&lt;br&gt;
4. æ¸¬è©¦è‡ªå‹•ç™»å…¥&lt;br&gt;
å‹¾é¸è‡ªå‹•ç™»å…¥ cookie ç”¢ç”Ÿæ™‚é–“ç‚º 30 å¤©ï¼Œä¸å‹¾é¸è‡ªå‹•ç™»å…¥é—œé–‰ç€è¦½å™¨è¦–çª—å¾Œè‡ªå‹•åˆªé™¤ cookieã€‚&lt;/p&gt;
&lt;h1 id=&#34;å¾®ä¿¡æƒç¢¼ç™»å…¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¾®ä¿¡æƒç¢¼ç™»å…¥&#34;&gt;#&lt;/a&gt; å¾®ä¿¡æƒç¢¼ç™»å…¥&lt;/h1&gt;
&lt;h2 id=&#34;æ¥å…¥æµç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å…¥æµç¨‹&#34;&gt;#&lt;/a&gt; æ¥å…¥æµç¨‹&lt;/h2&gt;
&lt;p&gt;å‰è¨€ï¼šå…ˆè¦åœ¨&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9vcGVuLndlaXhpbi5xcS5jb20v&#34;&gt;ç½‘ç«™åº”ç”¨å¼€å‘&lt;/span&gt;ï¼Œä¸¦æ“æœ‰å·²å¯©æ ¸é€šéçš„ç¶²ç«™æ‡‰ç”¨ï¼Œä¸¦å–å¾—ç›¸æ‡‰çš„ AppID å’Œ AppSecretï¼Œç”³è«‹å¾®ä¿¡ç™»å…¥ä¸”é€šéå¯©æ ¸å¾Œï¼Œå¯é–‹å§‹æ¥å–æµç¨‹ (ä¸Šç¶²æ‰¾å¯ä»¥æ‰¾åˆ°è³‡æº)&lt;/p&gt;
&lt;p&gt;å¾®ä¿¡æƒç¢¼ç™»å…¥åŸºæ–¼ OAuth2 å”å®šçš„æˆæ¬Šç¢¼æ¨¡å¼ï¼Œ&lt;/p&gt;
&lt;p&gt;ä»‹é¢æ–‡æª”ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kZXZlbG9wZXJzLndlaXhpbi5xcS5jb20vZG9jL29wbGF0Zm9ybS9XZWJzaXRlX0FwcC9XZUNoYXRfTG9naW4vV2VjaGF0X0xvZ2luLmh0bWw=&#34;&gt;https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å¾®ä¿¡ OAuth2.0 æˆæ¬Šç™»å…¥ç›®å‰æ”¯æ´ authorization_code æ¨¡å¼ï¼Œé©ç”¨æ–¼æ“æœ‰ server ç«¯çš„æ‡‰ç”¨ç¨‹å¼æˆæ¬Šã€‚ æ­¤æ¨¡å¼æ•´é«”æµç¨‹ç‚ºï¼š&lt;br&gt;
1ï¸âƒ£ç¬¬ä¸‰æ–¹ç™¼èµ·å¾®ä¿¡æˆæ¬Šç™»å…¥è¦æ±‚ï¼Œå¾®ä¿¡ä½¿ç”¨è€…å…è¨±æˆæ¬Šç¬¬ä¸‰æ–¹æ‡‰ç”¨ç¨‹å¼å¾Œï¼Œå¾®ä¿¡æœƒæ‹‰èµ·æ‡‰ç”¨ç¨‹å¼æˆ–é‡å®šå‘åˆ°ç¬¬ä¸‰æ–¹ç¶²ç«™ï¼Œä¸¦ä¸”å¸¶ä¸Šæˆæ¬Šè‡¨æ™‚ç¥¨æ“š code åƒæ•¸ï¼›&lt;br&gt;
2ï¸âƒ£é€é code åƒæ•¸åŠ ä¸Š AppID å’Œ AppSecret ç­‰ï¼Œé€é API æ›å– access_tokenï¼›&lt;br&gt;
3ï¸âƒ£é€é access_token é€²è¡Œä»‹é¢èª¿ç”¨ï¼Œå–å¾—ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™è³‡æºæˆ–å¹«åŠ©ä½¿ç”¨è€…å¯¦ç¾åŸºæœ¬æ“ä½œã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/18.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;æ­¥é©Ÿ 1ï¼šåœ¨é é¢ä¸­å…ˆå¼•å…¥ä»¥ä¸‹ JS æª”æ¡ˆï¼ˆæ”¯æ´ httpsï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¥é©Ÿ 2ï¼šåœ¨éœ€è¦ä½¿ç”¨å¾®ä¿¡ç™»å…¥çš„åœ°æ–¹å¯¦ä¾‹ä»¥ä¸‹ JS ç‰©ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;var obj = new WxLogin({&lt;br&gt;
self_redirect:true,&lt;br&gt;
id:â€œlogin_containerâ€,&lt;br&gt;
appid: â€œ&lt;span class=&#34;yellow&#34;&gt;ç¶²ç«™æ‡‰ç”¨å¯©æ ¸é€šéå¾Œç²å¾—&lt;/span&gt;â€,&lt;br&gt;
scope: â€œâ€,&lt;br&gt;
redirect_uri: â€œ&lt;span class=&#34;yellow&#34;&gt;ç”¨æˆ¶æŒ‰ä¸‹åŒæ„å¾Œï¼Œç¶²ç«™æ‡‰ç”¨é‡å®šå‘&lt;/span&gt;â€,&lt;br&gt;
state: â€œâ€,&lt;br&gt;
style: â€œâ€,&lt;br&gt;
href: â€œâ€&lt;br&gt;
});&lt;/p&gt;
&lt;h1 id=&#34;æ¥å…¥å¾®ä¿¡ç™»å…¥&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å…¥å¾®ä¿¡ç™»å…¥&#34;&gt;#&lt;/a&gt; æ¥å…¥å¾®ä¿¡ç™»å…¥&lt;/h1&gt;
&lt;h2 id=&#34;æ¥å…¥åˆ†æ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å…¥åˆ†æ&#34;&gt;#&lt;/a&gt; æ¥å…¥åˆ†æ&lt;/h2&gt;
 &lt;img data-src=&#34;/John/img/java/SpringSecurity/19.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1ï¸âƒ£éœ€è¦å®šç¾©ä»‹é¢æ¥æ”¶å¾®ä¿¡ä¸‹ç™¼çš„æˆæ¬Šç¢¼ã€‚&lt;br&gt;
2ï¸âƒ£æ”¶åˆ°æˆæ¬Šç¢¼å‘¼å«å¾®ä¿¡ä»‹é¢ç”³è«‹ä»¤ç‰Œã€‚&lt;br&gt;
3ï¸âƒ£ç”³è«‹åˆ°ä»¤ç‰Œèª¿ç”¨å¾®ä¿¡ç²å–ç”¨æˆ¶ä¿¡æ¯&lt;br&gt;
4ï¸âƒ£å–å¾—ä½¿ç”¨è€…è³‡è¨ŠæˆåŠŸå°‡å…¶å¯«å…¥æœ¬å°ˆæ¡ˆç”¨æˆ¶ä¸­å¿ƒè³‡æ–™åº«ã€‚&lt;br&gt;
5ï¸âƒ£æœ€å¾Œé‡å®šå‘åˆ°ç€è¦½å™¨è‡ªå‹•ç™»å…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®šç¾©æ¥å£&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å®šç¾©æ¥å£&#34;&gt;#&lt;/a&gt; å®šç¾©æ¥å£&lt;/h2&gt;
&lt;p&gt;åƒè€ƒä»‹é¢è¦æ ¼ä¸­ã€Œè«‹æ±‚å–å¾—æˆæ¬Šç¢¼ã€ å®šç¾©æ¥æ”¶å¾®ä¿¡ä¸‹ç™¼çš„æˆæ¬Šç¢¼æ¥å£ï¼Œ&lt;br&gt;
å®šç¾© WxLoginController é¡ï¼Œç•¶ç”¨æˆ¶åœ¨å‰ç«¯æƒç¢¼æ™‚ï¼Œç”¨æˆ¶åŒæ„å¾Œæœƒè·³è½‰åˆ°é€™å€‹æ–¹æ³•ï¼Œæ”¶åˆ°ç”¨æˆ¶ä¿¡æ¯å¾Œå†åŸ·è¡Œå¾®ä¿¡èªè­‰çš„ service è‡ªå‹•ç™»éŒ„ï¼Œå¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Controller&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxLoginController&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/wxLogin&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;wxLogin&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code, String state)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;å¾®ä¿¡æ‰«ç å›è°ƒ,code:&amp;#123;&amp;#125;,state:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,code,state); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æœ¬é¡¹ç›®æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUser&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æš‚æ—¶ç¡¬ç¼–å†™ï¼Œç›®çš„æ˜¯è°ƒè¯•ç¯å¢ƒ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        xcUser.setUsername(&lt;span class=&#34;string&#34;&gt;&amp;quot;t1&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(xcUser==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;redirect:http://www.51xuecheng.cn/error.html&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUser.getUsername(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;redirect:http://www.51xuecheng.cn/sign.html?username=&amp;quot;&lt;/span&gt;+username+&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;amp;authType=wx&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®šç¾©å¾®ä¿¡èªè­‰çš„ service&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;wx_authservice&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUserExt &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è´¦å· &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getUsername(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, username)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(user==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è´¦å·ä¸å­˜åœ¨&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUserExt&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUserExt&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUserExt&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        BeanUtils.copyProperties(user,xcUserExt); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUserExt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ¥å…¥å¾®ä¿¡èªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥å…¥å¾®ä¿¡èªè­‰&#34;&gt;#&lt;/a&gt; æ¥å…¥å¾®ä¿¡èªè­‰&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œã€‚&lt;br&gt;
1ï¸âƒ£å› ç‚ºå’Œç¬¬ä¸‰æ–¹é€²è¡Œé ç¨‹èª¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ restTemplate è¯·æ±‚å¾®ä¿¡ï¼Œé…ç½® RestTemplate bean&lt;/p&gt;
&lt;p&gt;åœ¨å•Ÿå‹•é¡é…ç½® restTemplate&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RestTemplate &lt;span class=&#34;title function_&#34;&gt;restTemplate&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;RestTemplate&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;restTemplate&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RestTemplate&lt;/span&gt;(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OkHttp3ClientHttpRequestFactory&lt;/span&gt;()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt;  restTemplate; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£å®šç¾©èˆ‡å¾®ä¿¡èªè­‰çš„ service ä»‹é¢ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxAuthService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;wxAuth&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£ä¸‹é‚Šåœ¨ controller ä¸­å‘¼å« wxAuth ä»‹é¢ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Controller&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxLoginController&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    WxAuthService wxAuthService; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/wxLogin&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;wxLogin&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code, String state)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; IOException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.debug(&lt;span class=&#34;string&#34;&gt;&amp;quot;å¾®ä¿¡æ‰«ç å›è°ƒ,code:&amp;#123;&amp;#125;,state:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,code,state); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¯·æ±‚å¾®ä¿¡ç”³è¯·ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æœ¬é¡¹ç›®æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; wxAuthService.wxAuth(code); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(xcUser==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;redirect:http://www.51xuecheng.cn/error.html&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUser.getUsername(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;redirect:http://www.51xuecheng.cn/sign.html?username=&amp;quot;&lt;/span&gt;+username+&lt;span class=&#34;string&#34;&gt;&amp;quot;&amp;amp;authType=wx&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;4ï¸âƒ£åœ¨ WxAuthService çš„ wxAuth æ–¹æ³•ä¸­å¯¦ä½œç”³è«‹ä»¤ç‰Œã€æŸ¥è©¢ä½¿ç”¨è€…è³‡è¨Šç­‰å…§å®¹ï¼Œappid å’Œ secret æ˜¯åœ¨å¾®ä¿¡é–‹æ”¾å¹³å°è¨»å†Šå¾Œç²å¾—çš„ï¼Œå°‡å®ƒå€‘é…åœ¨ nacos çš„ auth-service-dev.yaml é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶è€ŒæŠŠå€¼æ³¨å…¥é€²ä¾†ä½¿ç”¨&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;wx_authservice&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt;, WxAuthService &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;XcUserMapper xcUserMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RestTemplate restTemplate; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;weixin.appid&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String appid; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Value(&amp;quot;$&amp;#123;weixin.secret&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;String secret; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;wxAuth&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¶åˆ°codeè°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String, String&amp;gt; access_token_map = getAccess_token(code); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(access_token_map==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    System.out.println(access_token_map); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;openid&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; access_token_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;openid&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;access_token&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; access_token_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;access_token&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ‹¿access_tokenæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String, String&amp;gt; userinfo = getUserinfo(access_token, openid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(userinfo==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ·»åŠ ç”¨æˆ·åˆ°æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;5ï¸âƒ£getAccess_token æ–¹æ³•ï¼Œæ‹¿è‘—æˆæ¬Šç¢¼ç”³è«‹ä»¤ç‰Œæ–¹æ³•ï¼Œå› å¾®ä¿¡è¿”å›æ˜¯ JSON, æ‰€ä»¥æˆ‘å€‘ç”¨ Map æ¥æ”¶ï¼ŒæŠŠåŸæœ¬è«‹æ±‚å¾®ä¿¡åœ°å€çš„é—œéµåƒæ•¸ç”¨ % s ä½”ä½ï¼Œç„¶å¾Œç”¨ format æ–¹æ³•æŠŠä½”ä½åƒæ•¸ä¿®æ”¹æˆæˆ‘å€‘çš„æ•¸æ“šï¼Œé‡æ–°æ‹¼æ¥ url&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; Map&amp;lt;String,String&amp;gt; &lt;span class=&#34;title function_&#34;&gt;getAccess_token&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;wxUrl_template&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=%s&amp;amp;secret=%s&amp;amp;code=%s&amp;amp;grant_type=authorization_code&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è¯·æ±‚å¾®ä¿¡åœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;wxUrl&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; String.format(wxUrl_template, appid, secret, code); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token, url:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, wxUrl); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//é ç¨‹èª¿ç”¨å¾®ä¿¡url&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ResponseEntity&amp;lt;String&amp;gt; exchange = restTemplate.exchange(wxUrl, HttpMethod.POST, &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;, String.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; exchange.getBody(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token: è¿”å›å€¼:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, result); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//jsonè½‰ç‚ºmap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String,String&amp;gt; resultMap = JSON.parseObject(result, Map.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; resultMap; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;6ï¸âƒ£getUserinfo, æ”œå¸¶ä»¤ç‰ŒæŸ¥è©¢ç”¨æˆ¶ä¿¡æ¯ï¼Œé—œéµ url çš„åƒæ•¸ç”¨ % s ä½”ä½ï¼ŒæŠŠä»¤ç‰Œç²å¾—çš„å€¼å¡«ä¸Š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; Map&amp;lt;String,String&amp;gt; &lt;span class=&#34;title function_&#34;&gt;getUserinfo&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String access_token,String openid)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;wxUrl_template&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;https://api.weixin.qq.com/sns/userinfo?access_token=%s&amp;amp;openid=%s&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è¯·æ±‚å¾®ä¿¡åœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;wxUrl&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; String.format(wxUrl_template, access_token,openid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token, url:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, wxUrl); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ResponseEntity&amp;lt;String&amp;gt; exchange = restTemplate.exchange(wxUrl, HttpMethod.POST, &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;, String.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//é˜²æ­¢ä¹±ç è¿›è¡Œè½¬ç  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;String&lt;/span&gt;(exchange.getBody().getBytes(StandardCharsets.ISO_8859_1),StandardCharsets.UTF_8); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;è°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token: è¿”å›å€¼:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, result); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String,String&amp;gt; resultMap = JSON.parseObject(result, Map.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; resultMap; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å„²å­˜ä½¿ç”¨è€…è³‡è¨Š&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å„²å­˜ä½¿ç”¨è€…è³‡è¨Š&#34;&gt;#&lt;/a&gt; å„²å­˜ä½¿ç”¨è€…è³‡è¨Š&lt;/h2&gt;
&lt;p&gt;å‘è³‡æ–™åº«ä¿å­˜ä½¿ç”¨è€…è¨Šæ¯ï¼Œå¦‚æœä½¿ç”¨è€…ä¸å­˜åœ¨å°‡å…¶ä¿å­˜åœ¨è³‡æ–™åº«ä¸­ï¼Œäº‹å‹™æ§åˆ¶&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;XcUserRoleMapper xcUserRoleMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Transactional&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;addWxUser&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Map userInfo_map)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;unionid&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; userInfo_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;unionid&amp;quot;&lt;/span&gt;).toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ ¹æ®unionidæŸ¥è¯¢æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getWxUnionid, unionid)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(xcUser!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userId&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; UUID.randomUUID().toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUser&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setId(userId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setWxUnionid(unionid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è®°å½•ä»å¾®ä¿¡å¾—åˆ°çš„æ˜µç§° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setNickname(userInfo_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;nickname&amp;quot;&lt;/span&gt;).toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setUserpic(userInfo_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;headimgurl&amp;quot;&lt;/span&gt;).toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setName(userInfo_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;nickname&amp;quot;&lt;/span&gt;).toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setUsername(unionid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setPassword(unionid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setUtype(&lt;span class=&#34;string&#34;&gt;&amp;quot;101001&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//å­¦ç”Ÿç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setStatus(&lt;span class=&#34;string&#34;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//ç”¨æˆ·çŠ¶æ€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUser.setCreateTime(LocalDateTime.now()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUserMapper.insert(xcUser); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å‘ç”¨æˆ¶è§’è‰²é—œä¿‚è¡¨æ–°å¢è¨˜éŒ„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcUserRole&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUserRole&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUserRole&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUserRole.setId(UUID.randomUUID().toString()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUserRole.setUserId(userId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUserRole.setRoleId(&lt;span class=&#34;string&#34;&gt;&amp;quot;17&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//å­¦ç”Ÿè§’è‰² &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    xcUserRoleMapper.insert(xcUserRole); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;èª¿ç”¨ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼Œ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WxAuthServiceImpl currentProxy; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;wxAuth&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String code)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ”¶åˆ°codeè°ƒç”¨å¾®ä¿¡æ¥å£ç”³è¯·access_token &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String, String&amp;gt; access_token_map = getAccess_token(code); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(access_token_map==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//System.out.println(access_token_map); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;openid&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; access_token_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;openid&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;access_token&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; access_token_map.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;access_token&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æ‹¿access_tokenæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Map&amp;lt;String, String&amp;gt; userinfo = getUserinfo(access_token, openid); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(userinfo==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; currentProxy.addWxUser(userinfo); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;&lt;p&gt;æ³¨æ„ï¼šéäº‹å‹™æ–¹æ³•èª¿ç”¨äº‹å‹™æ–¹æ³•ï¼Œè¦ä½¿ç”¨ä»£ç†ç‰©ä»¶èª¿ç”¨ï¼Œå‰é¢ä¹Ÿæåˆ°é€™é»&lt;br&gt;
é€™è£¡çš„ addWxUser () æ–¹æ³•æ¶‰åŠäº†å¤šè¡¨æ“ä½œï¼Œæ‰€ä»¥éœ€è¦é€²è¡Œäº‹å‹™æ§åˆ¶ï¼Œè€Œ wxAuth () æ˜¯éäº‹å‹™æ–¹æ³•ï¼Œæ‰€ä»¥é€™è£¡æˆ‘å€‘éœ€è¦æ³¨å…¥è‡ªèº«ï¼Œç„¶å¾Œå‘¼å« addWxUser ()&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é‡å•Ÿæœå‹™ï¼Œæƒç¢¼ç™»å…¥æ¸¬è©¦ï¼Œç™»å…¥æˆåŠŸï¼Œä¸¦åœ¨æ•¸æ“šåº«è¨˜éŒ„äº†å¾®ä¿¡ç”¨æˆ¶çš„ä¿¡æ¯ï¼&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/20.png&#34; class=&#34;abc&#34;&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/21.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;&lt;span class=&#34;rainbow&#34;&gt;ç¸½çµ&lt;/span&gt;:&lt;br&gt;
1ï¸âƒ£å¾å¾®ä¿¡æ‹¿åˆ° JS æ–‡ä»¶ä»£ç¢¼åœ¨å‰ç«¯é¡¯ç¤ºï¼Œç•¶ç”¨æˆ¶æƒç¢¼åŒæ„å¾Œï¼Œurl æœƒé‡å®šå‘æˆ‘å€‘æŒ‡å®šçš„åœ°å€&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;var obj = new WxLogin(&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;self_redirect:true, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;id:&amp;quot;login_container&amp;quot;,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;appid: &amp;quot;ç¶²ç«™æ‡‰ç”¨å¯©æ ¸é€šéå¾Œç²å¾—&amp;quot;,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;scope: &amp;quot;&amp;quot;,  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redirect_uri: http://localhost:8160/auth/wxLogin&amp;quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; state: &amp;quot;&amp;quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;style: &amp;quot;&amp;quot;, &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;href: &amp;quot;&amp;quot; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;); &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£æœƒé‡å®šå‘æœ¬é …ç›® wxLogin çš„ API, åŸ·è¡Œ wxAuth æ–¹æ³•&lt;br&gt;
3ï¸âƒ£wxAuth æ–¹æ³•æœƒç”¨ restTemplate é ç¨‹èª¿ç”¨å¾®ä¿¡æ¥å£ï¼šç”³è«‹ä»¤ç‰Œã€æ‹¿è‘—ä»¤ç‰ŒæŸ¥è©¢ç”¨æˆ¶ä¿¡æ¯ï¼Œä¸¦ä¿å­˜åˆ°æˆ‘å€‘çš„æ•¸æ“šåº«&lt;br&gt;
4ï¸âƒ£åŸ·è¡Œå®Œ wxAuth æ–¹æ³•ï¼Œå› ç‚ºæˆ‘å€‘æ•¸æ“šåº«å·²æœ‰ç”¨æˆ¶ä¿¡æ¯ï¼Œæ‰€ä»¥æœ€å¾Œæœƒé‡å®šå‘åˆ°é …ç›®çš„çµ±ä¸€èªè­‰ç™»éŒ„å…¥å£ï¼Œä¸¦åŸ·è¡Œ execute æ–¹æ³•è‡ªå‹•ç™»å…¥&lt;/p&gt;
 &lt;img data-src=&#34;https://i.makeagif.com/media/9-15-2015/bQkqor.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;
</content>
        <category term="SpringSecurity" />
        <updated>2023-11-03T15:39:05.235Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/10/30/java/SpringSecurity/SpringSecurity</id>
        <title>SpringSecurity èªè­‰æˆæ¬Š</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/10/30/java/SpringSecurity/SpringSecurity"/>
        <content type="html">&lt;p&gt;åœ¨æ­¤ç‰¹åˆ«æ„Ÿè¬é»‘é¦¬ç¨‹åºå“¡æä¾›çš„èª²ç¨‹: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWo4NDExTjdCbS8=&#34;&gt;å­¸æˆåœ¨ç·š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰è¨€&lt;br&gt;
æ–¼ç”±å¯¦ç¿’é …ç›®å¿«åšå®Œæ‰åšè¨˜éŒ„ï¼Œè€Œä¸”é …ç›®æ¨¡å¡Šè¼ƒå¤šï¼Œæ•…æŒ‘éƒ¨ä»½ä¾†è¨˜éŒ„ï¼Œæ‰€ä»¥é€™éä¸»è¦æ˜¯ SpringSecurity å…§å®¹ã€‚&lt;br&gt;
&lt;span class=&#34;rainbow&#34;&gt;å®Œæ•´é¡¹ç›®åœ°å€&lt;/span&gt;ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3N1cGVycmpvaG4vamF2YV93ZWI=&#34;&gt;https://github.com/superrjohn/java_web&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;æ¨¡å¡Šéœ€æ±‚åˆ†æ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¨¡å¡Šéœ€æ±‚åˆ†æ&#34;&gt;#&lt;/a&gt; æ¨¡å¡Šéœ€æ±‚åˆ†æ&lt;/h1&gt;
&lt;p&gt;ä»€éº¼æ˜¯èªè­‰æˆæ¬Šï¼Ÿ&lt;br&gt;
&lt;span class=&#34;yellow&#34;&gt; ä»€éº¼æ˜¯èªè­‰ï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;èªè­‰å³ä½¿ç”¨è€…å»å­˜å–ç³»çµ±è³‡æºæ™‚ç³»çµ±è¦æ±‚é©—è­‰ä½¿ç”¨è€…çš„èº«åˆ†è¨Šæ¯ï¼Œèº«åˆ†åˆæ³•æ–¹å¯ç¹¼çºŒå­˜å–ã€‚ å¸¸è¦‹çš„ç”¨æˆ¶èº«ä»½èªè­‰çš„è¡¨ç¾å½¢å¼æœ‰ï¼šç”¨æˆ¶åå¯†ç¢¼ç™»éŒ„ï¼Œå¾®ä¿¡æƒç¢¼ç­‰æ–¹å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span class=&#34;yellow&#34;&gt;ä»€éº¼æ˜¯æˆæ¬Šï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ä½¿ç”¨è€…èªè­‰é€šéå¾Œå»å­˜å–ç³»çµ±çš„è³‡æºï¼Œç³»çµ±æœƒåˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦æ“æœ‰å­˜å–è³‡æºçš„æ¬Šé™ï¼Œåªå…è¨±å­˜å–æœ‰æ¬Šé™çš„ç³»çµ±è³‡æºï¼Œæ²’æœ‰æ¬Šé™çš„è³‡æºå°‡ç„¡æ³•å­˜å–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ¥­å‹™æµç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ¥­å‹™æµç¨‹&#34;&gt;#&lt;/a&gt; æ¥­å‹™æµç¨‹&lt;/h2&gt;
&lt;p&gt;1ï¸âƒ£çµ±ä¸€èªè­‰ï¼šè¨ˆç•«åŒ…æ‹¬å­¸ç”Ÿã€å­¸ç¿’æ©Ÿæ§‹çš„è€å¸«ã€å¹³å°ç‡Ÿé‹äººå“¡ä¸‰é¡ç”¨æˆ¶ï¼Œä¸‰é¡ç”¨æˆ¶å°‡ä½¿ç”¨çµ±ä¸€çš„èªè­‰å…¥å£ã€‚&lt;/p&gt;
 &lt;img data-src=&#34;/John/img/java/SpringSecurity/2.png&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;
&lt;p&gt;2ï¸âƒ£å–®é»ç™»é™¸ï¼šå–®ä¸€ç™»å…¥ï¼ˆSingle Sign Onï¼‰ï¼Œç°¡ç¨± SSOï¼Œæ˜¯ç›®å‰è¼ƒæµè¡Œçš„ä¼æ¥­æ¥­å‹™æ•´åˆçš„è§£æ±ºæ–¹æ¡ˆä¹‹ä¸€ã€‚ SSO çš„å®šç¾©æ˜¯åœ¨å¤šå€‹æ‡‰ç”¨ç³»çµ±ä¸­ï¼Œä½¿ç”¨è€…åªéœ€è¦ç™»å…¥ä¸€æ¬¡å°±å¯ä»¥å­˜å–æ‰€æœ‰äº’ä¿¡çš„æ‡‰ç”¨ç³»çµ±ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ç¬¬ä¸‰æ–¹èªè­‰ï¼šæƒç¢¼ç™»å…¥çš„åŠŸèƒ½ï¼Œå¦‚ï¼šå¾®ä¿¡æƒç¢¼ç™»å…¥ã€QQ æƒç¢¼ç™»å…¥ç­‰ã€‚ æƒç¢¼ç™»å…¥çš„å¥½è™•æ˜¯ç”¨æˆ¶ä¸ç”¨è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼ï¼Œçœå»ç”¨æˆ¶è¨»å†Šçš„æˆæœ¬ï¼Œæ˜¯ä¸€ç¨®éå¸¸æœ‰æ•ˆçš„æ¨å»£æ‰‹æ®µã€‚&lt;/p&gt;
&lt;h1 id=&#34;spring-security-èªè­‰ç ”ç©¶&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#spring-security-èªè­‰ç ”ç©¶&#34;&gt;#&lt;/a&gt; Spring Security èªè­‰ç ”ç©¶&lt;/h1&gt;
&lt;h2 id=&#34;spring-securityä»‹ç´¹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#spring-securityä»‹ç´¹&#34;&gt;#&lt;/a&gt; Spring Security ä»‹ç´¹&lt;/h2&gt;
&lt;p&gt;èªè­‰åŠŸèƒ½å¹¾ä¹æ˜¯æ¯å€‹å°ˆæ¡ˆéƒ½è¦å…·å‚™çš„åŠŸèƒ½ï¼Œè€Œä¸”å®ƒèˆ‡æ¥­å‹™ç„¡é—œï¼Œå¸‚é¢ä¸Šæœ‰è¨±å¤šèªè­‰æ¡†æ¶ï¼Œä¾‹å¦‚ï¼šApache Shiroã€CASã€Spring Security ç­‰ã€‚ ç”±æ–¼æœ¬å°ˆæ¡ˆæ˜¯åŸºæ–¼ Spring Cloud æŠ€è¡“æ§‹å»ºï¼ŒSpring Security æ˜¯ spring å®¶æ—çš„ä¸€ä»½å­ä¸”å’Œ Spring Cloud æ•´åˆçš„å¾ˆå¥½ï¼Œå› æ­¤æœ¬å°ˆæ¡ˆé¸ç”¨ Spring Security ä½œç‚ºèªè­‰æœå‹™çš„æŠ€è¡“æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;Spring Security æ˜¯ä¸€å€‹åŠŸèƒ½å¼·å¤§ä¸”é«˜åº¦å¯è‡ªè¨‚çš„èº«ä»½é©—è­‰å’Œå­˜å–æ§åˆ¶æ¡†æ¶ï¼Œå®ƒæ˜¯ä¸€å€‹å°ˆæ³¨æ–¼ç‚º Java æ‡‰ç”¨ç¨‹å¼æä¾›èº«ä»½é©—è­‰å’Œæˆæ¬Šçš„æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;å°ˆæ¡ˆé¦–é ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLXNlY3VyaXR5&#34;&gt;https://spring.io/projects/spring-security&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Spring cloud Securityï¼š &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWNsb3VkLXNlY3VyaXR5&#34;&gt;https://spring.io/projects/spring-cloud-security&lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&#34;èªè­‰æˆæ¬Šå…¥é–€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#èªè­‰æˆæ¬Šå…¥é–€&#34;&gt;#&lt;/a&gt; èªè­‰æˆæ¬Šå…¥é–€&lt;/h3&gt;
&lt;p&gt;1ï¸âƒ£éƒ¨ç½²èªè­‰æœå‹™å·¥ç¨‹&lt;/p&gt;
&lt;p&gt;å¾èª²ç¨‹è³‡æ–™æ‹·è² xuecheng-plus-auth å·¥ç¨‹åˆ°è‡ªå·±çš„å·¥ç¨‹ç›®éŒ„ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å·¥ç¨‹æ˜¯ä¸€å€‹æ™®é€šçš„ spring boot å·¥ç¨‹ï¼Œå¯ä»¥é€£æ¥è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å·¥ç¨‹ä¸å…·å‚™èªè­‰æˆæ¬Šçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å»ºç«‹è³‡æ–™åº«&lt;/p&gt;
&lt;p&gt;å»ºç«‹ xc_users è³‡æ–™åº«&lt;/p&gt;
&lt;p&gt;åŒ¯å…¥èª²ç¨‹è³‡æ–™ä¸­çš„ xcplus_users.sql è…³æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œåœ¨ nacos è¨»å†Šï¼Œç«¯å£ç‚º 63070&lt;/p&gt;
&lt;h3 id=&#34;èªè­‰æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#èªè­‰æ¸¬è©¦&#34;&gt;#&lt;/a&gt; èªè­‰æ¸¬è©¦&lt;/h3&gt;
&lt;p&gt;1ï¸âƒ£ä¸‹é‚Šå‘ auth èªè­‰å·¥ç¨‹æ•´åˆ Spring securityï¼Œå‘ pom.xml åŠ å…¥ Spring Security æ‰€éœ€çš„ä¾è³´&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;pom.xml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-security&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-oauth2&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£åˆå§‹å·¥ç¨‹è‡ªå‚™äº†ä¸€å€‹ Controller é¡ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@RestController&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LoginController&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  XcUserMapper userMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/login-success&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;loginSuccess&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;ç™»å½•æˆåŠŸ&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/user/&amp;#123;id&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;getuser&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@PathVariable(&amp;quot;id&amp;quot;)&lt;/span&gt; String id)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; userMapper.selectById(id); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/r/r1&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;r1&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;è®¿é—®r1èµ„æº&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/r/r2&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;r2&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;è®¿é—®r2èµ„æº&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£åœ¨è³‡æ–™ä¸­æ‰¾åˆ° WebSecurityConfig è¨­å®šé¡æ”¾åˆ°æœ¬å·¥ç¨‹ä¸­ï¼Œå®ƒç¹¼æ‰¿ WebSecurityConfigurerAdapter, å®ƒæœ‰ä¸‰éƒ¨ä»½å…§å®¹:&lt;br&gt;
1. ç”¨æˆ¶è³‡è¨Šï¼šåœ¨è¨˜æ†¶é«”é…ç½®å…©å€‹ä½¿ç”¨è€…ï¼šzhangsanã€lisi,zhangsan ä½¿ç”¨è€…æ“æœ‰çš„æ¬Šé™ç‚º p1,lisi ä½¿ç”¨è€…æ“æœ‰çš„æ¬Šé™ç‚º p2&lt;/p&gt;
&lt;p&gt;2ã€å¯†ç¢¼æ–¹å¼ï¼šæš«æ™‚æ¡ç”¨æ˜æ–‡æ–¹å¼&lt;/p&gt;
&lt;p&gt;3. å®‰å…¨æ””æˆªæ©Ÿåˆ¶:/r/** é–‹é ­çš„è«‹æ±‚éœ€è¦èªè­‰ï¼Œç™»å…¥æˆåŠŸåˆ°æˆåŠŸé é¢ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//é…ç½®ç”¨æˆ·ä¿¡æ¯æœåŠ¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetailsService &lt;span class=&#34;title function_&#34;&gt;userDetailsService&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;InMemoryUserDetailsManager&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;manager&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;InMemoryUserDetailsManager&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        manager.createUser(User.withUsername(&lt;span class=&#34;string&#34;&gt;&amp;quot;zhangsan&amp;quot;&lt;/span&gt;).password(&lt;span class=&#34;string&#34;&gt;&amp;quot;123&amp;quot;&lt;/span&gt;).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;p1&amp;quot;&lt;/span&gt;).build()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        manager.createUser(User.withUsername(&lt;span class=&#34;string&#34;&gt;&amp;quot;lisi&amp;quot;&lt;/span&gt;).password(&lt;span class=&#34;string&#34;&gt;&amp;quot;456&amp;quot;&lt;/span&gt;).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;p2&amp;quot;&lt;/span&gt;).build()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; manager; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PasswordEncoder &lt;span class=&#34;title function_&#34;&gt;passwordEncoder&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å¯†ç ä¸ºæ˜æ–‡æ–¹å¼ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; NoOpPasswordEncoder.getInstance(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//é…ç½®å®‰å…¨æ‹¦æˆªæœºåˆ¶ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(HttpSecurity http)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        http &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .authorizeRequests() &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .antMatchers(&lt;span class=&#34;string&#34;&gt;&amp;quot;/r/**&amp;quot;&lt;/span&gt;).authenticated()&lt;span class=&#34;comment&#34;&gt;//è®¿é—®/rå¼€å§‹çš„è¯·æ±‚éœ€è¦è®¤è¯é€šè¿‡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .anyRequest().permitAll()&lt;span class=&#34;comment&#34;&gt;//å…¶å®ƒè¯·æ±‚å…¨éƒ¨æ”¾è¡Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .and() &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .formLogin().successForwardUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;/login-success&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//ç™»å½•æˆåŠŸè·³è½¬åˆ°/login-success &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                http.logout().logoutUrl(&lt;span class=&#34;string&#34;&gt;&amp;quot;/logout&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//é€€å‡ºåœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1. è¨ªå• localhost:63070/auth/login&lt;br&gt;
2. è¼¸å…¥å¸³è™Ÿ zhangsan, å¯†ç¢¼ 123&lt;br&gt;
3. ç™»éŒ„æˆåŠŸå¾Œï¼Œé é¢æœƒè·³è½‰ï¼Œé€™æ¨£èªè­‰èº«ä»½å°±å®Œæˆäº†&lt;/p&gt;
&lt;p&gt;4ï¸âƒ£æ·»åŠ æˆæ¬Š&lt;br&gt;
ğŸ”´ä½¿ç”¨è€…èªè­‰é€éå»å­˜å–ç³»çµ±è³‡æºæ™‚ spring security é€²è¡Œæˆæ¬Šæ§åˆ¶ï¼Œåˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦æœ‰è©²è³‡æºçš„å­˜å–æ¬Šé™ï¼Œå¦‚æœæœ‰å‰‡ç¹¼çºŒè¨ªå•ï¼Œå¦‚æœæ²’æœ‰å‰‡æ‹’çµ•å­˜å–ã€‚&lt;br&gt;
1. åœ¨ WebSecurityConfig é¡åˆ¥è¨­å®š zhangsan æ“æœ‰ p1 æ¬Šé™ï¼Œlisi æ“æœ‰ p2 æ¬Šé™ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetailsService &lt;span class=&#34;title function_&#34;&gt;userDetailsService&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;InMemoryUserDetailsManager&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;manager&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;InMemoryUserDetailsManager&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    manager.createUser(User.withUsername(&lt;span class=&#34;string&#34;&gt;&amp;quot;zhangsan&amp;quot;&lt;/span&gt;).password(&lt;span class=&#34;string&#34;&gt;&amp;quot;123&amp;quot;&lt;/span&gt;).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;p1&amp;quot;&lt;/span&gt;).build()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    manager.createUser(User.withUsername(&lt;span class=&#34;string&#34;&gt;&amp;quot;lisi&amp;quot;&lt;/span&gt;).password(&lt;span class=&#34;string&#34;&gt;&amp;quot;456&amp;quot;&lt;/span&gt;).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;p2&amp;quot;&lt;/span&gt;).build()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; manager; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2. åœ¨ controller ä¸­é…ç½® /r/r1 éœ€è¦ p1 æ¬Šé™ï¼Œ/r/r2 éœ€è¦ p2 æ¬Šé™ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@RestController&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LoginController&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    .... &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/r/r1&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@PreAuthorize(&amp;quot;hasAuthority(&amp;#x27;p1&amp;#x27;)&amp;quot;)&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//æ‹¥æœ‰p1æƒé™æ–¹å¯è®¿é—® &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;r1&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;è®¿é—®r1èµ„æº&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@RequestMapping(&amp;quot;/r/r2&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@PreAuthorize(&amp;quot;hasAuthority(&amp;#x27;p2&amp;#x27;)&amp;quot;)&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//æ‹¥æœ‰p2æƒé™æ–¹å¯è®¿é—® &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; String &lt;span class=&#34;title function_&#34;&gt;r2&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;è®¿é—®r2èµ„æº&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ... &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¾åœ¨ç•¶ç”¨æˆ¶è¨ªå• /r/r1 æ™‚ï¼Œurl æœƒåˆ¤æ–·ç”¨æˆ¶æœ‰æ²’æœ‰è¨ªå•æ¬Šé™ p1, æ‰€ä»¥ zhangsan å¯ä»¥æˆåŠŸè¨ªå•ï¼Œè€Œ lisi ä¸èƒ½ï¼Œå› ç‚º lisi çš„æ¬Šé™ç‚º p2&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/r1r2.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;5ï¸âƒ£å·¥ä½œåŸç†&lt;br&gt;
 Spring Security å° Web è³‡æºçš„ä¿è­·æ˜¯é  Filter å¯¦ç¾çš„ï¼Œæ‰€ä»¥å¾é€™å€‹ Filter ä¾†å…¥æ‰‹ï¼Œé€æ­¥æ·±å…¥ Spring Security åŸç†ã€‚ ç•¶åˆå§‹åŒ– Spring Security æ™‚ï¼Œæœƒå»ºç«‹ä¸€å€‹åç‚º SpringSecurityFilterChain çš„ Servlet éæ¿¾å™¨ï¼Œé¡å‹ç‚º org.springframework.security.web.FilterChainProxyï¼Œå®ƒå¯¦ä½œäº† javax.servlet.Filterï¼Œå› æ­¤å¤–éƒ¨çš„è¦æ±‚æœƒç¶“éæ­¤é¡ï¼Œä¸‹åœ–æ˜¯ Spring Security éæ…®å™¨éˆçµæ§‹åœ–ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/3.png&#34; class=&#34;abc&#34; width=&#34;400&#34; height=&#34;300&#34;&gt;
&lt;p&gt;FilterChainProxy æ˜¯ä¸€å€‹ä»£ç†ï¼ŒçœŸæ­£é‹ä½œçš„æ˜¯ FilterChainProxy ä¸­ SecurityFilterChain æ‰€åŒ…å«çš„å„å€‹ Filterï¼Œè€Œ Filter ä¸æœƒç›´æ¥è™•ç†èªè­‰å’Œæˆæ¬Šï¼Œè€Œæ˜¯æŠŠå®ƒå€‘äº¤çµ¦äº†èªè­‰ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰å’Œæ±ºç­–ç®¡ç†å™¨ï¼ˆAccessDecisionManagerï¼‰é€²è¡Œè™•ç†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;oauth2èªè­‰æµç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#oauth2èªè­‰æµç¨‹&#34;&gt;#&lt;/a&gt; OAuth2 èªè­‰æµç¨‹&lt;/h1&gt;
&lt;p&gt;åœ¨å‰é‚Šæˆ‘å€‘æåˆ°å¾®ä¿¡æƒç¢¼èªè­‰ï¼Œé€™æ˜¯ä¸€ç¨®ç¬¬ä¸‰æ–¹èªè­‰çš„æ–¹å¼ï¼Œé€™ç¨®èªè­‰æ–¹å¼æ˜¯åŸºæ–¼ OAuth2 å”å®šå¯¦ç¾ï¼Œ&lt;/p&gt;
&lt;p&gt;OAUTH å”å®šç‚ºä½¿ç”¨è€…è³‡æºçš„æˆæ¬Šæä¾›äº†ä¸€å€‹å®‰å…¨çš„ã€é–‹æ”¾è€Œåˆç°¡æ˜“çš„æ¨™æº–ã€‚ åŒæ™‚ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹éƒ½å¯ä»¥ä½¿ç”¨ OAUTH èªè­‰æœå‹™ï¼Œä»»ä½•æœå‹™æä¾›è€…éƒ½å¯ä»¥å¯¦ç¾è‡ªèº«çš„ OAUTH èªè­‰æœå‹™ï¼Œå› è€Œ OAUTH æ˜¯é–‹æ”¾çš„ã€‚ æ¥­ç•Œæä¾›äº† OAUTH çš„å¤šç¨®å¯¦ä½œå¦‚ PHPã€JavaScriptï¼ŒJavaï¼ŒRuby ç­‰å„ç¨®èªè¨€é–‹ç™¼åŒ…ï¼Œå¤§å¤§ç¯€çœäº†ç¨‹å¼è¨­è¨ˆå¸«çš„æ™‚é–“ï¼Œå› è€Œ OAUTH æ˜¯ç°¡æ˜“çš„ã€‚ ç¶²è·¯è¨±å¤šæœå‹™å¦‚ Open APIï¼Œè¨±å¤šå¤§å…¬å¸å¦‚ç©€æ­Œï¼ŒYahooï¼ŒMicrosoft ç­‰éƒ½æä¾›äº† OAUTH èªè­‰æœå‹™ï¼Œé€™äº›éƒ½è¶³ä»¥èªªæ˜ OAUTH æ¨™æº–é€æ¼¸æˆç‚ºé–‹æ”¾è³‡æºæˆæ¬Šçš„æ¨™æº–ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;     Oauthå”å®šç›®å‰ç™¼å±•åˆ°2.0ç‰ˆæœ¬ï¼Œ1.0ç‰ˆæœ¬éæ–¼è¤‡é›œï¼Œ2.0ç‰ˆæœ¬å·²å»£æ³›æ‡‰ç”¨ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åƒè€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9vQXV0aC83MTUzMTM0P2ZyPWFsYWRkaW4=&#34;&gt;https://baike.baidu.com/item/oAuth/7153134?fr=aladdin&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Oauth å”è­°ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzY3NDk=&#34;&gt;https://tools.ietf.org/html/rfc6749&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ç¾åœ¨ææ¸…æ¥šå¹¾å€‹æ¦‚å¿µï¼š&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;è³‡æº&lt;/span&gt;ï¼šä½¿ç”¨è€…è¨Šæ¯ï¼Œåœ¨å¾®ä¿¡ä¸­å„²å­˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;è³‡æºæ“æœ‰è€…&lt;/span&gt;ï¼šä½¿ç”¨è€…æ˜¯ä½¿ç”¨è€…è³‡è¨Šè³‡æºçš„æ“æœ‰è€…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;èªè­‰æœå‹™&lt;/span&gt;ï¼šå¾®ä¿¡è² è²¬èªè­‰ç›®å‰ä½¿ç”¨è€…çš„èº«ä»½ï¼Œè² è²¬ç‚ºå®¢æˆ¶ç«¯é ’ç™¼ä»¤ç‰Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;å®¢æˆ¶ç«¯&lt;/span&gt;ï¼šå®¢æˆ¶ç«¯æœƒæ”œå¸¶ä»¤ç‰Œè«‹æ±‚å¾®ä¿¡ç²å–ä½¿ç”¨è€…è¨Šæ¯ï¼Œé»‘é¦¬ç¨‹å¼è¨­è¨ˆå¸«ç¶²ç«™å³å®¢æˆ¶ç«¯ï¼Œé»‘é¦¬ç¶²ç«™éœ€è¦åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/4.png&#34; class=&#34;abc&#34; width=&#34;700&#34; height=&#34;300&#34;&gt;
&lt;p&gt;1. ç”¨æˆ¶é€²å…¥åˆ°ç¶²ç«™æ‰“é–‹æƒç¢¼ç•Œé¢ï¼Œé€²è¡Œå¾®ä¿¡æƒç¢¼&lt;br&gt;
 2. å¾®ä¿¡è¿”å›ä¿¡æ¯ï¼Œè©¢å•ç”¨æˆ¶æ˜¯å¦æˆæ¬Šå®¢æˆ¶ç«¯ä½¿ç”¨å€‹äººè³‡æ–™ï¼Œç”¨æˆ¶æŒ‰åŒæ„&lt;br&gt;
 3. å¾®ä¿¡ä¸‹ç™¼æˆæ¬Šç¢¼ï¼Œç¶²ç«™æ‡‰ç”¨å¸¶è‘—æˆæ¬Šç¢¼ç”³è«‹ä»¤ç‰Œï¼Œå¾®ä¿¡ä¸‹ç™¼ä»¤ç‰Œ (éç¨‹ä¸å¯è¦‹)&lt;br&gt;
 4. ç¶²ç«™æ‡‰ç”¨å¸¶è‘—ä»¤ç‰Œè«‹æ±‚ç”¨æˆ¶å€‹äººä¿¡æ¯ï¼ŒæˆåŠŸä¸¦è¿”å›ç¶²ç«™æ‡‰ç”¨ (éç¨‹ä¸å¯è¦‹)&lt;br&gt;
 5. ç”¨æˆ¶ç™»éŒ„æˆåŠŸ&lt;/p&gt;
&lt;h2 id=&#34;oauth2åœ¨æœ¬é …ç›®çš„æ‡‰ç”¨&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#oauth2åœ¨æœ¬é …ç›®çš„æ‡‰ç”¨&#34;&gt;#&lt;/a&gt; OAuth2 åœ¨æœ¬é …ç›®çš„æ‡‰ç”¨&lt;/h2&gt;
&lt;p&gt;äº†è§£å¾®ä¿¡æƒç¢¼ç™»å…¥é»‘é¦¬ç¶²ç«™çš„æµç¨‹ï¼Œæ¥ä¸‹ä¾†èªè­˜ Oauth2.0 çš„èªè­‰æµç¨‹ï¼Œå¼•è‡ª Oauth2.0 å”å®š rfc6749 &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzY3NDk=&#34;&gt;https://tools.ietf.org/html/rfc6749&lt;/span&gt; ,&lt;br&gt;
Oauth2 æ˜¯ä¸€å€‹æ¨™æº–çš„é–‹æ”¾çš„æˆæ¬Šå”è­°ï¼Œç”¨æ–¼æ‡‰ç”¨ç¨‹å¼éœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹å¹³å°çš„è³‡æºï¼Œæ‡‰ç”¨ç¨‹å¼å¯ä»¥æ ¹æ“šè‡ªå·±çš„è¦æ±‚å»ä½¿ç”¨ Oauth2ï¼Œæœ¬å°ˆæ¡ˆä½¿ç”¨ Oauth2 å¯¦ç¾ä»¥ä¸‹ç›®æ¨™ï¼š&lt;br&gt;
1ï¸âƒ£å­¸æˆåœ¨ç·šä¸Šå­˜å–ç¬¬ä¸‰æ–¹ç³»çµ±çš„è³‡æºã€‚&lt;/p&gt;
&lt;p&gt;æœ¬å°ˆæ¡ˆè¦å­˜å–å¾®ä¿¡æƒç¢¼ç™»å…¥æ‰€ä»¥æœ¬å°ˆæ¡ˆè¦ä½¿ç”¨ OAuth2 å”å®šå­˜å–å¾®ä¿¡ä¸­çš„ä½¿ç”¨è€…è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å¤–éƒ¨ç³»çµ±è¨ªå•å­¸æˆåœ¨ç·šçš„è³‡æº ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ¨£ç•¶ç¬¬ä¸‰æ–¹ç³»çµ±æƒ³è¦å­˜å–å­¸æˆç·šä¸Šç¶²ç«™çš„è³‡æºä¹Ÿå¯ä»¥åŸºæ–¼ OAuth2 å”è­°ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£å­¸æˆç·šä¸Šå‰ç«¯ï¼ˆå®¢æˆ¶ç«¯ï¼‰ å­˜å–å­¸æˆç·šä¸Šå¾®æœå‹™çš„è³‡æºã€‚&lt;/p&gt;
&lt;p&gt;æœ¬å°ˆæ¡ˆæ˜¯å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹ï¼Œå‰ç«¯å­˜å–å¾®æœå‹™è³‡æºä¹Ÿå¯ä»¥åŸºæ–¼ OAuth2 å”å®šé€²è¡Œèªè­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;oauth2çš„æˆæ¬Šæ¨¡å¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#oauth2çš„æˆæ¬Šæ¨¡å¼&#34;&gt;#&lt;/a&gt; OAuth2 çš„æˆæ¬Šæ¨¡å¼&lt;/h2&gt;
&lt;p&gt;Spring Security æ”¯æ´ OAuth2 èªè­‰ï¼ŒOAuth2 æä¾›æˆæ¬Šç¢¼æ¨¡å¼ã€å¯†ç¢¼æ¨¡å¼ã€ç°¡åŒ–æ¨¡å¼ã€å®¢æˆ¶ç«¯æ¨¡å¼ç­‰å››ç¨®æˆæ¬Šæ¨¡å¼ï¼Œæœ¬é …ç›®åªæœƒç”¨æˆæ¬Šç¢¼æ¨¡å¼ã€å¯†ç¢¼æ¨¡å¼ã€‚&lt;br&gt;
æˆæ¬Šç¢¼æ¨¡å¼ç°¡å–®ç­è§£æ˜¯ä½¿ç”¨æˆæ¬Šç¢¼å»å–å¾—ä»¤ç‰Œï¼Œè¦æƒ³å–å¾—ä»¤ç‰Œå…ˆè¦å–å¾—æˆæ¬Šç¢¼ï¼Œæˆæ¬Šç¢¼çš„å–å¾—éœ€è¦è³‡æºæ“æœ‰è€…è¦ªè‡ªæˆæ¬ŠåŒæ„æ‰å¯ä»¥å–å¾—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹åœ–æ˜¯æˆæ¬Šç¢¼æ¨¡å¼çš„äº’å‹•åœ–ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/5.png&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;400&#34;&gt;
&lt;h3 id=&#34;æˆæ¬Šç¢¼æ¨¡å¼æ¸¬è©¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æˆæ¬Šç¢¼æ¨¡å¼æ¸¬è©¦&#34;&gt;#&lt;/a&gt; æˆæ¬Šç¢¼æ¨¡å¼æ¸¬è©¦&lt;/h3&gt;
&lt;p&gt;è‹¥è¦æ¸¬è©¦æˆæ¬Šæ¨¡å¼é¦–å…ˆè¦è¨­å®šæˆæ¬Šä¼ºæœå™¨å³ä¸Šåœ–ä¸­çš„èªè­‰ä¼ºæœå™¨ï¼Œéœ€è¦è¨­å®šæˆæ¬Šæœå‹™åŠä»¤ç‰Œç­–ç•¥ã€‚&lt;br&gt;
1ï¸âƒ£å¾èª²ç¨‹è³‡æ–™æ‹·è² AuthorizationServer.javaã€TokenConfig.java åˆ°èªè­‰æœå‹™çš„ config å¥—ä»¶ä¸‹ã€‚&lt;br&gt;
èªªæ˜ï¼šAuthorizationServer ç”¨ @EnableAuthorizationServer è¨»è§£æ¨™è­˜ä¸¦ç¹¼æ‰¿ AuthorizationServerConfigurerAdapter ä¾†è¨­å®š OAuth2.0 æˆæ¬Šä¼ºæœå™¨ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Configuration&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@EnableAuthorizationServer&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthorizationServer&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthorizationServerConfigurerAdapter&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;... &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£AuthorizationServerConfigurerAdapter è¦æ±‚é…ç½®ä»¥ä¸‹å¹¾å€‹é¡åˆ¥ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthorizationServerConfigurerAdapter&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthorizationServerConfigurer&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;AuthorizationServerConfigurerAdapter&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthorizationServerSecurityConfigurer security)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(ClientDetailsServiceConfigurer clients)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthorizationServerEndpointsConfigurer endpoints)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1ï¼‰ClientDetailsServiceConfigurerï¼šç”¨ä¾†è¨­å®šå®¢æˆ¶ç«¯è©³æƒ…æœå‹™ï¼ˆClientDetailsServiceï¼‰ï¼Œ&lt;/p&gt;
&lt;p&gt;éš¨ä¾¿ä¸€å€‹å®¢æˆ¶ç«¯éƒ½å¯ä»¥éš¨ä¾¿æ¥å–å®ƒçš„èªè­‰æœå‹™å—ï¼Ÿ ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæœå‹™æä¾›è€…æœƒçµ¦æ‰¹å‡†å­˜å–çš„å®¢æˆ¶ç«¯ä¸€å€‹èº«ä»½ï¼Œç”¨æ–¼å­˜å–æ™‚çš„æ†‘è­‰ï¼Œæœ‰å®¢æˆ¶ç«¯æ¨™è­˜å’Œå®¢æˆ¶ç«¯ç§˜é‘°ï¼Œåœ¨é€™è£¡é…ç½®æ‰¹å‡†å­˜å–çš„å®¢æˆ¶ç«¯çš„è©³ç´°è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;2ï¼‰AuthorizationServerEndpointsConfigurerï¼šç”¨ä¾†è¨­å®šä»¤ç‰Œï¼ˆtokenï¼‰çš„å­˜å–ç«¯é»å’Œä»¤ç‰Œæœå‹™ (token services)ã€‚&lt;/p&gt;
&lt;p&gt;3ï¼‰AuthorizationServerSecurityConfigurerï¼šç”¨ä¾†è¨­å®šä»¤ç‰Œç«¯é»çš„å®‰å…¨æ€§é™åˆ¶.&lt;/p&gt;
&lt;p&gt;2ã€TokenConfig ç‚ºä»¤ç‰Œç­–ç•¥é…ç½®é¡&lt;/p&gt;
&lt;p&gt;æš«æ™‚å…ˆä½¿ç”¨ InMemoryTokenStore åœ¨è¨˜æ†¶é«”å„²å­˜ä»¤ç‰Œï¼Œä»¤ç‰Œçš„æœ‰æ•ˆæœŸé™ç­‰è³‡è¨Šé…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//ä»¤ç‰Œç®¡ç†æœåŠ¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Bean(name=&amp;quot;authorizationServerTokenServicesCustom&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; AuthorizationServerTokenServices &lt;span class=&#34;title function_&#34;&gt;tokenService&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    DefaultTokenServices service=&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultTokenServices&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    service.setSupportRefreshToken(&lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//æ”¯æŒåˆ·æ–°ä»¤ç‰Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    service.setTokenStore(tokenStore);&lt;span class=&#34;comment&#34;&gt;//ä»¤ç‰Œå­˜å‚¨ç­–ç•¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    service.setAccessTokenValiditySeconds(&lt;span class=&#34;number&#34;&gt;7200&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;// ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ2å°æ—¶ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    service.setRefreshTokenValiditySeconds(&lt;span class=&#34;number&#34;&gt;259200&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;// åˆ·æ–°ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ3å¤© &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; service; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£é…ç½®èªè­‰ç®¡ç† bean&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@EnableWebSecurity&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WebSecurityConfig&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WebSecurityConfigurerAdapter&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; AuthenticationManager &lt;span class=&#34;title function_&#34;&gt;authenticationManagerBean&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;built_in&#34;&gt;super&lt;/span&gt;.authenticationManagerBean(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    .... &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;4ï¸âƒ£é‡å•Ÿèªè­‰æœå‹™&lt;/p&gt;
&lt;p&gt;1.get è«‹æ±‚å–å¾—æˆæ¬Šç¢¼&lt;/p&gt;
&lt;p&gt;ä½å€: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL2xvY2FsaG9zdDo2MzA3MC9hdXRoL29hdXRoL2F1dGhvcml6ZT9jbGllbnRfaWQ9WGNXZWJBcHAmYW1wO3Jlc3BvbnNlX3R5cGU9Y29kZSZhbXA7c2NvcGU9YWxsJmFtcDtyZWRpcmVjdF91cmk9aHR0cDovL3d3dy41MXh1ZWNoZW5nLmNu&#34;&gt;http://localhost:63070/auth/oauth/authorize?client_id=XcWebApp&amp;amp;response_type=code&amp;amp;scope=all&amp;amp;redirect_uri=http://www.51xuecheng.cn&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åƒæ•¸åˆ—è¡¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;client_idï¼šå®¢æˆ¶ç«¯å‡†å…¥æ¨™è­˜ã€‚&lt;/p&gt;
&lt;p&gt;response_typeï¼šæˆæ¬Šç¢¼æ¨¡å¼å›ºå®šç‚º codeã€‚&lt;/p&gt;
&lt;p&gt;scopeï¼šå®¢æˆ¶ç«¯æ¬Šé™ã€‚&lt;/p&gt;
&lt;p&gt;redirect_uriï¼šè·³è½‰ uriï¼Œæˆæ¬Šç¢¼ç”³è«‹æˆåŠŸå¾Œæœƒè·³åˆ°æ­¤ä½å€ï¼Œå¾Œé‚Šå¸¶ä¸Š code åƒæ•¸ï¼ˆæˆæ¬Šç¢¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¼¸å…¥å¸³è™Ÿ zhangsanã€å¯†ç¢¼ 123 ç™»å…¥æˆåŠŸï¼Œè¼¸å…¥ /oauth/authorize?client_id=XcWebApp&amp;amp;response_type=code&amp;amp;scope=all&amp;amp;redirect_uri=&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy41MXh1ZWNoZW5nLmNu&#34;&gt;http://www.51xuecheng.cn&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;é¡¯ç¤ºæˆæ¬Šé é¢&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/6.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;æˆæ¬Šã€ŒXcWebAppã€å­˜å–è‡ªå·±çš„å—ä¿è­·è³‡æºï¼Ÿ&lt;/p&gt;
&lt;p&gt;é¸æ“‡åŒæ„ã€‚&lt;/p&gt;
&lt;p&gt;2. è«‹æ±‚æˆåŠŸï¼Œé‡æ–°å°å‘è‡³&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy41MXh1ZWNoZW5nLmNuLz9jb2RlPSVFNiU4RSU4OCVFNiVBQyU4QSVFNyVBMiVCQyVFRiVCQyU4QyVFNCVCRSU4QiVFNSVBNiU4MiVFRiVCQyU5QWh0dHA6Ly93d3cuNTF4dWVjaGVuZy5jbi8/Y29kZT1XcWpiNUg=&#34;&gt; http://www.51xuecheng.cn/?code = æˆæ¬Šç¢¼ï¼Œä¾‹å¦‚ï¼šhttp://www.51xuecheng.cn/?code=Wqjb5H&lt;/span&gt;&lt;br&gt;
3. ä½¿ç”¨ httpclient å·¥å…· post ç”³è«‹ä»¤ç‰Œ&lt;/p&gt;
&lt;p&gt;/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=authorization_code&amp;amp;code = æˆæ¬Šç¢¼ &amp;amp; redirect_uri=&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy41MXh1ZWNoZW5nLmNuLw==&#34;&gt;http://www.51xuecheng.cn/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åƒæ•¸åˆ—è¡¨å¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;client_idï¼šå®¢æˆ¶ç«¯å‡†å…¥æ¨™è­˜ã€‚&lt;/p&gt;
&lt;p&gt;client_secretï¼šå®¢æˆ¶ç«¯ç§˜é‘°ã€‚&lt;/p&gt;
&lt;p&gt;grant_typeï¼šæˆæ¬Šé¡å‹ï¼Œå¡«å…¥ authorization_codeï¼Œè¡¨ç¤ºæˆæ¬Šç¢¼æ¨¡å¼&lt;/p&gt;
&lt;p&gt;codeï¼šæˆæ¬Šç¢¼ï¼Œå°±æ˜¯å‰›å‰›å–å¾—çš„æˆæ¬Šç¢¼ï¼Œæ³¨æ„ï¼šæˆæ¬Šç¢¼åªä½¿ç”¨ä¸€æ¬¡å°±ç„¡æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ç”³è«‹ã€‚&lt;/p&gt;
&lt;p&gt;redirect_uriï¼šç”³è«‹æˆæ¬Šç¢¼æ™‚çš„è·³åˆ° urlï¼Œä¸€å®šå’Œç”³è«‹æˆæ¬Šç¢¼æ™‚ç”¨çš„ redirect_uri ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;httpclient è…³æœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight text&#34;&gt;&lt;figcaption&gt;&lt;span&gt;text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### ç¬¬äºŒæ­¥ç”³è¯·ä»¤ç‰Œ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/auth/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=authorization_code&amp;amp;code=CTvCrB&amp;amp;redirect_uri=http://www.51xuecheng.cn1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”³è«‹ä»¤ç‰ŒæˆåŠŸå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;access_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;368b1ee7-a9ee-4e9a-aae6-0fcab243aad2&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;token_type&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;bearer&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;refresh_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;3d56e139-0ee6-4ace-8cbe-1311dfaa991f&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;expires_in&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;7199&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;scope&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;all&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;èªªæ˜ï¼š&lt;br&gt;
1ã€access_tokenï¼Œå­˜å–ä»¤ç‰Œï¼Œç”¨æ–¼å­˜å–è³‡æºä½¿ç”¨ã€‚&lt;br&gt;
2ã€token_typeï¼Œbearer æ˜¯åœ¨ RFC6750 ä¸­å®šç¾©çš„ä¸€ç¨® token é¡å‹ï¼Œåœ¨æ”œå¸¶ä»¤ç‰Œå­˜å–è³‡æºæ™‚éœ€è¦åœ¨ head ä¸­åŠ å…¥ bearer ç©ºæ ¼ ä»¤ç‰Œå…§å®¹&lt;br&gt;
 3ã€refresh_tokenï¼Œç•¶ä»¤ç‰Œå¿«éæœŸæ™‚ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œå¯ä»¥å†æ¬¡ç”¢ç”Ÿä»¤ç‰Œã€‚&lt;br&gt;
4ã€expires_inï¼šéæœŸæ™‚é–“ï¼ˆç§’ï¼‰&lt;br&gt;
5ã€scopeï¼Œä»¤ç‰Œçš„æ¬Šé™ç¯„åœï¼Œæœå‹™ç«¯å¯ä»¥æ ¹æ“šä»¤ç‰Œçš„æ¬Šé™ç¯„åœå»å°ä»¤ç‰Œæˆæ¬Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¯†ç¢¼æ¨¡å¼&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¯†ç¢¼æ¨¡å¼&#34;&gt;#&lt;/a&gt; å¯†ç¢¼æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;å¯†ç¢¼æ¨¡å¼ç›¸å°æˆæ¬Šç¢¼æ¨¡å¼ç°¡å–®ï¼Œæˆæ¬Šç¢¼æ¨¡å¼éœ€ä½¿ç”¨ç€è¦½å™¨ä¾›ä½¿ç”¨è€…è¦ªè‡ªæˆæ¬Šï¼Œå¯†ç¢¼æ¨¡å¼ä¸ç”¨ä½¿ç”¨ç€è¦½å™¨&lt;br&gt;
 1. è³‡æºæ“æœ‰è€…æä¾›å¸³è™ŸåŠå¯†ç¢¼&lt;/p&gt;
&lt;p&gt;2ã€å®¢æˆ¶ç«¯å‘èªè­‰æœå‹™ç”³è«‹ä»¤ç‰Œï¼Œè«‹æ±‚ä¸­æ”œå¸¶å¸³è™ŸåŠå¯†ç¢¼&lt;/p&gt;
&lt;p&gt;3ã€èªè­‰æœå‹™æ ¡é©—å¸³è™ŸåŠå¯†ç¢¼æ­£ç¢ºæ ¸ç™¼ä»¤ç‰Œã€‚&lt;br&gt;
1ã€POST è«‹æ±‚å–å¾—ä»¤ç‰Œ&lt;/p&gt;
&lt;p&gt;/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=shangsan&amp;amp;password=123&lt;/p&gt;
&lt;p&gt;åƒæ•¸åˆ—è¡¨å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;client_idï¼šå®¢æˆ¶ç«¯å‡†å…¥æ¨™è­˜ã€‚&lt;/p&gt;
&lt;p&gt;client_secretï¼šå®¢æˆ¶ç«¯ç§˜é‘°ã€‚&lt;/p&gt;
&lt;p&gt;grant_typeï¼šæˆæ¬Šé¡å‹ï¼Œå¡«å…¥ password è¡¨ç¤ºå¯†ç¢¼æ¨¡å¼&lt;/p&gt;
&lt;p&gt;usernameï¼šè³‡æºæ“æœ‰è€…ä½¿ç”¨è€…åç¨±ã€‚&lt;/p&gt;
&lt;p&gt;passwordï¼šè³‡æºæ“æœ‰è€…å¯†ç¢¼ã€‚&lt;/p&gt;
&lt;p&gt;2ã€æˆæ¬Šä¼ºæœå™¨å°‡ä»¤ç‰Œï¼ˆaccess_tokenï¼‰å‚³é€çµ¦ client&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ httpclient é€²è¡Œæ¸¬è©¦&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### å¯†ç æ¨¡å¼ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/auth/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=zhangsan&amp;amp;password=&lt;span class=&#34;number&#34;&gt;123&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿”å›ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;access_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;368b1ee7-a9ee-4e9a-aae6-0fcab243aad2&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;token_type&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;bearer&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;refresh_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;3d56e139-0ee6-4ace-8cbe-1311dfaa991f&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;expires_in&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;6806&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;scope&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;all&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;jwtä»¤ç‰Œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#jwtä»¤ç‰Œ&#34;&gt;#&lt;/a&gt; JWT ä»¤ç‰Œ&lt;/h1&gt;
&lt;h2 id=&#34;æ™®é€šä»¤ç‰Œçš„å•é¡Œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ™®é€šä»¤ç‰Œçš„å•é¡Œ&#34;&gt;#&lt;/a&gt; æ™®é€šä»¤ç‰Œçš„å•é¡Œ&lt;/h2&gt;
&lt;p&gt;å®¢æˆ¶ç«¯ç”³è«‹åˆ°ä»¤ç‰Œï¼Œæ¥ä¸‹ä¾†å®¢æˆ¶ç«¯æ”œå¸¶ä»¤ç‰Œå»å­˜å–è³‡æºï¼Œåˆ°è³‡æºä¼ºæœå™¨å°‡æœƒæ ¡é©—ä»¤ç‰Œçš„åˆæ³•æ€§ã€‚&lt;br&gt;
è³‡æºä¼ºæœå™¨å¦‚ä½•æ ¡é©—ä»¤ç‰Œçš„åˆæ³•æ€§ï¼Ÿæˆ‘å€‘ä»¥ OAuth2 çš„å¯†ç¢¼æ¨¡å¼ç‚ºä¾‹é€²è¡Œèªªæ˜ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/7.png&#34; class=&#34;abc&#34; width=&#34;700&#34; height=&#34;400&#34;&gt;
&lt;p&gt;ğŸ‰é€™è£¡å­˜åœ¨ä¸€å€‹å•é¡Œï¼š&lt;br&gt;
å°±æ˜¯æ ¡é©—ä»¤ç‰Œéœ€è¦é ç«¯è«‹æ±‚èªè­‰æœå‹™ï¼Œå®¢æˆ¶ç«¯çš„æ¯æ¬¡å­˜å–éƒ½æœƒé ç«¯æ ¡é©—ï¼ŒåŸ·è¡Œæ•ˆèƒ½ä½ã€‚&lt;br&gt;
å¦‚æœèƒ½å¤ è®“è³‡æºæœå‹™è‡ªå·±æ ¡é©—ä»¤ç‰Œçš„åˆæ³•æ€§å°‡çœå»é ç«¯è«‹æ±‚èªè­‰æœå‹™çš„æˆæœ¬ï¼Œæé«˜äº†æ•ˆèƒ½&lt;/p&gt;
&lt;p&gt;ğŸ‰å¦‚ä½•è§£æ±ºä¸Šé‚Šçš„å•é¡Œï¼Œå¯¦ç¾è³‡æºæœå‹™è‡ªè¡Œæ ¡é©—ä»¤ç‰Œ:&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯jwt&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€ä¹ˆæ˜¯jwt&#34;&gt;#&lt;/a&gt; ä»€ä¹ˆæ˜¯ JWT&lt;/h2&gt;
&lt;p&gt;ğŸŸ¢ä»¤ç‰Œæ¡ç”¨ JWT æ ¼å¼å³å¯è§£æ±ºä¸Šé‚Šçš„å•é¡Œï¼Œç”¨æˆ¶èªè­‰é€šéå¾Œæœƒå¾—åˆ°ä¸€å€‹ JWT ä»¤ç‰Œï¼ŒJWT ä»¤ç‰Œä¸­å·²ç¶“åŒ…æ‹¬äº†ç”¨æˆ¶ç›¸é—œçš„ä¿¡æ¯ï¼Œå®¢æˆ¶ç«¯åªéœ€è¦æ”œå¸¶ JWT è¨ªå•è³‡æºæœå‹™ï¼Œè³‡æºæœå‹™æ ¹æ“šäº‹å…ˆç´„å®š çš„æ¼”ç®—æ³•è‡ªè¡Œå®Œæˆä»¤ç‰Œæ ¡é©—ï¼Œç„¡éœ€æ¯æ¬¡éƒ½è«‹æ±‚èªè­‰æœå‹™å®Œæˆæˆæ¬Šã€‚&lt;/p&gt;
&lt;p&gt;ğŸŸ¡JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ç¨®ä½¿ç”¨ JSON æ ¼å¼å‚³éè³‡æ–™çš„ç¶²è·¯ä»¤ç‰ŒæŠ€è¡“ï¼Œå®ƒæ˜¯ä¸€å€‹é–‹æ”¾çš„è¡Œæ¥­æ¨™æº–ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šç¾©äº†ä¸€ç¨®ç°¡æ½”çš„ã€è‡ªåŒ…å«çš„å”è­°æ ¼å¼ï¼Œç”¨æ–¼åœ¨é€šä¿¡ é›™æ–¹å‚³é json å°è±¡ï¼Œå‚³éçš„è¨Šæ¯ç¶“éæ•¸ä½ç°½ç« å¯ä»¥é©—è­‰å’Œä¿¡ä»»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ HMAC æ¼”ç®—æ³•æˆ–ä½¿ç”¨ RSA çš„å…¬é‘° / ç§é‘°å°ä¾†ç°½åï¼Œé˜²æ­¢å…§å®¹ç¯¡æ”¹ã€‚ å®˜ç¶²ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9qd3QuaW8v&#34;&gt;https://jwt.io/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ğŸ”´å‚³çµ±çš„åŸºæ–¼ session çš„æ–¹å¼æ˜¯æœ‰ç‹€æ…‹èªè­‰ï¼Œä½¿ç”¨è€…ç™»å…¥æˆåŠŸå°‡ä½¿ç”¨è€…çš„èº«ä»½è³‡è¨Šå„²å­˜åœ¨æœå‹™ç«¯ï¼Œé€™æ¨£åŠ å¤§äº†æœå‹™ç«¯çš„å„²å­˜å£“åŠ›ï¼Œä¸¦ä¸”é€™ç¨®æ–¹å¼ä¸é©åˆåœ¨åˆ†æ•£å¼ç³»çµ±ä¸­æ‡‰ç”¨ã€‚&lt;br&gt;
å¦‚ä¸‹åœ–ï¼Œç•¶ç”¨æˆ¶è¨ªå•æ‡‰ç”¨æœå‹™ï¼Œæ¯å€‹æ‡‰ç”¨æœå‹™éƒ½æœƒå»ä¼ºæœå™¨æŸ¥çœ‹ session ä¿¡æ¯ï¼Œå¦‚æœ session ä¸­æ²’æœ‰è©²ç”¨æˆ¶å‰‡èªªæ˜ç”¨æˆ¶æ²’æœ‰ç™»éŒ„ï¼Œæ­¤æ™‚å°±æœƒé‡æ–°èªè­‰ï¼Œè€Œè§£æ±ºé€™å€‹å•é¡Œçš„æ–¹æ³•æ˜¯ Session è¤‡è£½ã€Session é»è²¼ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/8.png&#34; class=&#34;abc&#34; width=&#34;700&#34; height=&#34;400&#34;&gt;
&lt;p&gt;ğŸŸ¢å¦‚æœæ˜¯åŸºæ–¼ä»¤ç‰ŒæŠ€è¡“åœ¨åˆ†æ•£å¼ç³»çµ±ä¸­å¯¦ç¾èªè­‰å‰‡æœå‹™ç«¯ä¸ç”¨å„²å­˜ sessionï¼Œå¯ä»¥å°‡ç”¨æˆ¶è­˜åˆ¥è³‡è¨Šå„²å­˜åœ¨ä»¤ç‰Œä¸­ï¼Œç”¨æˆ¶èªè­‰é€éå¾Œèªè­‰æœå‹™é ’ç™¼ä»¤ç‰Œçµ¦ç”¨æˆ¶ï¼Œç”¨æˆ¶å°‡ä»¤ç‰Œå„²å­˜åœ¨å®¢æˆ¶ ç«¯ï¼Œå»è¨ªå•æ‡‰ç”¨æœå‹™æ™‚æ”œå¸¶ä»¤ç‰Œå»è¨ªå•ï¼Œæœå‹™ç«¯å¾ jwt è§£æå‡ºç”¨æˆ¶è³‡è¨Šã€‚ é€™å€‹éç¨‹å°±æ˜¯ç„¡ç‹€æ…‹èªè­‰ã€‚&lt;/p&gt;
&lt;p&gt;JWT ä»¤ç‰Œçš„å„ªé»ï¼š&lt;br&gt;
1ï¸âƒ£jwt åŸºæ–¼ jsonï¼Œéå¸¸æ–¹ä¾¿è§£æã€‚&lt;br&gt;
2ï¸âƒ£å¯ä»¥åœ¨ä»¤ç‰Œä¸­è‡ªè¨‚è±å¯Œçš„å…§å®¹ï¼Œæ˜“æ“´å……ã€‚&lt;br&gt;
3ï¸âƒ£é€ééå°ç¨±åŠ å¯†æ¼”ç®—æ³•åŠæ•¸ä½ç°½ç« æŠ€è¡“ï¼ŒJWT é˜²æ­¢ç«„æ”¹ï¼Œå®‰å…¨æ€§é«˜ã€‚&lt;br&gt;
4ï¸âƒ£è³‡æºæœå‹™ä½¿ç”¨ JWT å¯ä¸ä¾è³´èªè­‰æœå‹™å³å¯å®Œæˆæˆæ¬Šã€‚&lt;br&gt;
ç¼ºé»ï¼š&lt;br&gt;
JWT ä»¤ç‰Œè¼ƒé•·ï¼Œä½”å„²å­˜ç©ºé–“æ¯”è¼ƒå¤§ã€‚&lt;/p&gt;
&lt;p&gt;JWT ä»¤ç‰Œç”±ä¸‰éƒ¨åˆ†çµ„æˆï¼Œæ¯éƒ¨åˆ†ä¸­é–“ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼Œæ¯”å¦‚ï¼šxxxxx.yyyyy.zzzzz&lt;br&gt;
1ï¸âƒ£Header&lt;br&gt;
 é ­éƒ¨åŒ…æ‹¬ä»¤ç‰Œçš„é¡å‹ï¼ˆå³ JWTï¼‰åŠä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ˆå¦‚ HMAC SHA256 æˆ– RSAï¼‰&lt;br&gt;
å†…å®¹ä½¿ç”¨ Base64Url ç¼–ç ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ JWT ä»¤ç‰Œçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
  &lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;alg&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;HS256&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;typ&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;JWT&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£Payload&lt;br&gt;
 ç¬¬äºŒéƒ¨åˆ†æ˜¯è² è¼‰ï¼Œå…§å®¹ä¹Ÿæ˜¯ä¸€å€‹ json å°è±¡ï¼Œå®ƒæ˜¯å­˜æ”¾æœ‰æ•ˆè³‡è¨Šçš„åœ°æ–¹ï¼Œå®ƒå¯ä»¥å­˜æ”¾ jwt æä¾›çš„è³‡è¨Šå­—æ®µï¼Œä¾‹å¦‚ï¼šissï¼ˆç°½ç™¼è€…ï¼‰,expï¼ˆéæœŸæ™‚é–“æˆ³è¨˜ï¼‰, subï¼ˆé¢å‘çš„ä½¿ç”¨è€…ï¼‰ ç­‰ï¼Œä¹Ÿå¯è‡ªè¨‚æ¬„ä½ã€‚&lt;br&gt;
æ­¤éƒ¨åˆ†ä¸å»ºè­°å­˜æ”¾æ•æ„Ÿè¨Šæ¯ï¼Œå› ç‚ºæ­¤éƒ¨åˆ†å¯ä»¥è§£ç¢¼é‚„åŸåŸå§‹å…§å®¹ã€‚&lt;br&gt;
æœ€å¾Œå°‡ç¬¬äºŒéƒ¨åˆ†è² è¼‰ä½¿ç”¨ Base64Url ç·¨ç¢¼ï¼Œå¾—åˆ°ä¸€å€‹å­—ä¸²å°±æ˜¯ JWT ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;sub&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;1234567890&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;456&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;true&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£Signature&lt;br&gt;
 ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç°½åï¼Œæ­¤éƒ¨åˆ†ç”¨æ–¼é˜²æ­¢ jwt å…§å®¹è¢«ç«„æ”¹ã€‚&lt;br&gt;
é€™å€‹éƒ¨åˆ†ä½¿ç”¨ base64url å°‡å‰å…©éƒ¨åˆ†ç·¨ç¢¼ï¼Œç·¨ç¢¼å¾Œä½¿ç”¨é»ï¼ˆ.ï¼‰é€£æ¥çµ„æˆå­—ä¸²ï¼Œæœ€å¾Œä½¿ç”¨ header ä¸­è²æ˜çš„ç°½ç« æ¼”ç®—æ³•é€²è¡Œç°½ç« ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;HMACSHA256( &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  base64UrlEncode(header) + &lt;span class=&#34;string&#34;&gt;&amp;quot;.&amp;quot;&lt;/span&gt; + &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  base64UrlEncode(payload)&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  secret) &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;ç‚ºä»€éº¼ JWT å¯ä»¥é˜²æ­¢ç¯¡æ”¹ï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ç¬¬ä¸‰éƒ¨åˆ†ä½¿ç”¨ç°½åæ¼”ç®—æ³•å°ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬äºŒéƒ¨åˆ†çš„å…§å®¹é€²è¡Œç°½åï¼Œå¸¸ç”¨çš„ç°½åæ¼”ç®—æ³•æ˜¯ HS256ï¼Œå¸¸è¦‹çš„é‚„æœ‰ md5,sha ç­‰ï¼Œç°½åæ¼”ç®—æ³•éœ€è¦ä½¿ç”¨é‡‘é‘°é€²è¡Œç°½åï¼Œé‡‘é‘°ä¸å°å¤–å…¬é–‹ï¼Œä¸” ç°½ç« æ˜¯ä¸å¯é€†çš„ï¼Œå¦‚æœç¬¬ä¸‰æ–¹æ›´æ”¹äº†å…§å®¹é‚£éº¼ä¼ºæœå™¨é©—è­‰ç°½ç« å°±æœƒå¤±æ•—ï¼Œè¦æƒ³ä¿è­‰é©—è­‰ç°½ç« æ­£ç¢ºå¿…é ˆä¿è­‰å…§å®¹ã€é‡‘é‘°èˆ‡ç°½ç« å‰ä¸€è‡´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/9.png&#34; class=&#34;abc&#34; width=&#34;700&#34; height=&#34;400&#34;&gt;
&lt;p&gt;å¾ä¸Šåœ–å¯ä»¥çœ‹å‡ºèªè­‰æœå‹™å’Œè³‡æºæœå‹™ä½¿ç”¨ç›¸åŒçš„é‡‘é‘°ï¼Œé€™å«å°ç¨±åŠ å¯†ï¼Œå°ç¨±åŠ å¯†æ•ˆç‡é«˜ï¼Œå¦‚æœä¸€æ—¦é‡‘é‘°å¤–æ´©å¯ä»¥å½é€  jwt ä»¤ç‰Œï¼ŒJWT é‚„å¯ä»¥ä½¿ç”¨éå°ç¨±åŠ å¯†ï¼Œèªè­‰æœå‹™è‡ªå·±ä¿ç•™ç§é‘°ï¼Œå°‡å…¬é‘°ä¸‹ç™¼çµ¦å—ä¿¡ä»»çš„å®¢æˆ¶ç«¯ã€è³‡æºæœå‹™ï¼Œå…¬é‘°å’Œç§é‘°æ˜¯é…å°çš„ï¼Œæˆå°çš„å…¬é‘°å’Œç§é‘°æ‰å¯ä»¥æ­£å¸¸ åŠ å¯†å’Œè§£å¯†ï¼Œéå°ç¨±åŠ å¯†æ•ˆç‡ä½ä½†ç›¸æ¯”å°ç¨±åŠ å¯†éå°ç¨±åŠ å¯†æ›´å®‰å…¨ä¸€äº›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;243-æ¸¬è©¦ç”¢ç”Ÿjwtä»¤ç‰Œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#243-æ¸¬è©¦ç”¢ç”Ÿjwtä»¤ç‰Œ&#34;&gt;#&lt;/a&gt; 2.4.3 æ¸¬è©¦ç”¢ç”Ÿ JWT ä»¤ç‰Œ&lt;/h2&gt;
&lt;p&gt;1ï¸âƒ£åœ¨èªè­‰æœå‹™ä¸­é…ç½® jwt ä»¤ç‰Œæœå‹™ï¼Œå³å¯å¯¦ç¾ç”¢ç”Ÿ jwt æ ¼å¼çš„ä»¤ç‰Œ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Configuration&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;TokenConfig&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;SIGNING_KEY&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;mq123&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    TokenStore tokenStore; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; JwtAccessTokenConverter accessTokenConverter; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; TokenStore &lt;span class=&#34;title function_&#34;&gt;tokenStore&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;JwtTokenStore&lt;/span&gt;(accessTokenConverter()); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; JwtAccessTokenConverter &lt;span class=&#34;title function_&#34;&gt;accessTokenConverter&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;JwtAccessTokenConverter&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;converter&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;JwtAccessTokenConverter&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        converter.setSigningKey(SIGNING_KEY); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; converter; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//ä»¤ç‰Œç®¡ç†æœåŠ¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean(name=&amp;quot;authorizationServerTokenServicesCustom&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; AuthorizationServerTokenServices &lt;span class=&#34;title function_&#34;&gt;tokenService&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        DefaultTokenServices service=&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DefaultTokenServices&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        service.setSupportRefreshToken(&lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//æ”¯æŒåˆ·æ–°ä»¤ç‰Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        service.setTokenStore(tokenStore);&lt;span class=&#34;comment&#34;&gt;//ä»¤ç‰Œå­˜å‚¨ç­–ç•¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;TokenEnhancerChain&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;tokenEnhancerChain&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;TokenEnhancerChain&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        tokenEnhancerChain.setTokenEnhancers(Arrays.asList(accessTokenConverter)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        service.setTokenEnhancer(tokenEnhancerChain); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        service.setAccessTokenValiditySeconds(&lt;span class=&#34;number&#34;&gt;7200&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;// ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ2å°æ—¶ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        service.setRefreshTokenValiditySeconds(&lt;span class=&#34;number&#34;&gt;259200&lt;/span&gt;); &lt;span class=&#34;comment&#34;&gt;// åˆ·æ–°ä»¤ç‰Œé»˜è®¤æœ‰æ•ˆæœŸ3å¤© &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; service; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£ä½¿ç”¨ httpclient é€šè¿‡å¯†ç æ¨¡å¼ç”³è¯·ä»¤ç‰Œ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### å¯†ç æ¨¡å¼ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=zhangsan&amp;amp;password=&lt;span class=&#34;number&#34;&gt;123&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç”Ÿæˆ jwt çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;access_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzMzE2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImU5ZDNkMGZkLTI0Y2ItNDRjOC04YzEwLTI1NmIzNGY4ZGZjYyIsImNsaWVudF9pZCI6ImMxIn0.-9SKI-qUqKhKcs8Gb80Rascx-JxqsNZxxXoPo82d8SM&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;token_type&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;bearer&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;refresh_token&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJhdGkiOiJlOWQzZDBmZC0yNGNiLTQ0YzgtOGMxMC0yNTZiMzRmOGRmY2MiLCJleHAiOjE2NjQ1ODM2OTUsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6ImRjNTRjNTRkLTA0YTMtNDIzNS04MmY3LTFkOWZkMmFjM2VmNSIsImNsaWVudF9pZCI6ImMxIn0.Wsw1Jc-Kd_GFqEugzdfoSsMY6inC8OQsraA21WjWtT8&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;expires_in&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;7199&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;scope&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;all&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;jti&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;e9d3d0fd-24cb-44c8-8c10-256b34f8dfcc&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£æˆ‘ä»¬å¯ä»¥é€šè¿‡ check_token æ¥å£æ ¡éªŒ jwt ä»¤ç‰Œ&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;###æ ¡éªŒjwtä»¤ç‰Œ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/oauth/check_token?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJzdHUxIiwic2NvcGUiOlsiYWxsIl0sImV4cCI6MTY2NDM3MTc4MCwiYXV0aG9yaXRpZXMiOlsicDEiXSwianRpIjoiZjBhM2NkZWItMzk5ZC00OGYwLTg4MDQtZWNhNjM4YWQ4ODU3IiwiY2xpZW50X2lkIjoiYzEifQ.qy46CSCJsH3eXWTHgdcntZhzcSzfRQlBU0dxAjZcsUw &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;éŸ¿æ‡‰ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;aud&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;[&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;res1&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;user_name&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;zhangsan&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;scope&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;[&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;all&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;active&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;exp&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1664371780&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;authorities&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;punctuation&#34;&gt;[&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;string&#34;&gt;&amp;quot;p1&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;jti&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;f0a3cdeb-399d-48f0-8804-eca638ad8857&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;,&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;&amp;quot;client_id&amp;quot;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;c1&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;ç¶²é—œèªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç¶²é—œèªè­‰&#34;&gt;#&lt;/a&gt; ç¶²é—œèªè­‰&lt;/h2&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/10.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;ğŸŸ¡æ‰€æœ‰å­˜å–å¾®æœå‹™çš„è«‹æ±‚éƒ½è¦ç¶“éç¶²é—œï¼Œåœ¨ç¶²é—œé€²è¡Œä½¿ç”¨è€…èº«åˆ†çš„èªè­‰å¯ä»¥å°‡è¨±å¤šéæ³•çš„è«‹æ±‚æ””æˆªåˆ°å¾®æœå‹™ä»¥å¤–ï¼Œé€™å«åšç¶²é—œèªè­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é‚Šéœ€è¦æ˜ç¢ºç¶²é—œçš„è·è²¬ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ç¶²ç«™ç™½åå–®ç¶­è­·ï¼šé‡å°ä¸ç”¨èªè­‰çš„ URL å…¨éƒ¨æ”¾è¡Œã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ ¡é©— jwt çš„åˆæ³•æ€§ï¼šé™¤äº†ç™½åå–®å‰©ä¸‹çš„å°±æ˜¯éœ€è¦èªè­‰çš„è«‹æ±‚ï¼Œç¶²é—œéœ€è¦é©—è­‰ jwt çš„åˆæ³•æ€§ï¼Œjwt åˆæ³•å‰‡èªªæ˜ç”¨æˆ¶èº«ä»½åˆæ³•ï¼Œå¦å‰‡èªªæ˜èº«ä»½ä¸åˆæ³•å‰‡æ‹’çµ•ç¹¼çºŒè¨ªå•ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŸ¡ç¶²é—œè² è²¬æˆæ¬Šå—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¶²é—œä¸è² è²¬æˆæ¬Šï¼Œå°è«‹æ±‚çš„æˆæ¬Šæ“ä½œåœ¨å„å€‹å¾®æœå‹™é€²è¡Œï¼Œå› ç‚ºå¾®æœå‹™æœ€æ¸…æ¥šä½¿ç”¨è€…æœ‰å“ªäº›æ¬Šé™å­˜å–å“ªäº›ä»‹é¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¦ç¾ç¶²é—œèªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¯¦ç¾ç¶²é—œèªè­‰&#34;&gt;#&lt;/a&gt; å¯¦ç¾ç¶²é—œèªè­‰&lt;/h2&gt;
&lt;p&gt;ä¸‹é‚Šå¯¦ç¾ç¶²é—œèªè­‰ï¼Œå¯¦ç¾ä»¥ä¸‹è·è²¬ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£ç¶²ç«™ç™½åå–®ç¶­è­·&lt;/p&gt;
&lt;p&gt;é‡å°ä¸ç”¨èªè­‰çš„ URL å…¨éƒ¨æ”¾è¡Œã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£æ ¡é©— jwt çš„åˆæ³•æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†ç™½åå–®å‰©ä¸‹çš„å°±æ˜¯éœ€è¦èªè­‰çš„è«‹æ±‚ï¼Œç¶²é—œéœ€è¦é©—è­‰ jwt çš„åˆæ³•æ€§ï¼Œjwt åˆæ³•å‰‡èªªæ˜ç”¨æˆ¶èº«ä»½åˆæ³•ï¼Œå¦å‰‡èªªæ˜èº«ä»½ä¸åˆæ³•å‰‡æ‹’çµ•ç¹¼çºŒè¨ªå•ã€‚&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£åœ¨ç¶²é—œå·¥ç¨‹æ·»åŠ ä¾è³´&lt;/p&gt;
&lt;figure class=&#34;highlight xml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;XML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-security&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-oauth2&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.projectlombok&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;lombok&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.alibaba&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;tag&#34;&gt;&amp;lt;&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;fastjson&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;tag&#34;&gt;&amp;lt;/&lt;span class=&#34;name&#34;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£æ‹·è²èª²ç¨‹è³‡æ–™ä¸‹ç¶²é—œèªè­‰é…ç½®é¡åˆ¥åˆ°ç¶²é—œå·¥ç¨‹çš„ config åŒ…ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£è¨­å®šç™½åå–®æª” security-whitelist.properties&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/**=ä¸´æ—¶å…¨éƒ¨æ”¾è¡Œ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/auth/**=è®¤è¯åœ°å€ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/content/open/**=å†…å®¹ç®¡ç†å…¬å¼€è®¿é—®æ¥å£ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/media/open/**=åª’èµ„ç®¡ç†å…¬å¼€è®¿é—®æ¥å£ &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡å•Ÿç¶²é—œå·¥ç¨‹ï¼Œé€²è¡Œæ¸¬è©¦&lt;br&gt;
 1ã€ç”³è«‹ä»¤ç‰Œ&lt;br&gt;
 2ã€é€éç¶²é—œå­˜å–è³‡æºæœå‹™&lt;br&gt;
é€™è£¡å­˜å–å…§å®¹ç®¡ç†æœå‹™&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### é€šè¿‡ç½‘å…³è®¿é—®èµ„æºæœåŠ¡ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GET http://localhost:63010/content/course/2 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicmVzMSJdLCJ1c2VyX25hbWUiOiJ6aGFuZ3NhbiIsInNjb3BlIjpbImFsbCJdLCJleHAiOjE2NjQzNjIzMTAsImF1dGhvcml0aWVzIjpbInAxIl0sImp0aSI6Ijc2OTkwMGNiLWM1ZjItNGRiNC1hZWJmLWY1MzgxZDQxZWMyZCIsImNsaWVudF9pZCI6ImMxIn0.lOITjUgYg2HCh5mDPK9EvJJqz-tIupKVfmP8yWJQIKs &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¾åœ¨æˆ‘å€‘çš„ç¶²é—œä½œç”¨:1ï¸âƒ£è·¯ç”±è½‰ç™¼2ï¸âƒ£èªè­‰å’Œæ ¡é©— JWT ä»¤ç‰Œçš„åˆæ³•æ€§3ï¸âƒ£ç¶­è­·ä¸€ä»½ç™½åå–®&lt;/p&gt;
&lt;h1 id=&#34;ç”¨æˆ·èªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç”¨æˆ·èªè­‰&#34;&gt;#&lt;/a&gt; ç”¨æˆ·èªè­‰&lt;/h1&gt;
&lt;h2 id=&#34;é€£çµç”¨æˆ¶ä¸­å¿ƒè³‡æ–™åº«&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é€£çµç”¨æˆ¶ä¸­å¿ƒè³‡æ–™åº«&#34;&gt;#&lt;/a&gt; é€£çµç”¨æˆ¶ä¸­å¿ƒè³‡æ–™åº«&lt;/h2&gt;
&lt;p&gt;æˆ‘å€‘è¦åœ¨èªè­‰æœå‹™ä¸­é€£æ¥ç”¨æˆ¶ä¸­å¿ƒè³‡æ–™åº«æŸ¥è©¢ç”¨æˆ¶è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;å‰é‚Šå­¸ç¿’ Spring Security é‹ä½œåŸç†æ™‚æœ‰ä¸€å¼µåŸ·è¡Œæµç¨‹åœ–ï¼Œå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/11.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;ä½¿ç”¨è€…æäº¤å¸³è™Ÿå’Œå¯†ç¢¼ç”± DaoAuthenticationProvider å‘¼å« UserDetailsService çš„ loadUserByUsername () æ–¹æ³•å–å¾— UserDetails ä½¿ç”¨è€…è³‡è¨Šã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String var1)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;UserDetails æ˜¯ç”¨æˆ·ä¿¡æ¯æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetails&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Serializable&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Collection&amp;lt;? &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;GrantedAuthority&lt;/span&gt;&amp;gt; getAuthorities(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String &lt;span class=&#34;title function_&#34;&gt;getPassword&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String &lt;span class=&#34;title function_&#34;&gt;getUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isAccountNonExpired&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isAccountNonLocked&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isCredentialsNonExpired&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isEnabled&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘å€‘åªè¦å¯¦ä½œ UserDetailsService ä»‹é¢æŸ¥è©¢è³‡æ–™åº«å¾—åˆ°ä½¿ç”¨è€…è³‡è¨Šå›å‚³ UserDetails é¡å‹çš„ä½¿ç”¨è€…è³‡è¨Šå³å¯&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå±è”½åŸæ¥å®šä¹‰çš„ UserDetailsServiceã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//é…ç½®ç”¨æˆ·ä¿¡æ¯æœåŠ¡ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//    @Bean &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//    public UserDetailsService userDetailsService() &amp;#123; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        //è¿™é‡Œé…ç½®ç”¨æˆ·ä¿¡æ¯,è¿™é‡Œæš‚æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼å°†ç”¨æˆ·å­˜å‚¨åœ¨å†…å­˜ä¸­ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        manager.createUser(User.withUsername(&amp;quot;zhangsan&amp;quot;).password(&amp;quot;123&amp;quot;).authorities(&amp;quot;p1&amp;quot;).build()); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        manager.createUser(User.withUsername(&amp;quot;lisi&amp;quot;).password(&amp;quot;456&amp;quot;).authorities(&amp;quot;p2&amp;quot;).build()); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        return manager; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//    &amp;#125; &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸‹è¾¹è‡ªå®šä¹‰ UserDetailsService&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; name     ç”¨æˆ·è¾“å…¥çš„ç™»å½•è´¦å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt;         UserDetails&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@throws&lt;/span&gt;         UsernameNotFoundException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String name)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ²¡åˆ«çš„æ„æ€ï¼Œåªæ˜¯å˜é‡åçœ‹ç€èˆ’æœ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®usernameå»XcUserè¡¨ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, name));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è¿”å›NULLè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ï¼ŒSpringSecurityä¼šå¸®æˆ‘ä»¬å¤„ç†ï¼Œæ¡†æ¶æŠ›å‡ºå¼‚å¸¸ç”¨æˆ·ä¸å­˜åœ¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (user == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// å–å‡ºæ•°æ®åº“å­˜å‚¨çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; user.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å¦‚æœæŸ¥åˆ°äº†ç”¨æˆ·æ‹¿åˆ°æ­£ç¡®çš„å¯†ç ï¼Œæœ€ç»ˆå°è£…æˆä¸€ä¸ªUserDetailså¯¹è±¡ç»™spring securityæ¡†æ¶è¿”å›ï¼Œç”±æ¡†æ¶è¿›è¡Œå¯†ç æ¯”å¯¹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; User.withUsername(user.getUsername()).password(password).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥è©¢ç”¨æˆ¶æµç¨‹:&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/12.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;è³‡æ–™åº«ä¸­çš„å¯†ç¢¼åŠ éå¯†çš„ï¼Œä½¿ç”¨è€…è¼¸å…¥çš„å¯†ç¢¼æ˜¯æ˜æ–‡ï¼Œæˆ‘å€‘éœ€è¦ä¿®æ”¹å¯†ç¢¼æ ¼å¼å™¨ PasswordEncoderï¼ŒåŸä¾†ä½¿ç”¨çš„æ˜¯ NoOpPasswordEncoderï¼Œå®ƒæ˜¯é€éæ˜æ–‡æ–¹å¼æ¯”è¼ƒå¯†ç¢¼ï¼Œç¾åœ¨æˆ‘å€‘ä¿®æ”¹ç‚º BCryptPasswordEncoderï¼Œå®ƒæ˜¯å°‡ä½¿ç”¨è€…è¼¸å…¥çš„ å¯†ç¢¼ç·¨ç¢¼ç‚º BCrypt æ ¼å¼èˆ‡è³‡æ–™åº«ä¸­çš„å¯†ç¢¼é€²è¡Œæ¯”å°ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Bean&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; PasswordEncoder &lt;span class=&#34;title function_&#34;&gt;passwordEncoder&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        //å¯†ç ä¸ºæ˜æ–‡æ–¹å¼ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        return NoOpPasswordEncoder.getInstance(); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;BCryptPasswordEncoder&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡æµ‹è¯•ä»£ç æµ‹è¯• BCryptPasswordEncoderï¼Œå¦‚ä¸‹&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String[] args)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;111111&amp;quot;&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;PasswordEncoder&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;passwordEncoder&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;BCryptPasswordEncoder&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt;(&lt;span class=&#34;type&#34;&gt;int&lt;/span&gt; i=&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;;i++) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ¯ä¸ªè®¡ç®—å‡ºçš„Hashå€¼éƒ½ä¸ä¸€æ · &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;hashPass&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; passwordEncoder.encode(password); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(hashPass); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è™½ç„¶æ¯æ¬¡è®¡ç®—çš„å¯†ç Hashå€¼ä¸ä¸€æ ·ä½†æ˜¯æ ¡éªŒæ˜¯é€šè¿‡çš„ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; passwordEncoder.matches(password, hashPass); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(f); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¿®æ”¹è³‡æ–™åº«ä¸­çš„å¯†ç¢¼ç‚º Bcrypt æ ¼å¼ï¼Œä¸¦ä¸”è¨˜éŒ„æ˜æ–‡å¯†ç¢¼ï¼Œç¨å¾Œç”³è«‹ä»¤ç‰Œæ™‚éœ€è¦ã€‚&lt;br&gt;
ç”±æ–¼ä¿®æ”¹å¯†ç¢¼ç·¨ç¢¼æ–¹å¼é‚„éœ€è¦å°‡å®¢æˆ¶ç«¯çš„é‡‘é‘°æ›´æ”¹ç‚º Bcrypt æ ¼å¼.&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(ClientDetailsServiceConfigurer clients)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;          &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        clients.inMemory()&lt;span class=&#34;comment&#34;&gt;// ä½¿ç”¨in-memoryå­˜å‚¨ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .withClient(&lt;span class=&#34;string&#34;&gt;&amp;quot;XcWebApp&amp;quot;&lt;/span&gt;)&lt;span class=&#34;comment&#34;&gt;// client_id &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//                .secret(&amp;quot;secret&amp;quot;)//å®¢æˆ·ç«¯å¯†é’¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .secret(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;BCryptPasswordEncoder&lt;/span&gt;().encode(&lt;span class=&#34;string&#34;&gt;&amp;quot;XcWebApp&amp;quot;&lt;/span&gt;))&lt;span class=&#34;comment&#34;&gt;//å®¢æˆ·ç«¯å¯†é’¥ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .resourceIds(&lt;span class=&#34;string&#34;&gt;&amp;quot;xuecheng-plus&amp;quot;&lt;/span&gt;)&lt;span class=&#34;comment&#34;&gt;//èµ„æºåˆ—è¡¨ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .authorizedGrantTypes(&lt;span class=&#34;string&#34;&gt;&amp;quot;authorization_code&amp;quot;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;client_credentials&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;implicit&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;refresh_token&amp;quot;&lt;/span&gt;)&lt;span class=&#34;comment&#34;&gt;// è¯¥clientå…è®¸çš„æˆæƒç±»å‹authorization_code,password,refresh_token,implicit,client_credentials &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .scopes(&lt;span class=&#34;string&#34;&gt;&amp;quot;all&amp;quot;&lt;/span&gt;)&lt;span class=&#34;comment&#34;&gt;// å…è®¸çš„æˆæƒèŒƒå›´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .autoApprove(&lt;span class=&#34;literal&#34;&gt;false&lt;/span&gt;)&lt;span class=&#34;comment&#34;&gt;//falseè·³è½¬åˆ°æˆæƒé¡µé¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//å®¢æˆ·ç«¯æ¥æ”¶æˆæƒç çš„é‡å®šå‘åœ°å€ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                .redirectUris(&lt;span class=&#34;string&#34;&gt;&amp;quot;http://www.51xuecheng.cn&amp;quot;&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   ; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¾åœ¨é‡å•Ÿèªè­‰æœå‹™&lt;br&gt;
ä¸‹é‚Šä½¿ç”¨ httpclient æ¸¬è©¦ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;### å¯†ç æ¨¡å¼ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=stu1&amp;amp;password=&lt;span class=&#34;number&#34;&gt;111111&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;æ“´å±•ç”¨æˆ¶èº«ä»½è³‡è¨Š&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ“´å±•ç”¨æˆ¶èº«ä»½è³‡è¨Š&#34;&gt;#&lt;/a&gt; æ“´å±•ç”¨æˆ¶èº«ä»½è³‡è¨Š&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨è€…è¡¨ä¸­å„²å­˜äº†ä½¿ç”¨è€…çš„å¸³è™Ÿã€æ‰‹æ©Ÿè™Ÿç¢¼ã€emailï¼Œæš±ç¨±ã€é ­åƒç­‰è¨Šæ¯ï¼ŒUserDetails ä»‹é¢åªå›å‚³äº† usernameã€å¯†ç¢¼ç­‰è¨Šæ¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetails&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Serializable&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Collection&amp;lt;? &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;GrantedAuthority&lt;/span&gt;&amp;gt; getAuthorities(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String &lt;span class=&#34;title function_&#34;&gt;getPassword&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String &lt;span class=&#34;title function_&#34;&gt;getUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isAccountNonExpired&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isAccountNonLocked&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isCredentialsNonExpired&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;isEnabled&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æˆ‘å€‘éœ€è¦æ“´å±•ä½¿ç”¨è€…èº«åˆ†çš„è¨Šæ¯ï¼Œåœ¨ jwt ä»¤ç‰Œä¸­å„²å­˜ä½¿ç”¨è€…çš„æš±ç¨±ã€é ­åƒã€é›»éƒµç­‰è³‡è¨Šã€‚&lt;/p&gt;
&lt;p&gt;ğŸŸ¡å¦‚ä½•æ“´å±• Spring Security çš„ä½¿ç”¨è€…è­˜åˆ¥è³‡è¨Šå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åœ¨èªè­‰éšæ®µ DaoAuthenticationProvider æœƒå‘¼å« UserDetailService æŸ¥è©¢ä½¿ç”¨è€…çš„ä¿¡æ¯ï¼Œé€™è£¡æ˜¯å¯ä»¥ç²å–åˆ°é½Šå…¨çš„ä½¿ç”¨è€…è³‡è¨Šçš„ã€‚ ç”±æ–¼ JWT ä»¤ç‰Œä¸­ç”¨æˆ¶èº«ä»½è³‡è¨Šä¾†è‡ª UserDetailsï¼ŒUserDetails ä¸­åƒ…å®šç¾©äº† username ç‚ºç”¨æˆ¶çš„èº«ä»½ä¿¡æ¯ï¼Œé€™è£¡æœ‰å…©å€‹æ€è·¯ï¼šç¬¬ä¸€å€‹æ˜¯å¯ä»¥æ“´å±• UserDetailsï¼Œä½¿ä¹‹åŒ…æ‹¬æ›´å¤šçš„è‡ªå®šç¾©å±¬æ€§ï¼Œç¬¬äºŒä¹Ÿ å¯ä»¥æ“´å…… username çš„å…§å®¹ï¼Œä¾‹å¦‚å­˜å…¥ json è³‡æ–™å…§å®¹ä½œç‚º username çš„å…§å®¹ã€‚ ç›¸æ¯”è¼ƒè€Œè¨€ï¼Œæ–¹æ¡ˆäºŒæ¯”è¼ƒç°¡å–®é‚„ä¸ç”¨ç ´å£ UserDetails çš„çµæ§‹ï¼Œæˆ‘å€‘æ¡ç”¨æ–¹æ¡ˆäºŒã€‚&lt;br&gt;
ä¿®æ”¹ UserServiceImpl å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; s     ç”¨æˆ·è¾“å…¥çš„ç™»å½•è´¦å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt;      UserDetails&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@throws&lt;/span&gt; UsernameNotFoundException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String s)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ²¡åˆ«çš„æ„æ€ï¼Œåªæ˜¯å˜é‡åçœ‹ç€èˆ’æœ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®usernameå»XcUserè¡¨ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, name));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ï¼ŒSpringSecurityä¼šå¸®æˆ‘ä»¬å¤„ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (user == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// å–å‡ºæ•°æ®åº“å­˜å‚¨çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; user.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;comment&#34;&gt;// ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ä¸è¦è®¾ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       user.setPassword(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.toJSONString(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// åˆ›å»ºUserDetailså¯¹è±¡ï¼Œå¹¶è¿”å›ï¼Œæ³¨æ„è¿™é‡Œçš„authoritieså¿…é¡»æŒ‡å®š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; User.withUsername(user.getUsername()).password(password).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; User.withUsername(userString).password(password).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡å¯è®¤è¯æœåŠ¡ï¼Œé‡æ–°ç”Ÿæˆä»¤ç‰Œï¼Œç”ŸæˆæˆåŠŸã€‚&lt;br&gt;
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ check_token æŸ¥è¯¢ jwt çš„å†…å®¹&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;###æ ¡éªŒjwtä»¤ç‰Œ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;auth_host&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;/oauth/check_token?token= &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;user_name å„²å­˜äº†ä½¿ç”¨è€…è³‡è¨Šçš„ json æ ¼å¼ï¼Œåœ¨è³‡æºæœå‹™ä¸­å°±å¯ä»¥å–å‡ºè©² json æ ¼å¼çš„å…§å®¹è½‰ç‚ºä½¿ç”¨è€…ç‰©ä»¶å»ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è³‡æºæœå‹™å–å¾—ä½¿ç”¨è€…èº«ä»½&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#è³‡æºæœå‹™å–å¾—ä½¿ç”¨è€…èº«ä»½&#34;&gt;#&lt;/a&gt; è³‡æºæœå‹™å–å¾—ä½¿ç”¨è€…èº«ä»½&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢ç·¨å¯«ä¸€å€‹å·¥å…·é¡åˆ¥åœ¨å„å€‹å¾®æœå‹™ä¸­å»ä½¿ç”¨ï¼Œå–å¾—ç›®å‰ç™»å…¥ä½¿ç”¨è€…çš„ç‰©ä»¶ã€‚ åœ¨ content-api ä¸­å®šç¾©æ­¤é¡:&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;SecurityUtil&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; XcUser &lt;span class=&#34;title function_&#34;&gt;getUser&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;principal&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; SecurityContextHolder.getContext().getAuthentication().getPrincipal();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (principal &lt;span class=&#34;keyword&#34;&gt;instanceof&lt;/span&gt; String) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userJson&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; principal.toString();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(userJson, XcUser.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUser;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;è·å–å½“å‰ç™»å½•ç”¨æˆ·èº«ä»½ä¿¡æ¯å‡ºé”™ï¼š&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, e.getMessage());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;// è¿™é‡Œä½¿ç”¨å†…éƒ¨ç±»ï¼Œæ˜¯ä¸ºäº†ä¸è®©contentå·¥ç¨‹å»ä¾èµ–authå·¥ç¨‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Serializable&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;1L&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String id;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String username;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String password;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String salt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String name;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String nickname;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String wxUnionid;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String companyId;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;        * å¤´åƒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;        */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String userpic;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String utype;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; LocalDateTime birthday;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String sex;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String email;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String cellphone;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String qq;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;        * ç”¨æˆ·çŠ¶æ€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;        */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String status;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; LocalDateTime createTime;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; LocalDateTime updateTime;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»¥ä¸‹åœ¨å…§å®¹ç®¡ç†æœå‹™ä¸­æ¸¬è©¦æ­¤å·¥å…·é¡ï¼Œä»¥æŸ¥è©¢èª²ç¨‹è³‡è¨Šä»‹é¢ç‚ºä¾‹&lt;/p&gt;
&lt;figure class=&#34;highlight json&#34;&gt;&lt;figcaption&gt;&lt;span&gt;json&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;    @ApiOperation(&lt;span class=&#34;string&#34;&gt;&amp;quot;æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹åŸºç¡€ä¿¡æ¯&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    @GetMapping(&lt;span class=&#34;string&#34;&gt;&amp;quot;/course/&amp;#123;courseId&amp;#125;&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    public CourseBaseInfoDto getCourseBaseById(@PathVariable Long courseId) &lt;span class=&#34;punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       SecurityUtil.XcUser user = SecurityUtil.getUser();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;å½“å‰ç”¨æˆ·èº«ä»½ä¸ºï¼š&amp;quot;&lt;/span&gt; + principal);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;å½“å‰ç”¨æˆ·èº«ä»½ä¸ºï¼š&amp;quot;&lt;/span&gt; + user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        return courseBaseInfoService.getCourseBaseInfo(courseId);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡å•Ÿå…§å®¹ç®¡ç†æœå‹™ï¼š&lt;br&gt;
1ã€å•Ÿå‹•èªè­‰æœå‹™ã€ç¶²é—œã€å…§å®¹ç®¡ç†æœå‹™&lt;br&gt;
 2ã€ç”¢ç”Ÿæ–°çš„ä»¤ç‰Œ&lt;br&gt;
 3ã€æ”œå¸¶ä»¤ç‰Œå­˜å–å…§å®¹ç®¡ç†æœå‹™çš„æŸ¥è©¢èª²ç¨‹æ¥å£&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/SpringSecurity/13.png&#34; class=&#34;abc&#34;&gt;
&lt;h1 id=&#34;æ”¯æ´èªè­‰æ–¹å¼å¤šæ¨£&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æ”¯æ´èªè­‰æ–¹å¼å¤šæ¨£&#34;&gt;#&lt;/a&gt; æ”¯æ´èªè­‰æ–¹å¼å¤šæ¨£&lt;/h1&gt;
&lt;h2 id=&#34;çµ±ä¸€èªè­‰å…¥å£&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#çµ±ä¸€èªè­‰å…¥å£&#34;&gt;#&lt;/a&gt; çµ±ä¸€èªè­‰å…¥å£&lt;/h2&gt;
&lt;p&gt;ğŸ‰ç›®å‰å„å¤§ç¶²ç«™çš„èªè­‰æ–¹å¼éå¸¸è±å¯Œï¼šå¸³è™Ÿå¯†ç¢¼èªè­‰ã€æ‰‹æ©Ÿé©—è­‰ç¢¼èªè­‰ã€æƒç¢¼ç™»å…¥ç­‰&lt;br&gt;
ğŸ‰åŸºæ–¼ç›®å‰ç ”ç©¶çš„ Spring Security èªè­‰æµç¨‹å¦‚ä½•æ”¯æ´å¤šæ¨£åŒ–çš„èªè­‰æ–¹æ¡ˆå‘¢ï¼Ÿ&lt;br&gt;
1ï¸âƒ£æ”¯æ´å¸³è™Ÿå’Œå¯†ç¢¼èªè­‰ï¼šæ¡ç”¨ OAuth2 å”è­°çš„å¯†ç¢¼æ¨¡å¼å³å¯å¯¦ç¾&lt;br&gt;
2ï¸âƒ£æ”¯æ´æ‰‹æ©Ÿè™ŸåŠ é©—è­‰ç¢¼èªè­‰ï¼šä½¿ç”¨è€…èªè­‰æäº¤çš„æ˜¯æ‰‹æ©Ÿè™Ÿç¢¼å’Œé©—è­‰ç¢¼ï¼Œä¸¦ä¸æ˜¯å¸³è™Ÿå’Œå¯†ç¢¼&lt;br&gt;
3ï¸âƒ£å¾®ä¿¡æƒç¢¼èªè­‰ï¼šåŸºæ–¼ OAuth2 å”è­°èˆ‡å¾®ä¿¡äº¤äº’ï¼Œå­¸æˆåœ¨ç·šç¶²ç«™æœƒå‘å¾®ä¿¡ä¼ºæœå™¨ç”³è«‹ä¸€å€‹ä»¤ç‰Œï¼Œç„¶å¾Œæ”œå¸¶ä»¤ç‰Œå»å¾®ä¿¡æŸ¥è©¢ç”¨æˆ¶ä¿¡æ¯ï¼ŒæŸ¥è©¢æˆåŠŸå‰‡ç”¨æˆ¶åœ¨å­¸æˆåœ¨ç·šé …ç›®èªè­‰é€šé&lt;br&gt;
ğŸ‰ç›®å‰æˆ‘å€‘æ¸¬è©¦é€šé OAuth2 çš„å¯†ç¢¼æ¨¡å¼ï¼Œç”¨æˆ¶èªè­‰æœƒæäº¤å¸³è™Ÿå’Œå¯†ç¢¼ï¼Œç”± DaoAuthenticationProvider èª¿ç”¨ UserDetailsService çš„ loadUserByUsername () æ–¹æ³•ç²å– UserDetails ç”¨æˆ¶ä¿¡æ¯&lt;br&gt;
ğŸ‰åœ¨å‰é¢æˆ‘å€‘è‡ªè¨‚äº† UserDetailsService ä»‹é¢å¯¦ä½œé¡ï¼Œé€é loadUserByUsername () æ–¹æ³•æ ¹æ“šå¸³è™ŸæŸ¥è©¢ä½¿ç”¨è€…è³‡è¨Š&lt;br&gt;
ğŸ‰è€Œä¸åŒçš„èªè­‰æäº¤æ–¹å¼çš„æ•¸æ“šä¸ä¸€æ¨£ï¼Œä¾‹å¦‚&lt;br&gt;
æ‰‹æ©ŸåŠ é©—è­‰ç¢¼æ–¹å¼ï¼šæœƒæäº¤æ‰‹æ©Ÿè™Ÿç¢¼å’Œé©—è­‰ç¢¼&lt;br&gt;
å¸³è™Ÿå¯†ç¢¼æ–¹å¼ï¼šæœƒæäº¤å¸³è™Ÿã€å¯†ç¢¼ã€é©—è­‰ç¢¼&lt;br&gt;
ğŸ‰æˆ‘å€‘å¯ä»¥åœ¨ loadUserByUsername () æ–¹æ³•ä¸Šåšæ–‡ç« ï¼Œå°‡ä½¿ç”¨è€…åŸä¾†æäº¤çš„å¸³è™Ÿæ•¸æ“šæ”¹ç‚ºæäº¤ä¸€å€‹ JSON æ•¸æ“šï¼ŒJSON æ•¸æ“šå¯ä»¥æ“´å±•ä¸åŒçš„èªè­‰æ–¹å¼æ‰€æäº¤çš„å„ç¨®åƒæ•¸&lt;br&gt;
ğŸ‰é¦–å…ˆå»ºç«‹ä¸€å€‹ DTO é¡åˆ¥ç”¨æ–¼æ¥æ”¶å„ç¨®èªè­‰åƒæ•¸&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthParamsDto&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String username; &lt;span class=&#34;comment&#34;&gt;//ç”¨æˆ·å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String password; &lt;span class=&#34;comment&#34;&gt;//åŸŸ  ç”¨äºæ‰©å±•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String cellphone;&lt;span class=&#34;comment&#34;&gt;//æ‰‹æœºå·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String checkcode;&lt;span class=&#34;comment&#34;&gt;//éªŒè¯ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String checkcodekey;&lt;span class=&#34;comment&#34;&gt;//éªŒè¯ç key&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; String authType; &lt;span class=&#34;comment&#34;&gt;// è®¤è¯çš„ç±»å‹   password:ç”¨æˆ·åå¯†ç æ¨¡å¼ç±»å‹    sms:çŸ­ä¿¡æ¨¡å¼ç±»å‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; Map&amp;lt;String, Object&amp;gt; payload = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;HashMap&lt;/span&gt;&amp;lt;&amp;gt;();&lt;span class=&#34;comment&#34;&gt;//é™„åŠ æ•°æ®ï¼Œä½œä¸ºæ‰©å±•ï¼Œä¸åŒè®¤è¯ç±»å‹å¯æ‹¥æœ‰ä¸åŒçš„é™„åŠ æ•°æ®ã€‚å¦‚è®¤è¯ç±»å‹ä¸ºçŸ­ä¿¡æ—¶åŒ…å«smsKey : sms:3d21042d054548b08477142bbca95cfa; æ‰€æœ‰æƒ…å†µä¸‹éƒ½åŒ…å«clientId&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ­¤æ—¶ loadUserByUsername () æ–¹æ³•å¯ä»¥ä¿®æ”¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/**&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; s ç”¨æˆ·è¾“å…¥çš„ç™»å½•è´¦å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; UserDetails&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@throws&lt;/span&gt; UsernameNotFoundException&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String s)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;AuthParamsDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authParamsDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+           authParamsDto = JSON.parseObject(s, AuthParamsDto.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+           log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹ï¼š&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, s);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+           &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;comment&#34;&gt;// æ²¡åˆ«çš„æ„æ€ï¼Œåªæ˜¯å˜é‡åçœ‹ç€èˆ’æœ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getUsername();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®usernameå»XcUserè¡¨ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, name));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ï¼ŒSpringSecurityä¼šå¸®æˆ‘ä»¬å¤„ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (user == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// å–å‡ºæ•°æ®åº“å­˜å‚¨çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; user.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        user.setPassword(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.toJSONString(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// åˆ›å»ºUserDetailså¯¹è±¡ï¼Œå¹¶è¿”å›ï¼Œæ³¨æ„è¿™é‡Œçš„authoritieså¿…é¡»æŒ‡å®š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; User.withUsername(userString).password(password).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åŸä¾†çš„ DaoAuthenticationProvider æœƒé€²è¡Œå¯†ç¢¼æ ¡é©—ï¼Œç¾åœ¨é‡æ–°å®šç¾© DaoAuthenticationProviderCustom é¡ï¼Œé‡å¯«é¡åˆ¥çš„ additionalAuthenticationChecks æ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Component&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DaoAuthenticationProviderCustom&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;DaoAuthenticationProvider&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;setUserDetailsService&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(UserDetailsService userDetailsService)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;super&lt;/span&gt;.setUserDetailsService(userDetailsService); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;comment&#34;&gt;//å±è”½å¯†ç å¯¹æ¯” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;keyword&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;additionalAuthenticationChecks&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(UserDetails userDetails, UsernamePasswordAuthenticationToken authentication)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; AuthenticationException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¿®æ”¹ WebSecurityConfig ç±»æŒ‡å®š daoAuthenticationProviderCustom&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;DaoAuthenticationProviderCustom daoAuthenticationProviderCustom; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;configure&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthenticationManagerBuilder auth)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Exception &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    auth.authenticationProvider(daoAuthenticationProviderCustom); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åŸä¾†çš„ DaoAuthenticationProvider æœƒé€²è¡Œå¯†ç¢¼æ ¡é©—ï¼Œç¾åœ¨é‡æ–°å®šç¾© DaoAuthenticationProviderCustom é¡ï¼Œé‡å¯«é¡åˆ¥çš„ additionalAuthenticationChecks æ–¹æ³•ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;Text&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;################æ‰©å±•è®¤è¯è¯·æ±‚å‚æ•°å###################### &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;###å¯†ç æ¨¡å¼ &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST &amp;#123;&amp;#123;auth_host&amp;#125;&amp;#125;/auth/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=&amp;#123;&amp;quot;username&amp;quot;:&amp;quot;stu1&amp;quot;,&amp;quot;authType&amp;quot;:&amp;quot;password&amp;quot;,&amp;quot;password&amp;quot;:&amp;quot;111111&amp;quot;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç¶“éæ¸¬è©¦ç™¼ç¾ loadUserByUsername () æ–¹æ³•å¯ä»¥æ­£å¸¸æ¥æ”¶åˆ°èªè­‰è«‹æ±‚ä¸­çš„ json è³‡æ–™ã€‚&lt;br&gt;
æœ‰äº†é€™äº›èªè­‰åƒæ•¸æˆ‘å€‘å¯ä»¥å®šç¾©ä¸€å€‹èªè­‰ Service ä»‹é¢å»é€²è¡Œå„ç¨®æ–¹å¼çš„èªè­‰ã€‚&lt;br&gt;
å®šç¾©ä½¿ç”¨è€…è¨Šæ¯ï¼Œç‚ºäº†æ“´å±•æ€§è®“å®ƒç¹¼æ‰¿ XcUser&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Data&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUserExt&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUser&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®šä¹‰è®¤è¯ Service æ¥å£&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@description&lt;/span&gt; è®¤è¯æ–¹æ³• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; authParamsDto è®¤è¯å‚æ•° &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; com.xuecheng.ucenter.model.po.XcUser ç”¨æˆ·ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@author&lt;/span&gt; Mr.M &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    * &lt;span class=&#34;doctag&#34;&gt;@date&lt;/span&gt; 2022/9/29 12:11 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;   */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   XcUserExt &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;loadUserByUsername () ä¿®æ”¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;UserDetailsService&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    ApplicationContext applicationContext; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@description&lt;/span&gt; æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ç»„æˆç”¨æˆ·èº«ä»½ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; s  AuthParamsDtoç±»å‹çš„jsonæ•°æ® &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; org.springframework.security.core.userdetails.UserDetails &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@author&lt;/span&gt; Mr.M &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@date&lt;/span&gt; 2022/9/28 18:30 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;    */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String s)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AuthParamsDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authParamsDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//å°†è®¤è¯å‚æ•°è½¬ä¸ºAuthParamsDtoç±»å‹ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            authParamsDto = JSON.parseObject(s, AuthParamsDto.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (Exception e) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚ä¸ç¬¦åˆé¡¹ç›®è¦æ±‚:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,s); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//å¼€å§‹è®¤è¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        authService.execute(authParamsDto); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ..... &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;å¯¦ç¾å¸³è™Ÿå¯†ç¢¼èªè­‰&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¯¦ç¾å¸³è™Ÿå¯†ç¢¼èªè­‰&#34;&gt;#&lt;/a&gt; å¯¦ç¾å¸³è™Ÿå¯†ç¢¼èªè­‰&lt;/h2&gt;
&lt;p&gt;ä¸Šç¯€å®šç¾©äº† AuthService èªè­‰æ¥å£ï¼Œç”¨ç­–ç•¥æ¨¡å¼å¯¦ä½œæ­¤æ¥å£å¯¦ä½œå¸³è™Ÿå¯†ç¢¼èªè­‰å’Œå¾®ä¿¡æƒç¢¼æ–¹å¼ï¼Œ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;password_authservice&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PasswordAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUserExt &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;wx_authservice&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;WxAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUserExt &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¿®æ”¹ UserServiceImpl é¡ï¼Œä¾ç…§èªè­‰æ–¹å¼ä½¿ç”¨ä¸åŒçš„èªè­‰ bean&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String s)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AuthParamsDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authParamsDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            authParamsDto = JSON.parseObject(s, AuthParamsDto.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹ï¼š&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, s);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;comment&#34;&gt;// è·å–è®¤è¯ç±»å‹ï¼ŒbeanNameå°±æ˜¯ è®¤è¯ç±»å‹ + åç¼€ï¼Œä¾‹å¦‚ password + _authservice = password_authservice&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authType&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getAuthType();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®è®¤è¯ç±»å‹ï¼Œä»Springå®¹å™¨ä¸­å–å‡ºå¯¹åº”çš„bean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;AuthService&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authService&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; applicationContext.getBean(authType + &lt;span class=&#34;string&#34;&gt;&amp;quot;_authservice&amp;quot;&lt;/span&gt;, AuthService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+       &lt;span class=&#34;type&#34;&gt;XcUserExt&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authService.execute(authParamsDto);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getUsername();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®usernameå»XcUserè¡¨ä¸­æŸ¥è¯¢å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-       &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, name));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è¿”å›ç©ºè¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ï¼ŒSpringSecurityä¼šå¸®æˆ‘ä»¬å¤„ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (user == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// å–å‡ºæ•°æ®åº“å­˜å‚¨çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; user.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        user.setPassword(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.toJSONString(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// åˆ›å»ºUserDetailså¯¹è±¡ï¼Œå¹¶è¿”å›ï¼Œæ³¨æ„è¿™é‡Œçš„authoritieså¿…é¡»æŒ‡å®š&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; User.withUsername(userString).password(password).authorities(&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬åªæ˜¯ç®€å•å®šä¹‰äº†è´¦å·å¯†ç è®¤è¯çš„å®ç°ç±»ï¼Œå¹¶æ²¡æœ‰ç¼–å†™å…·ä½“é€»è¾‘ï¼Œé‚£è¿™ä¸ªå°èŠ‚æˆ‘ä»¬å°±æ¥å…·ä½“å®ç°è´¦å·å¯†ç è®¤è¯&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Service(&amp;quot;password_authservice&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;PasswordAuthServiceImpl&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;AuthService&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    XcUserMapper xcUserMapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    PasswordEncoder passwordEncoder;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; XcUserExt &lt;span class=&#34;title function_&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(AuthParamsDto authParamsDto)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 1. è·å–è´¦å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getUsername();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 2. æ ¹æ®è´¦å·å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUser&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUserMapper.selectOne(&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LambdaQueryWrapper&lt;/span&gt;&amp;lt;XcUser&amp;gt;().eq(XcUser::getUsername, username));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 3. ä¸å­˜åœ¨æŠ›å¼‚å¸¸&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (xcUser == &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è´¦å·ä¸å­˜åœ¨&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4. æ ¡éªŒå¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4.1 è·å–ç”¨æˆ·è¾“å…¥çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;passwordForm&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4.2 è·å–æ•°æ®åº“ä¸­å­˜å‚¨çš„å¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;passwordDb&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; xcUser.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4.3 æ¯”è¾ƒå¯†ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;matches&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; passwordEncoder.matches(passwordForm, passwordDb);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4.4 ä¸åŒ¹é…ï¼ŒæŠ›å¼‚å¸¸&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (!matches) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è´¦å·æˆ–å¯†ç é”™è¯¯&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// 4.5 åŒ¹é…ï¼Œå°è£…è¿”å›&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUserExt&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;xcUserExt&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;XcUserExt&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        BeanUtils.copyProperties(xcUser, xcUserExt);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; xcUserExt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä¿®æ”¹ loadUserByUsername () æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ€åçš„å°è£… UserDetails çš„ç›¸å…³ä»£ç æŠ½å–ä¸ºä¸€ä¸ªæ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;loadUserByUsername&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(String s)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; UsernameNotFoundException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AuthParamsDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authParamsDto&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            authParamsDto = JSON.parseObject(s, AuthParamsDto.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            log.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹ï¼š&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, s);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RuntimeException&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;quot;è®¤è¯è¯·æ±‚æ•°æ®æ ¼å¼ä¸å¯¹&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// è·å–è®¤è¯ç±»å‹ï¼ŒbeanNameå°±æ˜¯ è®¤è¯ç±»å‹ + åç¼€ï¼Œä¾‹å¦‚ password + _authservice = password_authservice&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authType&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authParamsDto.getAuthType();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;// æ ¹æ®è®¤è¯ç±»å‹ï¼Œä»Springå®¹å™¨ä¸­å–å‡ºå¯¹åº”çš„bean&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;AuthService&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;authService&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; applicationContext.getBean(authType + &lt;span class=&#34;string&#34;&gt;&amp;quot;_authservice&amp;quot;&lt;/span&gt;, AuthService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;XcUserExt&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; authService.execute(authParamsDto);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; getUserPrincipal(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; UserDetails &lt;span class=&#34;title function_&#34;&gt;getUserPrincipal&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(XcUserExt user)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       String[] authorities = &amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;test&amp;quot;&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;password&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; user.getPassword();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       user.setPassword(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userJsonStr&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.toJSONString(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;type&#34;&gt;UserDetails&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;userDetails&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; User.withUsername(userJsonStr).password(password).authorities(authorities).build();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; userDetails;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¯¦ç¾å¸³è™Ÿå¯†ç¢¼èªè­‰ï¼Œç”³è«‹ä»¤ç‰Œï¼Œæ³¨æ„ JSON è³‡æ–™ä¸­è¦å¸¶ä¸Š authType&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;###### å¯†ç æ¨¡å¼&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;POST localhost:&lt;span class=&#34;number&#34;&gt;53070&lt;/span&gt;/auth/oauth/token?client_id=XcWebApp&amp;amp;client_secret=XcWebApp&amp;amp;grant_type=password&amp;amp;username=&amp;#123;&lt;span class=&#34;string&#34;&gt;&amp;quot;username&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;Kyle&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;111111&amp;quot;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;authType&amp;quot;&lt;/span&gt;:&lt;span class=&#34;string&#34;&gt;&amp;quot;password&amp;quot;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;span class=&#34;green&#34;&gt;ä¸‹ç¯‡:&lt;/span&gt;&lt;a href=&#34;/John/2023/11/03/java/SpringSecurity/WeChat_login&#34;&gt;é©—è­‰ç¢¼å’Œå¾®ä¿¡ç™»éŒ„&lt;/a&gt;&lt;/p&gt;
&lt;img data-src=&#34;https://s1.aigei.com/src/img/jpg/76/766f945a88ff4bafa8aa409d5bedb642.jpg?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/&amp;e=1735488000&amp;token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:PlOHtwQdZo0HyFUYu3_jASLjruk=&#34; class=&#34;abc&#34; width=&#34;250&#34; height=&#34;200&#34;&gt;</content>
        <category term="SpringSecurity" />
        <updated>2023-10-30T14:10:06.589Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/10/27/java/springMVC/UserBook-Web</id>
        <title>æ‰‹å¯«springMVC!</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/10/27/java/springMVC/UserBook-Web"/>
        <content type="html">&lt;h2 id=&#34;å‰è¨€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å‰è¨€&#34;&gt;#&lt;/a&gt; å‰è¨€&lt;/h2&gt;
&lt;p&gt;åˆå­¸éšæ®µå…¨ç«¯çš„ä¸€å€‹é …ç›®ï¼Œæ˜¯ä¸€å€‹ç°¡å–®çš„ç”¨æˆ¶ç«¯åœ–æ›¸ç®¡ç†ç³»çµ±ï¼Œç™»éŒ„ç”¨ jwt ä»¤ç‰Œå¯¦ç¾ã€‚&lt;br&gt;
å‰ç«¯æ˜¯ç”¨ Vue2ã€Pinia åšç‹€æ…‹ç®¡ç†ã€bootstrap 5 (ä¸æ¨è–¦)ã€Axiosã€‚&lt;br&gt;
å¾Œç«¯ç”¨ SpringMVCã€SpringBootã€Mybatisã€MySQLã€‚&lt;br&gt;
æ–¼ç”±å°±æ˜¯ä¸€å€‹å¾ˆä¹…ä¹‹å‰çš„é …ç›®ï¼Œè€Œä¸”é …ç›®çµæ§‹å¾ˆç°¡å–®åªæ˜¯ç·´ç·´æ‰‹ï¼Œç¾åœ¨åªæ˜¯è£œå¯«ä¸€å€‹è¨˜éŒ„ï¼Œæ‰€ä»¥æˆ‘å°±ä¸æ¯å€‹æ­¥é©Ÿè¨˜éŒ„ï¼Œåªè¨˜éŒ„é‡é»ï½&lt;br&gt;
 é …ç›®åœ°å€:&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3N1cGVycmpvaG4vVXNlckJvb2stV2Vi&#34;&gt;https://github.com/superrjohn/UserBook-Web&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&#34;é‚è¼¯åœ–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é‚è¼¯åœ–&#34;&gt;#&lt;/a&gt; é‚è¼¯åœ–&lt;/h2&gt;
&lt;p&gt;åšé …ç›®ã€æ¨¡å¡Šã€æ¥­å‹™åŠŸèƒ½ä¸€å®šè¦å…ˆå¯«é‚è¼¯åœ–ï¼Œä¸€ä¾†ç†æ¸…é‚è¼¯æ­¥é©Ÿï¼ŒäºŒä¾†è·Ÿè‘—æ­¥é©Ÿåšé–‹ç™¼ã€‚(é›–ç„¶é€™åœ–å¯«å¾—ä¸å¤ªå„ª)&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/springMVC/logic_diagram.png&#34; class=&#34;abc&#34; width=&#34;400&#34; height=&#34;700&#34;&gt;
&lt;h2 id=&#34;å‰ç«¯&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å‰ç«¯&#34;&gt;#&lt;/a&gt; å‰ç«¯&lt;/h2&gt;
&lt;p&gt;å‰ç«¯æ–¹é¢ï¼Œæˆ‘æƒ³è¨˜éŒ„çš„æ˜¯&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9waW5pYS52dWVqcy5vcmcvemgvaW50cm9kdWN0aW9uLmh0bWw=&#34;&gt; Pinia&lt;/span&gt; ç‹€æ…‹ç®¡ç†åº«ï¼Œæœƒä»¥ Vue2 åšç°¡å–®èªªæ˜ã€‚&lt;br&gt;
1ï¸âƒ£å‰µä¸€å€‹ Pinia å¯¦ä¾‹å¹¶æ›è¼‰åˆ° Vue, å¦‚æœæ˜¯ Vue 2 é‚„éœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶ PiniaVuePlugin, å¦‚æœæƒ³æ“æœ‰æŒä¹…åŒ–ï¼Œéœ€è¦å®‰è£ pinia-plugin-persistedstate æ’ä»¶ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/springMVC/create_pinia.png&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;500&#34;&gt;
&lt;p&gt;2ï¸âƒ£Store å¯ä»¥ç†è§£æˆè¦ç‹€æ…‹ç®¡ç†çš„å°è±¡ï¼Œå®ƒæœ‰ä¸‰å€‹é‡è¦çš„éƒ¨ä»½çµ„æˆï¼Œåˆ†åˆ¥æ˜¯ stateã€getter å’Œ action, æœ¬é …ç›®åªç”¨åˆ° stateã€action,state æ˜¯å±¬æ€§ï¼Œè€Œ action æ˜¯æ”¹è®Šå±¬æ€§çš„æ–¹æ³•ï¼Œæˆ‘å°è£äº†æ ¹æ“šç”¨æˆ¶ ID ç™¼èµ·æŸ¥è©¢å€Ÿæ›¸è¨˜éŒ„çš„ API, è€Œ persist ç‚º true é–‹å•ŸæŒä¹…åŒ–ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;useBookStatus.js&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; &amp;#123; defineStore &amp;#125; from &lt;span class=&#34;string&#34;&gt;&amp;#x27;pinia&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;import&lt;/span&gt; &amp;#123; userAPI &amp;#125; from &lt;span class=&#34;string&#34;&gt;&amp;#x27;@/apis/user&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//å€‹äººå€Ÿæ›¸è¨˜éŒ„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;export &lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;useBookStatus&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; defineStore(&lt;span class=&#34;string&#34;&gt;&amp;#x27;bookStatus&amp;#x27;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    state: () =&amp;gt; (&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        bookStatus: []&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;),&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    actions: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        async &lt;span class=&#34;title function_&#34;&gt;getBookStatus&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(id)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; await &lt;span class=&#34;title function_&#34;&gt;userAPI&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(id)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;.bookStatus = res.data.data&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//console.log(this.bookStatus)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        clearBookStatus() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;.bookStatus = []&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    persist: &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£å€‹äººé çš„ JS å¤§æ¦‚é•·é€™æ¨£ï¼Œç”¨ mapActions () è¼”åŠ©å‡½æ•¸å°‡ action å±¬æ€§æ˜ å°„åˆ°ç»„ä»¶ä¸­ï¼Œç„¶å¾Œç•¶é é¢åŠ è¼‰å¾Œæ ¹æ“š id åŸ·è¡Œ getBookStatus æ–¹æ³•ï¼ŒæŸ¥è©¢å€‹äººçš„å€Ÿæ›¸è¨˜éŒ„&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/springMVC/status_action.png&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;500&#34;&gt;
&lt;h2 id=&#34;å¾Œç«¯&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å¾Œç«¯&#34;&gt;#&lt;/a&gt; å¾Œç«¯&lt;/h2&gt;
&lt;p&gt;é …ç›®çµæ§‹ç°¡å–®ï¼Œä¸»è¦æ˜¯çˆ¶å·¥ç¨‹ï¼ŒPO é¡ï¼Œå·¥å…·é¡åªæœ‰ç”Ÿæˆå’Œè§£æ jwt ä»¤ç‰Œï¼Œä¸»è¦æ¥­å‹™é‚è¼¯å¯«åœ¨ boot-web-management&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/springMVC/boot-web-management.png&#34; class=&#34;abc&#34; width=&#34;300&#34; height=&#34;250&#34;&gt;
&lt;p&gt;1ï¸âƒ£é¦–å…ˆæ˜¯ç™»éŒ„åŠŸèƒ½ï¼ŒæŸ¥è©¢ç”¨æˆ¶è¡¨ï¼Œå¦‚æœç”¨æˆ¶å­˜åœ¨å‰›ç²å¾—ç”¨æˆ¶å°è±¡å¾Œç”Ÿæˆ jwt ä»¤ç‰Œè¿”å›å‰ç«¯ï¼Œæ²’æœ‰å‰‡è¿”å›ç™»éŒ„å¤±æ•—ä¿¡æ¯çµ¦å‰ç«¯&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@RestController&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LoginController&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; UserService userService;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@PostMapping(&amp;quot;/login&amp;quot;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Result &lt;span class=&#34;title function_&#34;&gt;login&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@RequestBody&lt;/span&gt; User user)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;ç”¨æˆ¶ç™»éŒ„:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; userService.login(user);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ç”¨æˆ¶ç™»éŒ„æˆåŠŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(u != &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Map&amp;lt;String, Object&amp;gt; claims = &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;HashMap&lt;/span&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            claims.put(&lt;span class=&#34;string&#34;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;, u.getId());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            claims.put(&lt;span class=&#34;string&#34;&gt;&amp;quot;username&amp;quot;&lt;/span&gt;, u.getUsername());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            claims.put(&lt;span class=&#34;string&#34;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;, u.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jwt&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JwtUtils.generateJwt(claims);&lt;span class=&#34;comment&#34;&gt;//ç”Ÿæˆtokenä»¤ç‰Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; Result.success(jwt);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ç™»éŒ„å¤±æ•—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; Result.error(&lt;span class=&#34;string&#34;&gt;&amp;quot;å¯†ç¢¼å¸³è™Ÿæœ‰éŒ¯&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£ä¹‹å¾Œéƒ½æ˜¯å°ç”¨æˆ¶çš„å€Ÿæ›¸ç‹€æ…‹å’Œåœ–æ›¸ç‹€æ…‹çš„å¢åˆªæ”¹æŸ¥ï¼Œä½¿ç”¨äº† interceptor æŸ¥è©¢ä»¤ç‰Œï¼Œæ²’æœ‰å‰‡æ””æˆªï¼Œé‚„æœ‰å…¨å±€ç•°å¸¸é…ç½®ç­‰ï¼Œæ²’ä»€éº¼ç‰¹åˆ¥ï¼Œå€¼å¾—èªªçš„æ˜¯æˆ‘ç”¨äº† Spring AOP, è‡ªå®šç¾©è¨»è§£ä¾†å°é‡è¦çš„æ“ä½œé€²è¡Œé¡å¤–çš„æ—¥èªŒè¨˜éŒ„ã€‚&lt;br&gt;
é¦–å…ˆè¦å‰µä¸€å€‹è‡ªå®šç¾©è¨»è§£ï¼Œèªªæ˜åœ¨å“ªæ–¹æ³•ä¸Šé‹è¡Œ&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//è‡ªå®šç¾©è¨»è§£,è¨˜éŒ„ä¿®æ”¹ç”¨æˆ¶ä¿®æ”¹æ—¥èªŒ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Retention(RetentionPolicy.RUNTIME)&lt;/span&gt; &lt;span class=&#34;comment&#34;&gt;//é‹è¡Œæ™‚ç”Ÿæ•ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Target(ElementType.METHOD)&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//è¨»æ˜æ–¹æ³•ä¸Šç”Ÿæ•ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;meta&#34;&gt;@interface&lt;/span&gt; Log &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é€™è£¡æˆ‘ä½¿ç”¨äº† @Around åšåˆ‡å…¥æ–¹æ³•ï¼Œå› ç‚ºæˆ‘éœ€è¦è¨˜éŒ„åŸå§‹æ–¹æ³•çš„é‹è¡Œæ™‚é–“ï¼Œannotation å‰‡ä»¥è‡ªå®šç¾©è¨»è§£ç‚ºåˆ‡é»ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Slf4j&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Component&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//äº¤çµ¦IOCç®¡ç†&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Aspect&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//åˆ‡é¢é¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;LogAspect&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; HttpServletRequest request;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Autowired&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;private&lt;/span&gt; OperateLogMapper operateLogMapper;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@Around(&amp;quot;@annotation(com.itheima.anno.Log)&amp;quot;)&lt;/span&gt;&lt;span class=&#34;comment&#34;&gt;//ä»¥è¨»è§£æ–¹å¼é…å‚™åˆ‡å…¥é»æ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Object &lt;span class=&#34;title function_&#34;&gt;recordLog&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(ProceedingJoinPoint joinPoint)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; Throwable &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œäººID,ç•¶å‰ç™»éŒ„å“¡å·¥çš„ID,ç²æœ€è«‹æ±‚é ­çš„JWTä»¤ç‰Œ,è§£æä»¤ç‰Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jwt&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; request.getHeader(&lt;span class=&#34;string&#34;&gt;&amp;quot;token&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Claims&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;claims&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JwtUtils.parseJWT(jwt);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Integer&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;operateUser&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (Integer) claims.get(&lt;span class=&#34;string&#34;&gt;&amp;quot;id&amp;quot;&lt;/span&gt;);&lt;span class=&#34;comment&#34;&gt;//Claimsé¡ç‚ºObject,æ‰€ä»¥è¦å¼·è½‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œæ™‚é–“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;LocalDateTime&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;operateTime&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; LocalDateTime.now();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œé¡å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;className&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; joinPoint.getTarget().getClass().getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œæ–¹æ³•å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;methodName&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; joinPoint.getSignature().getName();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œæ–¹æ³•åƒæ•¸&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        Object[] args = joinPoint.getArgs();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;methodParams&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; Arrays.toString(args);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//é–‹å§‹èª¿ç”¨åŸå§‹æ–¹æ³•æ™‚é–“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;begin&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//èª¿ç”¨åŸå§‹ç›®æ¨™æ–¹æ³•é‹è¡Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; joinPoint.proceed();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; System.currentTimeMillis();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ–¹æ³•è¿”å›å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;returnValue&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSONObject.toJSONString(result);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æ“ä½œæ™‚é–“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;costTime&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; end - begin;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¨˜éŒ„æ“ä½œæ—¥å¿—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;OperateLog&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;operateLog&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;OperateLog&lt;/span&gt;(&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;,operateUser,operateTime,className,methodName,methodParams,returnValue,costTime);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        operateLogMapper.insert(operateLog);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;AOPè¨˜éŒ„æ—¥å¿—:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, operateLog);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; result;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶å¾Œåœ¨éœ€è¦çš„ API åŠ ä¸Šå°±å®Œæˆäº†&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@Log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;//ä¿®æ”¹æ›¸æœ¬å‡ºå€Ÿç‹€æ…‹å’Œæ–°å¢ç”¨æˆ¶å€Ÿæ›¸è¨˜éŒ„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;meta&#34;&gt;@PutMapping&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; Result &lt;span class=&#34;title function_&#34;&gt;updateStatus&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@RequestBody&lt;/span&gt; UserBorrow userBorrow)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       log.info(&lt;span class=&#34;string&#34;&gt;&amp;quot;å€Ÿå‡ºæ›¸æœ¬è³‡æ–™:&amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;,userBorrow);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       bookService.updateStatus(userBorrow);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; Result.success();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£æˆ‘å° AOP çš„ç†è§£æ˜¯ï¼Œå®ƒæ˜¯ä»¥å‹•æ…‹ä»£ç†çš„æ–¹å¼å»å¢å¼·åŠŸèƒ½ï¼Œè¡¨é”å¼å‰‡æ˜¯è¦åŠ å¼·çš„æ–¹æ³• (åˆ‡é»), åˆ‡å…¥æ–¹æ³•å‰‡æ˜¯ä»€éº¼æ™‚å€™åšåŠ å¼·ï¼Œæ˜¯ä»£ç¢¼åŸ·è¡Œå‰é‚„æ˜¯å¾Œï¼Œè¦ç†è§£æºç¢¼é‚„æ˜¯è »è¤‡é›œçš„ï¼Œå¹¸å¥½èƒ½ç†è§£ä¸¦ä½¿ç”¨ä¸é›£ï½&lt;/p&gt;
&lt;img data-src=&#34;https://usagif.com/wp-content/uploads/gifs/thanks-for-watching-9.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;</content>
        <category term="SpringMVC" />
        <category term="Pinia" />
        <category term="Vue2" />
        <category term="SpringBoot" />
        <updated>2023-10-27T09:24:46.659Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/10/26/java/rabbitmq/rabbitmq</id>
        <title>Hello RabbitMq!</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/10/26/java/rabbitmq/rabbitmq"/>
        <content type="html">&lt;p&gt;ToDo&lt;/p&gt;
</content>
        <category term="RabbitMQ" />
        <updated>2023-10-26T14:18:33.325Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/10/26/java/radis/radis</id>
        <title>Redis ç·©å­˜å„ªåŒ–</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/10/26/java/radis/radis"/>
        <content type="html">&lt;p&gt;åœ¨æ­¤ç‰¹åˆ«æ„Ÿè¬é»‘é¦¬ç¨‹åºå“¡æä¾›çš„èª²ç¨‹: &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWo4NDExTjdCbS8=&#34;&gt;å­¸æˆåœ¨ç·š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰è¨€&lt;br&gt;
æ–¼ç”±å¯¦ç¿’é …ç›®å¿«åšå®Œæ‰åšè¨˜éŒ„ï¼Œè€Œä¸”é …ç›®æ¨¡å¡Šè¼ƒå¤šï¼Œæ•…æŒ‘éƒ¨ä»½ä¾†è¨˜éŒ„&lt;br&gt;
&lt;span class=&#34;rainbow&#34;&gt;å®Œæ•´é¡¹ç›®åœ°å€&lt;/span&gt;ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3N1cGVycmpvaG4vamF2YV93ZWI=&#34;&gt;https://github.com/superrjohn/java_web&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜å„ªåŒ–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜å„ªåŒ–&#34;&gt;#&lt;/a&gt; ç·©å­˜å„ªåŒ–&lt;/h1&gt;
&lt;h2 id=&#34;redisç·©å­˜&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#redisç·©å­˜&#34;&gt;#&lt;/a&gt; redis ç·©å­˜&lt;/h2&gt;
&lt;p&gt;æ¸¬è©¦æ¡ˆä¾‹æ˜¯æ ¹æ“š id æŸ¥è©¢èª²ç¨‹ä¿¡æ¯ï¼Œé€™è£¡ä¸å­˜åœ¨è¤‡é›œçš„ SQLï¼Œä¹Ÿä¸å­˜åœ¨è³‡æ–™åº«é€£ç·šä¸é‡‹æ”¾çš„å•é¡Œï¼Œæš«æ™‚ä¸è€ƒæ…®è³‡æ–™åº«æ–¹é¢çš„æœ€ä½³åŒ–ã€‚&lt;br&gt;
èª²ç¨‹ç™¼å¸ƒè³‡è¨Šçš„ç‰¹é»çš„æ˜¯æŸ¥è©¢è¼ƒå¤šï¼Œä¿®æ”¹å¾ˆå°‘ï¼Œé€™è£¡è€ƒæ…®å°‡èª²ç¨‹ç™¼å¸ƒè³‡è¨Šé€²è¡Œç·©å­˜ï¼Œç™½åå–®æ•¸æ“šçš„å…§å®¹ä¹Ÿå¯ä»¥è€ƒæ…®é€²è¡Œç·©å­˜ã€‚&lt;br&gt;
èª²ç¨‹è³‡è¨Šç·©å­˜çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/1.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1ï¸âƒ£åœ¨ nacos é…ç½® redis-dev.yamlï¼ˆgroup=xuecheng-plus-commonï¼‰&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;spring:  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  redis: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    host: &lt;span class=&#34;number&#34;&gt;192.168&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.101&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.65&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    port: &lt;span class=&#34;number&#34;&gt;6379&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    password: redis &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    database: &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    lettuce: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      pool: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        max-active: &lt;span class=&#34;number&#34;&gt;20&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        max-idle: &lt;span class=&#34;number&#34;&gt;10&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        min-idle: &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    timeout: &lt;span class=&#34;number&#34;&gt;10000&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£åœ¨ content-api å¾®æœå‹™åŠ è¼‰ redis-dev.yaml&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;shared-configs: &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    - data-id: redis-$&amp;#123;spring.profiles.active&amp;#125;.yaml &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      group: xuecheng-plus-common &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      refresh: &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£åœ¨ content-service å¾®æœå‹™ä¸­æ·»åŠ ä¾è³´&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;/dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;artifactId&amp;gt;commons-pool2&amp;lt;/artifactId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;version&amp;gt;&lt;span class=&#34;number&#34;&gt;2.6&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.2&lt;/span&gt;&amp;lt;/version&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;/dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;4ï¸âƒ£å®šç¾©æŸ¥è©¢ç·©å­˜ä»‹é¢ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@description&lt;/span&gt; æŸ¥è¯¢ç¼“å­˜ä¸­çš„è¯¾ç¨‹ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; courseId  &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@return&lt;/span&gt; com.xuecheng.content.model.po.CoursePublish &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@author&lt;/span&gt; Mr.M &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt; * &lt;span class=&#34;doctag&#34;&gt;@date&lt;/span&gt; 2022/10/22 16:15 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;*/&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;5ï¸âƒ£ä»‹é¢å¯¦ä½œå¦‚ä¸‹ï¼Œkey çš„å‘½åä»¥ course ç‚ºå‰ç¶´åŠ ä¸Š courseId&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt;  &lt;span class=&#34;variable&#34;&gt;jsonObj&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonObj!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; jsonObj.toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;=================ä»ç¼“å­˜æŸ¥=================&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;ä»æ•°æ®åº“æŸ¥è¯¢...&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ä»æ•°æ®åº“æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getCoursePublish(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(coursePublish!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish)); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;6ï¸âƒ£ä¿®æ”¹ controller æ¥å£èª¿ç”¨ä»£ç¢¼&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;@ApiOperation(&amp;quot;è·å–è¯¾ç¨‹å‘å¸ƒä¿¡æ¯&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@ResponseBody&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;meta&#34;&gt;@GetMapping(&amp;quot;/course/whole/&amp;#123;courseId&amp;#125;&amp;quot;)&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CoursePreviewDto &lt;span class=&#34;title function_&#34;&gt;getCoursePublish&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;meta&#34;&gt;@PathVariable(&amp;quot;courseId&amp;quot;)&lt;/span&gt; Long courseId)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; coursePublishService.getCoursePublishCache(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//        CoursePublish coursePublish = coursePublishService.getCoursePublish(courseId); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(coursePublish==&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CoursePreviewDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CourseBaseInfoDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;courseBase&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CourseBaseInfoDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        BeanUtils.copyProperties(coursePublish, courseBase); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è¯¾ç¨‹è®¡åˆ’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        List&amp;lt;TeachplanDto&amp;gt; teachplans = JSON.parseArray(coursePublish.getTeachplan(), TeachplanDto.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePreviewDto&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePreviewInfo&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;CoursePreviewDto&lt;/span&gt;(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        coursePreviewInfo.setCourseBase(courseBase); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        coursePreviewInfo.setTeachplans(teachplans); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePreviewInfo; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;é‡æ–°æ¸¬è©¦è«‹æ±‚å…§å®¹ç®¡ç†æœå‹™èª²ç¨‹æŸ¥è©¢ä»‹é¢ï¼Œååé‡é”åˆ° 2700 å·¦å³ï¼Œå¢åŠ äº†è¿‘ä¸€å€ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/2.png&#34; class=&#34;abc&#34;&gt;
&lt;h1 id=&#34;ç·©å­˜ç©¿é€å•é¡Œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜ç©¿é€å•é¡Œ&#34;&gt;#&lt;/a&gt; ç·©å­˜ç©¿é€å•é¡Œ&lt;/h1&gt;
&lt;h2 id=&#34;ä»€éº¼æ˜¯ç·©å­˜ç©¿é€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€éº¼æ˜¯ç·©å­˜ç©¿é€&#34;&gt;#&lt;/a&gt; ä»€éº¼æ˜¯ç·©å­˜ç©¿é€&lt;/h2&gt;
&lt;p&gt;æˆ‘å€‘åˆ†æä¸‹ç¨‹å¼ç¢¼:&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/3.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;å¦‚æœæœ‰æƒ¡æ„æ”»æ“Šçš„å¯èƒ½ï¼Œå¦‚æœæœ‰å¤§é‡ä¸¦ç™¼å»æŸ¥è©¢ä¸€å€‹ä¸å­˜åœ¨çš„èª²ç¨‹è³‡è¨Šæœƒå‡ºç¾ä»€éº¼å•é¡Œå‘¢ï¼Ÿ&lt;br&gt;
ä¾‹å¦‚å»è«‹æ±‚ /content/course/whole/181ï¼ŒæŸ¥è©¢ 181 è™Ÿèª²ç¨‹ï¼Œè©²èª²ç¨‹ä¸¦ä¸åœ¨èª²ç¨‹ç™¼å¸ƒè¡¨ä¸­ã€‚&lt;br&gt;
é€²è¡Œå£“åŠ›æ¸¬è©¦ç™¼ç¾æœƒå»è«‹æ±‚è³‡æ–™åº«ã€‚&lt;br&gt;
å¤§é‡ä¸¦ç™¼å»å­˜å–ä¸€å€‹è³‡æ–™åº«ä¸å­˜åœ¨çš„æ•¸æ“šï¼Œç”±æ–¼ç·©å­˜ä¸­æ²’æœ‰è©²æ•¸æ“šå°è‡´å¤§é‡ä¸¦ç™¼æŸ¥è©¢è³‡æ–™åº«ï¼Œé€™å€‹ç¾åƒè¦ç·©å­˜ç©¿é€ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/4.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;ç·©å­˜ç©¿é€å¯ä»¥é€ æˆè³‡æ–™åº«ç¬é–“å£“åŠ›éå¤§ï¼Œé€£ç·šæ•¸ç­‰è³‡æºç”¨å®Œï¼Œæœ€å¾Œè³‡æ–™åº«æ‹’çµ•é€£ç·šä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£æ±ºç·©å­˜ç©¿é€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#è§£æ±ºç·©å­˜ç©¿é€&#34;&gt;#&lt;/a&gt; è§£æ±ºç·©å­˜ç©¿é€&lt;/h2&gt;
&lt;p&gt;å¦‚ä½•è§£æ±ºç·©å­˜ç©¿é€ï¼Ÿ&lt;br&gt;
1ï¸âƒ£å°è«‹æ±‚å¢åŠ æ ¡é©—æ©Ÿåˆ¶&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šèª²ç¨‹ Id æ˜¯é•·æ•´å‹ï¼Œå¦‚æœç™¼ä¾†çš„ä¸æ˜¯é•·æ•´å‹å‰‡ç›´æ¥å›å‚³ï¼Œä½†è¦æœ‰è¦çŸ©æ‰å¯ä»¥&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£ä½¿ç”¨å¸ƒéš†éæ¿¾å™¨&lt;/p&gt;
&lt;p&gt;å¸ƒéš†éæ¿¾å™¨çš„ç‰¹é»æ˜¯ï¼Œé«˜æ•ˆåœ°æ’å…¥å’ŒæŸ¥è©¢ï¼Œä½”ç”¨ç©ºé–“å°‘ï¼›æŸ¥è©¢çµæœæœ‰ä¸ç¢ºå®šæ€§ï¼Œå¦‚æœæŸ¥è©¢çµæœæ˜¯å­˜åœ¨å‰‡å…ƒç´ ä¸ä¸€å®šå­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å‰‡ä¸€å®šä¸å­˜åœ¨ï¼›å¦å¤–å®ƒåªèƒ½æ·»åŠ å…ƒç´  ä¸èƒ½åˆªé™¤å…ƒç´ ï¼Œå› ç‚ºåˆªé™¤å…ƒç´ æœƒå¢åŠ èª¤åˆ¤ç‡ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼šå°‡å•†å“ id å¯«å…¥å¸ƒéš†éæ¿¾å™¨ï¼Œå¦‚æœåˆ† 3 æ¬¡ hash æ­¤æ™‚åœ¨å¸ƒéš†éæ¿¾å™¨æœ‰ 3 å€‹é»ï¼Œç•¶å¾å¸ƒéš†éæ¿¾å™¨æŸ¥è©¢è©²å•†å“ idï¼Œé€é hash æ‰¾åˆ°äº†è©²å•†å“ id åœ¨éæ¿¾å™¨ ä¸­çš„é»ï¼Œæ­¤æ™‚å›å‚³ 1ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¸€å®šæœƒå›å‚³ 0ã€‚&lt;br&gt;
æ‰€ä»¥ï¼Œç‚ºäº†é¿å…ç·©å­˜ç©¿é€æˆ‘å€‘éœ€è¦ç·©å­˜é ç†±å°‡è¦æŸ¥è©¢çš„èª²ç¨‹æˆ–å•†å“è³‡è¨Šçš„ id æå‰å­˜å…¥å¸ƒéš†éæ¿¾å™¨ï¼Œæ·»åŠ è³‡æ–™æ™‚å°‡è³‡è¨Šçš„ id ä¹Ÿå­˜å…¥éæ¿¾å™¨ï¼Œç•¶å»æŸ¥è©¢ä¸€å€‹è³‡æ–™æ™‚å…ˆåœ¨ å¸ƒéš†éæ¿¾å™¨ä¸­æ‰¾ä¸€ä¸‹å¦‚æœæ²’æœ‰åˆ°åˆ°å°±è¡¨ç¤ºä¸å­˜åœ¨ï¼Œæ­¤æ™‚ç›´æ¥è¿”å›ã€‚&lt;br&gt;
å¯¦ä½œæ–¹æ³•æœ‰ï¼š1.Google å·¥å…·åŒ… Guava å¯¦ä½œ 2.redisson&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ç·©å­˜ç©ºå€¼æˆ–ç‰¹æ®Šå€¼&lt;/p&gt;
&lt;p&gt;è«‹æ±‚é€šéäº†ç¬¬ä¸€æ­¥çš„æ ¡é©—ï¼ŒæŸ¥è©¢è³‡æ–™åº«å¾—åˆ°çš„è³‡æ–™ä¸å­˜åœ¨ï¼Œæ­¤æ™‚æˆ‘å€‘ä»ç„¶å»ç·©å­˜æ•¸æ“šï¼Œç·©å­˜ä¸€å€‹ç©ºå€¼æˆ–ä¸€å€‹ç‰¹æ®Šå€¼çš„è³‡æ–™ã€‚&lt;br&gt;
ä½†æ˜¯è¦æ³¨æ„ï¼šå¦‚æœç·©å­˜äº†ç©ºå€¼æˆ–ç‰¹æ®Šå€¼è¦è¨­å®šä¸€å€‹çŸ­æš«çš„éæœŸæ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬é …æœ¬æ¡ç”¨è¿”å›ç©ºå€¼çš„è§£æ±ºæ–¹æ³•&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt;  &lt;span class=&#34;variable&#34;&gt;jsonObj&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonObj!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; jsonObj.toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonString.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;null&amp;quot;&lt;/span&gt;)) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//ä»æ•°æ®åº“æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®...&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getCoursePublish(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//è®¾ç½®è¿‡æœŸæ—¶é—´300ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish),&lt;span class=&#34;number&#34;&gt;30&lt;/span&gt;, TimeUnit.SECONDS); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;ç·©å­˜é›ªå´©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜é›ªå´©&#34;&gt;#&lt;/a&gt; ç·©å­˜é›ªå´©&lt;/h1&gt;
&lt;h2 id=&#34;ä»€éº¼æ˜¯ç·©å­˜é›ªå´©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€éº¼æ˜¯ç·©å­˜é›ªå´©&#34;&gt;#&lt;/a&gt; ä»€éº¼æ˜¯ç·©å­˜é›ªå´©&lt;/h2&gt;
&lt;p&gt;ç·©å­˜é›ªå´©æ˜¯ç·©å­˜ä¸­å¤§é‡ key å¤±æ•ˆå¾Œç•¶é«˜ä¸¦ç™¼åˆ°ä¾†æ™‚å°è‡´å¤§é‡è«‹æ±‚åˆ°è³‡æ–™åº«ï¼Œç¬é–“è€—ç›¡è³‡æ–™åº«è³‡æºï¼Œå°è‡´è³‡æ–™åº«ç„¡æ³•ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é€ æˆç·©å­˜é›ªå´©å•é¡Œçš„åŸå› æ˜¯å¤§é‡ key æ“æœ‰äº†ç›¸åŒçš„éæœŸæ™‚é–“ï¼Œä¾‹å¦‚å°èª²ç¨‹è³‡è¨Šè¨­å®šç·©å­˜éæœŸæ™‚é–“ç‚º 10 åˆ†é˜ï¼Œåœ¨å¤§é‡è«‹æ±‚åŒæ™‚æŸ¥è©¢å¤§é‡çš„èª²ç¨‹è³‡è¨Šæ™‚ï¼Œæ­¤æ™‚å°±æœƒæœ‰å¤§é‡çš„èª²ç¨‹å­˜åœ¨ç›¸åŒ çš„éæœŸæ™‚é–“ï¼Œä¸€æ—¦å¤±æ•ˆå°‡åŒæ™‚å¤±æ•ˆï¼Œé€ æˆé›ªå´©å•é¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£æ±ºç·©å­˜é›ªå´©&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#è§£æ±ºç·©å­˜é›ªå´©&#34;&gt;#&lt;/a&gt; è§£æ±ºç·©å­˜é›ªå´©&lt;/h2&gt;
&lt;p&gt;1ï¸âƒ£ä½¿ç”¨åŒæ­¥é–å®šæ§åˆ¶æŸ¥è©¢è³‡æ–™åº«çš„ç·šç¨‹&lt;br&gt;
ä½¿ç”¨åŒæ­¥é–å®šæ§åˆ¶æŸ¥è©¢è³‡æ–™åº«çš„ç·šç¨‹ï¼Œåªå…è¨±æœ‰ä¸€å€‹ç·šç¨‹å»æŸ¥è©¢è³‡æ–™åº«ï¼ŒæŸ¥è©¢å¾—åˆ°è³‡æ–™å¾Œå­˜å…¥ç·©å­˜ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;synchronized&lt;/span&gt;(obj)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//å­˜å…¥ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2ï¸âƒ£å°åŒä¸€é¡å‹è³‡è¨Šçš„ key è¨­å®šä¸åŒçš„éæœŸæ™‚é–“&lt;br&gt;
é€šå¸¸å°ä¸€é¡è³‡è¨Šçš„ key è¨­å®šçš„éæœŸæ™‚é–“æ˜¯ç›¸åŒçš„ï¼Œé€™è£¡å¯ä»¥åœ¨åŸæœ‰å›ºå®šæ™‚é–“çš„åŸºç¤ä¸ŠåŠ ä¸Šä¸€å€‹éš¨æ©Ÿæ™‚é–“ä½¿å®ƒå€‘çš„éæœŸæ™‚é–“éƒ½ä¸ç›¸åŒã€‚&lt;br&gt;
ç¯„ä¾‹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; &lt;span class=&#34;comment&#34;&gt;//è®¾ç½®è¿‡æœŸæ—¶é—´300ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish),&lt;span class=&#34;number&#34;&gt;300&lt;/span&gt;+&lt;span class=&#34;keyword&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;Random&lt;/span&gt;().nextInt(&lt;span class=&#34;number&#34;&gt;100&lt;/span&gt;), TimeUnit.SECONDS); &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3ï¸âƒ£ç·©å­˜é ç†±&lt;br&gt;
ä¸ç”¨ç­‰åˆ°è«‹æ±‚åˆ°ä¾†å†å»æŸ¥è©¢è³‡æ–™åº«å­˜å…¥ç·©å­˜ï¼Œå¯ä»¥æå‰å°‡è³‡æ–™å­˜å…¥ç·©å­˜ã€‚ ä½¿ç”¨ç·©å­˜é ç†±æ©Ÿåˆ¶é€šå¸¸æœ‰å°ˆé–€çš„å¾Œå°ç¨‹å¼å°‡è³‡æ–™åº«çš„è³‡æ–™åŒæ­¥åˆ°ç·©å­˜ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ç·©å­˜æ“Šç©¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ç·©å­˜æ“Šç©¿&#34;&gt;#&lt;/a&gt; ç·©å­˜æ“Šç©¿&lt;/h1&gt;
&lt;h2 id=&#34;ä»€éº¼æ˜¯ç·©å­˜æ“Šç©¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€éº¼æ˜¯ç·©å­˜æ“Šç©¿&#34;&gt;#&lt;/a&gt; ä»€éº¼æ˜¯ç·©å­˜æ“Šç©¿&lt;/h2&gt;
&lt;p&gt;ç·©å­˜æ“Šç©¿æ˜¯æŒ‡å¤§é‡ä¸¦ç™¼å­˜å–åŒä¸€å€‹ç†±é»æ•¸æ“šï¼Œç•¶ç†±é»è³‡æ–™å¤±æ•ˆå¾ŒåŒæ™‚å»è«‹æ±‚è³‡æ–™åº«ï¼Œç¬é–“è€—ç›¡è³‡æ–™åº«è³‡æºï¼Œå°è‡´è³‡æ–™åº«ç„¡æ³•ä½¿ç”¨ã€‚&lt;br&gt;
ä¾‹å¦‚æŸæ‰‹æ©Ÿæ–°å“ç™¼å¸ƒï¼Œç•¶ç·©å­˜å¤±æ•ˆæ™‚æœ‰å¤§é‡ä¸¦ç™¼åˆ°ä¾†å°è‡´åŒæ™‚å»å­˜å–è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è§£å†³ç·©å­˜æ“Šç©¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#è§£å†³ç·©å­˜æ“Šç©¿&#34;&gt;#&lt;/a&gt; è§£å†³ç·©å­˜æ“Šç©¿&lt;/h2&gt;
&lt;p&gt;å¦‚ä½•è§£æ±ºç·©å­˜æ“Šç©¿ï¼Ÿ&lt;/p&gt;
&lt;p&gt;1. ä½¿ç”¨åŒæ­¥é–å®šæ§åˆ¶æŸ¥è©¢è³‡æ–™åº«çš„ç·šç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨åŒæ­¥é–å®šæ§åˆ¶æŸ¥è©¢è³‡æ–™åº«çš„ç¨‹å¼ç¢¼ï¼Œåªå…è¨±æœ‰ä¸€å€‹åŸ·è¡Œç·’å»æŸ¥è©¢è³‡æ–™åº«ï¼ŒæŸ¥è©¢å¾—åˆ°è³‡æ–™åº«å­˜å…¥ç·©å­˜ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;synchronized&lt;/span&gt;(obj)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢æ•°æ®åº“ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;comment&#34;&gt;//å­˜å…¥ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2. ç†±é»æ•¸æ“šä¸éæœŸ&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç”±å¾Œå°ç¨‹å¼æå‰å°‡ç†±é»è³‡æ–™åŠ å…¥ç·©å­˜ï¼Œç·©å­˜éæœŸæ™‚é–“ä¸éæœŸï¼Œç”±å¾Œå°ç¨‹å¼åšå¥½ç·©å­˜åŒæ­¥ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt;  CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;synchronized&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(StringUtils.isNotEmpty(jsonString))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonString.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;null&amp;quot;&lt;/span&gt;)) &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;=========ä»æ•°æ®åº“æŸ¥è¯¢==========&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//ä»æ•°æ®åº“æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getCoursePublish(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           &lt;span class=&#34;comment&#34;&gt;//è®¾ç½®è¿‡æœŸæ—¶é—´300ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish),&lt;span class=&#34;number&#34;&gt;300&lt;/span&gt;, TimeUnit.SECONDS); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¸¬è©¦ï¼Œååé‡æœ‰ 1300 å·¦å³&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/5.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;å°‡ä¸Šé‚Šçš„ç¨‹å¼ç¢¼é€²è¡Œæœ€ä½³åŒ–ï¼ŒæŸ¥è©¢ç·©å­˜çš„ç¨‹å¼ç¢¼ä¸ç”¨ synchronized åŠ é–æ§åˆ¶ï¼Œåªå°æŸ¥è©¢è³‡æ–™åº«åŠ é–ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt;  CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt;  &lt;span class=&#34;variable&#34;&gt;jsonObj&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonObj!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; jsonObj.toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;synchronized&lt;/span&gt;(&lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;type&#34;&gt;Object&lt;/span&gt;  &lt;span class=&#34;variable&#34;&gt;jsonObj&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonObj!=&lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;)&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                   &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; jsonObj.toString(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                 System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;=========ä»æ•°æ®åº“æŸ¥è¯¢==========&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//ä»æ•°æ®åº“æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getCoursePublish(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;              &lt;span class=&#34;comment&#34;&gt;//è®¾ç½®è¿‡æœŸæ—¶é—´300ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish),&lt;span class=&#34;number&#34;&gt;300&lt;/span&gt;, TimeUnit.SECONDS); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æ¸¬è©¦ï¼ŒæŸ¥è©¢è³‡æ–™åº«åªç™¼ç”Ÿä¸€æ¬¡ï¼Œæ•´å€‹æ¸¬è©¦éç¨‹çš„ååé‡ç´„ 3800ã€‚&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/6.png&#34; class=&#34;abc&#34;&gt;
&lt;h1 id=&#34;åˆ†å¸ƒå¼é–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åˆ†å¸ƒå¼é–&#34;&gt;#&lt;/a&gt; åˆ†å¸ƒå¼é–&lt;/h1&gt;
&lt;h2 id=&#34;æœ¬åœ°é–çš„å•é¡Œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#æœ¬åœ°é–çš„å•é¡Œ&#34;&gt;#&lt;/a&gt; æœ¬åœ°é–çš„å•é¡Œ&lt;/h2&gt;
&lt;p&gt;ä¸Šé‚Šçš„ç¨‹å¼ä½¿ç”¨äº†åŒæ­¥é–å®šè§£æ±ºäº†ç·©å­˜æ“Šç©¿ã€ç·©å­˜é›ªå´©çš„å•é¡Œï¼Œä¸¦ä¿è­‰åŒä¸€å€‹ key éæœŸå¾ŒåªæœƒæŸ¥è©¢ä¸€æ¬¡è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå°‡åŒæ­¥é–å®šçš„ç¨‹å¼åˆ†æ•£éƒ¨ç½²åœ¨å¤šå€‹è™›æ“¬æ©Ÿå™¨ä¸Šå‰‡ç„¡æ³•ä¿è­‰åŒä¸€å€‹ key åªæœƒæŸ¥è©¢ä¸€æ¬¡è³‡æ–™åº«ï¼Œå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/7.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;ä¸€å€‹åŒæ­¥é–å®šç¨‹å¼åªèƒ½ä¿è­‰åŒä¸€å€‹è™›æ“¬æ©Ÿä¸­å¤šå€‹åŸ·è¡Œç·’åªæœ‰ä¸€å€‹åŸ·è¡Œç·’å»è³‡æ–™åº«ï¼Œå¦‚æœé«˜ä¸¦ç™¼é€éç¶²é—œè² è¼‰å¹³è¡¡è½‰é€çµ¦å„å€‹è™›æ“¬æ©Ÿï¼Œæ­¤æ™‚å°±æœƒå­˜åœ¨å¤šå€‹åŸ·è¡Œç·’å»æŸ¥è©¢è³‡æ–™åº«æƒ…æ³ï¼Œå› ç‚ºè™›æ“¬æ©Ÿ ä¸­çš„é–åªèƒ½ä¿è­‰è©²è™›æ“¬æ©Ÿå™¨è‡ªå·±çš„åŸ·è¡Œç·’å»åŒæ­¥åŸ·è¡Œï¼Œç„¡æ³•è·¨è™›æ“¬æ©Ÿå™¨ä¿è­‰åŒæ­¥åŸ·è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘å°‡è™›æ“¬æ©Ÿå™¨å…§éƒ¨çš„é–å«æœ¬åœ°é–ï¼Œæœ¬åœ°é–åªèƒ½ç¢ºä¿æ‰€åœ¨è™›æ“¬æ©Ÿå™¨çš„åŸ·è¡Œç·’åŒæ­¥åŸ·è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯åˆ†å¸ƒé–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€ä¹ˆæ˜¯åˆ†å¸ƒé–&#34;&gt;#&lt;/a&gt; ä»€ä¹ˆæ˜¯åˆ†å¸ƒé–&lt;/h2&gt;
&lt;p&gt;æœ¬æ©Ÿé–åªèƒ½æ§åˆ¶æ‰€åœ¨è™›æ“¬æ©Ÿå™¨ä¸­çš„åŸ·è¡Œç·’åŒæ­¥åŸ·è¡Œï¼Œç¾åœ¨è¦å¯¦ç¾åˆ†æ•£å¼ç’°å¢ƒä¸‹æ‰€æœ‰è™›æ“¬æ©Ÿå™¨ä¸­çš„åŸ·è¡Œç·’å»åŒæ­¥åŸ·è¡Œå°±éœ€è¦è®“å¤šå€‹è™›æ“¬æ©Ÿå™¨å»å…±ç”¨ä¸€å€‹é–ï¼Œè™›æ“¬æ©Ÿå™¨å¯ä»¥åˆ†æ•£éƒ¨ç½²ï¼Œé– ä¹Ÿå¯ä»¥åˆ†æ•£éƒ¨ç½²ï¼Œå¦‚ä¸‹åœ–ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/8.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;è™›æ“¬æ©Ÿå™¨éƒ½å»æ¶ä½”åŒä¸€å€‹é–ï¼Œé–æ˜¯ä¸€å€‹å–®ç¨çš„ç¨‹å¼æä¾›åŠ é–ã€è§£é–æœå‹™ï¼Œèª°æ¶åˆ°é–èª°å»æŸ¥è©¢è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;è©²é–å·²ä¸å±¬æ–¼æŸå€‹è™›æ“¬æ©Ÿï¼Œè€Œæ˜¯åˆ†æ•£å¼éƒ¨ç½²ï¼Œç”±å¤šå€‹è™›æ“¬æ©Ÿæ‰€å…±äº«ï¼Œé€™ç¨®é–å«åšåˆ†æ•£å¼é–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ†å¸ƒå¼é–çš„å¯¦ç¾æ–¹æ¡ˆ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åˆ†å¸ƒå¼é–çš„å¯¦ç¾æ–¹æ¡ˆ&#34;&gt;#&lt;/a&gt; åˆ†å¸ƒå¼é–çš„å¯¦ç¾æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;å¯¦ä½œåˆ†æ•£å¼é–çš„æ–¹æ¡ˆå¾ˆå¤šï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£åŸºæ–¼è³‡æ–™åº«å¯¦ç¾åˆ†ä½ˆé–&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨è³‡æ–™åº«ä¸»éµå”¯ä¸€æ€§çš„ç‰¹é»ï¼Œæˆ–åˆ©ç”¨è³‡æ–™åº«å”¯ä¸€ç´¢å¼•çš„ç‰¹é»ï¼Œå¤šå€‹åŸ·è¡Œç·’åŒæ™‚å»æ’å…¥ç›¸åŒçš„è¨˜éŒ„ï¼Œèª°æ’å…¥æˆåŠŸèª°å°±æ¶åˆ°é–ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£åŸºæ–¼ redis å¯¦ç¾é–&lt;/p&gt;
&lt;p&gt;redis æä¾›äº†åˆ†æ•£å¼é–å®šçš„å¯¦ä½œæ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼šSETNXã€set nxã€redisson ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ‹¿ SETNX èˆ‰ä¾‹èªªæ˜ï¼ŒSETNX æŒ‡ä»¤çš„å·¥ä½œéç¨‹æ˜¯å» set ä¸€å€‹ä¸å­˜åœ¨çš„ keyï¼Œå¤šå€‹åŸ·è¡Œç·’å»è¨­å®šåŒä¸€å€‹ key åªæœƒæœ‰ä¸€å€‹åŸ·è¡Œç·’è¨­å®šæˆåŠŸï¼Œè¨­å®šæˆåŠŸçš„åŸ·è¡Œç·’æ‹¿åˆ°é–å®šã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ä½¿ç”¨ zookeeper å¯¦ç¾&lt;/p&gt;
&lt;p&gt;zookeeper æ˜¯ä¸€å€‹åˆ†æ•£å¼å”èª¿æœå‹™ï¼Œä¸»è¦è§£æ±ºåˆ†æ•£å¼ç¨‹å¼ä¹‹é–“çš„åŒæ­¥çš„å•é¡Œã€‚ zookeeper çš„çµæ§‹é¡ä¼¼çš„æª”æ¡ˆç›®éŒ„ï¼Œå¤šåŸ·è¡Œç·’å‘ zookeeper å»ºç«‹ä¸€å€‹å­ç›®éŒ„ (ç¯€é») åªæœƒæœ‰ä¸€å€‹å‰µå»ºæˆåŠŸï¼Œåˆ©ç”¨æ­¤ç‰¹é»å¯ä»¥å¯¦ç¾åˆ†æ•£å¼é–ï¼Œèª°å‰µå»ºè©²çµé»æˆåŠŸèª°å°±ç²å¾—é–ã€‚&lt;/p&gt;
&lt;h1 id=&#34;redissonå¯¦ç¾åˆ†å¸ƒå¼é–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#redissonå¯¦ç¾åˆ†å¸ƒå¼é–&#34;&gt;#&lt;/a&gt; Redisson å¯¦ç¾åˆ†å¸ƒå¼é–&lt;/h1&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯redisson&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä»€ä¹ˆæ˜¯redisson&#34;&gt;#&lt;/a&gt; ä»€ä¹ˆæ˜¯ Redisson&lt;/h2&gt;
&lt;p&gt;æŸ¥é–± æ–‡æª”&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy5yZWRpcy5jbi9jb21tYW5kcy9zZXQuaHRtbA==&#34;&gt; http://www.redis.cn/commands/set.html&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å€‘é¸ç”¨ Java çš„å¯¦ä½œæ–¹æ¡ˆ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3JlZGlzc29uL3JlZGlzc29u&#34;&gt;https://github.com/redisson/redisson&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Redisson çš„æ–‡ä»¶ç¶²å€ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3JlZGlzc29uL3JlZGlzc29uL3dpa2kvVGFibGUtb2YtQ29udGVudA==&#34;&gt;https://github.com/redisson/redisson/wiki/Table-of-Content&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Redisson åº•å±¤æ¡ç”¨çš„æ˜¯ Netty æ¡†æ¶ã€‚ æ”¯æ´ Redis 2.8 ä»¥ä¸Šç‰ˆæœ¬ï¼Œæ”¯æ´ Java1.6 + ä»¥ä¸Šç‰ˆæœ¬ã€‚ Redisson æ˜¯ä¸€å€‹åœ¨ Redis çš„åŸºç¤ä¸Šå¯¦ç¾çš„ Java é§è¨˜æ†¶é«”è³‡æ–™ç¶²æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚ å®ƒä¸åƒ…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†æ•£å¼çš„ Java å¸¸ç”¨å°è±¡ï¼Œé‚„æä¾›äº†è¨±å¤šåˆ†æ•£å¼æœå‹™ã€‚&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ä½¿ç”¨ Redisson å¯ä»¥éå¸¸æ–¹ä¾¿å°‡ Java æœ¬åœ°è¨˜æ†¶é«”ä¸­çš„å¸¸ç”¨è³‡æ–™çµæ§‹çš„ç‰©ä»¶ç§»åˆ°åˆ†æ•£å¼ç·©å­˜ redis ä¸­ã€‚&lt;br&gt;
ä¹Ÿå¯ä»¥å°‡å¸¸ç”¨çš„ä¸¦ç™¼ç¨‹å¼è¨­è¨ˆå·¥å…·å¦‚ï¼šAtomicLongã€CountDownLatchã€Semaphore ç­‰æ”¯æ´åˆ†æ•£å¼ã€‚&lt;br&gt;
ä½¿ç”¨ RScheduledExecutorService å¯¦ç¾åˆ†æ•£å¼èª¿åº¦æœå‹™ã€‚&lt;br&gt;
æ”¯æ´è³‡æ–™åˆ†ç‰‡ï¼Œå°‡è³‡æ–™åˆ†ç‰‡å„²å­˜åˆ°ä¸åŒçš„ redis å¯¦ä¾‹ä¸­ã€‚&lt;br&gt;
æ”¯æ´åˆ†æ•£å¼é–ï¼ŒåŸºæ–¼ Java çš„ Lock ä»‹é¢å¯¦ç¾åˆ†æ•£å¼é–ï¼Œæ–¹ä¾¿é–‹ç™¼ã€‚&lt;br&gt;
ä¸‹é‚Šä½¿ç”¨ Redisson å°‡ Queue éšŠåˆ—çš„è³‡æ–™å­˜å…¥ Redisï¼Œå¯¦ä½œä¸€å€‹æ’éšŠåŠå‡ºéšŠçš„ä»‹é¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;img data-src=&#34;/John/img/java/redis/9.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;æ·»åŠ  redisson çš„ä¾èµ–&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;groupId&amp;gt;org.redisson&amp;lt;/groupId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;artifactId&amp;gt;redisson-spring-boot-starter&amp;lt;/artifactId&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;lt;version&amp;gt;&lt;span class=&#34;number&#34;&gt;3.11&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;.2&lt;/span&gt;&amp;lt;/version&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;/dependency&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä»è¯¾ç¨‹èµ„æ–™ç›®å½•æ‹·è´ singleServerConfig.yaml åˆ° config å·¥ç¨‹ä¸‹&lt;/p&gt;
&lt;p&gt;åœ¨ redis é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YAML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;spring:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;attr&#34;&gt;redis:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;attr&#34;&gt;redisson:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;comment&#34;&gt;#é…ç½®æ–‡ä»¶ç›®å½• &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;attr&#34;&gt;config:&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;classpath:singleServerConfig.yaml&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;comment&#34;&gt;#config: classpath:clusterServersConfig.yaml &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;redis å¢é›†é…ç½® clusterServersConfig.yaml.&lt;/p&gt;
&lt;p&gt;Redisson ç›¸æ¯” set nx å¯¦ä½œåˆ†æ•£å¼é–è¦ç°¡å–®çš„å¤šï¼Œå·¥ä½œåŸç†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;img data-src=&#34;/John/img/java/redis/10.png&#34; class=&#34;abc&#34;&gt;
&lt;p&gt;1ï¸âƒ£åŠ é–æ©Ÿåˆ¶:&lt;/p&gt;
&lt;p&gt;åŸ·è¡Œç·’å»å–å¾—é–ï¼Œå–å¾—æˆåŠŸï¼šåŸ·è¡Œ lua è…³æœ¬ï¼Œå„²å­˜è³‡æ–™åˆ° redis è³‡æ–™åº«ã€‚&lt;/p&gt;
&lt;p&gt;åŸ·è¡Œç·’å»å–å¾—é–ï¼Œå–å¾—å¤±æ•—ï¼šä¸€ç›´é€é while å¾ªç’°å˜—è©¦å–å¾—é–ï¼Œå–å¾—æˆåŠŸå¾Œï¼ŒåŸ·è¡Œ lua è…³æœ¬ï¼Œå„²å­˜è³‡æ–™åˆ° redis&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£WatchDog è‡ªå‹•å»¶æœŸçœ‹é–€ç‹—æ©Ÿåˆ¶:&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç¨®æƒ…æ³ï¼šåœ¨ä¸€å€‹åˆ†æ•£å¼ç’°å¢ƒä¸‹ï¼Œå‡å¦‚ä¸€å€‹ç·šç¨‹ç²å¾—é–å¾Œï¼Œçªç„¶ä¼ºæœå™¨å®•æ©Ÿäº†ï¼Œé‚£éº¼é€™å€‹æ™‚å€™åœ¨ä¸€å®šæ™‚é–“å¾Œé€™å€‹é–æœƒè‡ªå‹•é‡‹æ”¾ï¼Œä½ ä¹Ÿå¯ä»¥è¨­å®šé–çš„æœ‰æ•ˆæ™‚é–“ (ç•¶ä¸è¨­ç½® é è¨­ 30 ç§’æ™‚ï¼‰ï¼Œé€™æ¨£çš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢æ­»é–çš„ç™¼ç”Ÿ&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒç¨®æƒ…æ³ï¼šç·šç¨‹ A æ¥­å‹™é‚„æ²’åŸ·è¡Œå®Œï¼Œæ™‚é–“å°±éäº†ï¼Œç·šç¨‹ A é‚„æƒ³æŒæœ‰é–çš„è©±ï¼Œå°±æœƒå•Ÿå‹•ä¸€å€‹ watch dog å¾Œå°ç·šç¨‹ï¼Œä¸æ–·çš„å»¶é•·é– key çš„ç”Ÿå­˜æ™‚é–“ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£lua è…³æœ¬ - ä¿è­‰åŸå­æ€§æ“ä½œ:&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ˜¯å¦‚æœä½ çš„æ¥­å‹™é‚è¼¯è¤‡é›œçš„è©±ï¼Œé€éå°è£åœ¨ lua è…³æœ¬ä¸­ç™¼é€çµ¦ redisï¼Œè€Œä¸” redis æ˜¯å–®ç·šç¨‹çš„ï¼Œé€™æ¨£å°±ä¿è­‰é€™æ®µè¤‡é›œæ¥­å‹™é‚è¼¯åŸ·è¡Œçš„åŸå­æ€§&lt;/p&gt;
&lt;p&gt;å…·é«”ä½¿ç”¨ RLock æ“ä½œåˆ†ä½ˆé–ï¼ŒRLock ç¹¼æ‰¿ JDK çš„ Lock æ¥å£ï¼Œæ‰€ä»¥ä»–æœ‰ Lock æ¥å£çš„æ‰€æœ‰ç‰¹æ€§ï¼Œæ¯”å¦‚ lockã€unlockã€trylock ç­‰ç‰¹æ€§ï¼ŒåŒæ™‚å®ƒé‚„æœ‰å¾ˆå¤šæ–°ç‰¹æ€§ï¼šå¼·åˆ¶é–é‡‹æ”¾ï¼Œå¸¶æœ‰æ•ˆæœŸçš„é–ï¼Œã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;title class_&#34;&gt;RLock&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;   &lt;span class=&#34;comment&#34;&gt;//----------------------Lockæ¥å£æ–¹æ³•----------------------- &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * åŠ é” é”çš„æœ‰æ•ˆæœŸé»˜è®¤30ç§’ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * åŠ é” å¯ä»¥æ‰‹åŠ¨è®¾ç½®é”çš„æœ‰æ•ˆæ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; leaseTime é”æœ‰æ•ˆæ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; unit      æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; leaseTime, TimeUnit unit)&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * tryLock()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œç”¨æ¥å°è¯•è·å–é”ï¼Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * å¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å›false . &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;tryLock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * tryLock(long time, TimeUnit unit)æ–¹æ³•å’ŒtryLock()æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * åªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * åœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å›falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å›trueã€‚ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; time ç­‰å¾…æ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; unit æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;tryLock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; time, TimeUnit unit)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; InterruptedException; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * æ¯”ä¸Šé¢å¤šä¸€ä¸ªå‚æ•°ï¼Œå¤šæ·»åŠ ä¸€ä¸ªé”çš„æœ‰æ•ˆæ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; waitTime  ç­‰å¾…æ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; leaseTime é”æœ‰æ•ˆæ—¶é—´ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * &lt;span class=&#34;doctag&#34;&gt;@param&lt;/span&gt; unit      æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * waitTime å¤§äº leaseTime &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;type&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;tryLock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(&lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; waitTime, &lt;span class=&#34;type&#34;&gt;long&lt;/span&gt; leaseTime, TimeUnit unit)&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;throws&lt;/span&gt; InterruptedException; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     * è§£é” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;     */&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;title function_&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;()&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;lock()ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£æ­¤æ–¹æ³•ç‚ºåŠ é–ï¼Œä½†æ˜¯é–çš„æœ‰æ•ˆæœŸé™æ¡ç”¨é è¨­ 30 ç§’&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£å¦‚æœä¸»åŸ·è¡Œç·’æœªé‡‹æ”¾ï¼Œä¸”ç›®å‰é–å®šæœªå‘¼å« unlock æ–¹æ³•ï¼Œå‰‡é€²å…¥åˆ° watchDog æ©Ÿåˆ¶&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£å¦‚æœä¸»åŸ·è¡Œç·’æœªé‡‹æ”¾ï¼Œä¸”ç›®å‰é–å®šå‘¼å« unlock æ–¹æ³•ï¼Œå‰‡ç›´æ¥é‡‹æ”¾é–å®š&lt;/p&gt;
&lt;h2 id=&#34;åˆ†å¸ƒå¼é–é¿å…ç¼“å­˜æ“Šç©¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#åˆ†å¸ƒå¼é–é¿å…ç¼“å­˜æ“Šç©¿&#34;&gt;#&lt;/a&gt; åˆ†å¸ƒå¼é–é¿å…ç¼“å­˜æ“Šç©¿&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨åˆ†å¸ƒå¼é–ä¿®æ”¹æŸ¥è©¢èª²ç¨‹è³‡è¨Šçš„ä»‹é¢ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight java&#34;&gt;&lt;figcaption&gt;&lt;span&gt;java&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;//Redissonåˆ†å¸ƒå¼é” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;public&lt;/span&gt;  CoursePublish &lt;span class=&#34;title function_&#34;&gt;getCoursePublishCache&lt;/span&gt;&lt;span class=&#34;params&#34;&gt;(Long courseId)&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;//æŸ¥è¯¢ç¼“å­˜ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;type&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;jsonString&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; (String) redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(StringUtils.isNotEmpty(jsonString))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(jsonString.equals(&lt;span class=&#34;string&#34;&gt;&amp;quot;null&amp;quot;&lt;/span&gt;))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;null&lt;/span&gt;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//æ¯é—¨è¯¾ç¨‹è®¾ç½®ä¸€ä¸ªé” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;type&#34;&gt;RLock&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;lock&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; redissonClient.getLock(&lt;span class=&#34;string&#34;&gt;&amp;quot;coursequerylock:&amp;quot;&lt;/span&gt;+courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;comment&#34;&gt;//è·å–é” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            lock.lock(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &lt;span class=&#34;keyword&#34;&gt;try&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                jsonString = (String) redisTemplate.opsForValue().get(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(StringUtils.isNotEmpty(jsonString))&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; JSON.parseObject(jsonString, CoursePublish.class); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                    &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                System.out.println(&lt;span class=&#34;string&#34;&gt;&amp;quot;=========ä»æ•°æ®åº“æŸ¥è¯¢==========&amp;quot;&lt;/span&gt;); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//ä»æ•°æ®åº“æŸ¥è¯¢ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;type&#34;&gt;CoursePublish&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;coursePublish&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt; getCoursePublish(courseId); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                redisTemplate.opsForValue().set(&lt;span class=&#34;string&#34;&gt;&amp;quot;course:&amp;quot;&lt;/span&gt; + courseId, JSON.toJSONString(coursePublish),&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,TimeUnit.DAYS); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;keyword&#34;&gt;return&lt;/span&gt; coursePublish; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125;&lt;span class=&#34;keyword&#34;&gt;finally&lt;/span&gt; &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                &lt;span class=&#34;comment&#34;&gt;//é‡Šæ”¾é” &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                lock.unlock(); &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;åˆ†å¸ƒå¼é–é¿å…ç¼“å­˜æ“Šç©¿æµç¨‹:&lt;br&gt;
1ï¸âƒ£æ³¨å…¥ RedissonClient&lt;br&gt;
2ï¸âƒ£ç”Ÿæˆä»¥èª²ç¨‹ ID å‘½åçš„é–&lt;br&gt;
3ï¸âƒ£ç²å¾—é–&lt;br&gt;
4ï¸âƒ£å¦‚æœä¸»ç·šç¨‹æœªåŸ·è¡Œå®Œï¼Œä½†å·²è¶…éæœŸæ™‚æ•ˆï¼Œæœƒé€²å…¥ WatchDog æ©Ÿåˆ¶ï¼Œå†ä¸€æ¬¡è¨ˆç®—éæœŸæ™‚é–“&lt;br&gt;
5ï¸âƒ£ä¸»ç·šç¨‹åŸ·è¡Œå®Œ&lt;br&gt;
6ï¸âƒ£é‡‹æ”¾é–&lt;/p&gt;
&lt;img data-src=&#34;https://usagif.com/wp-content/uploads/gifs/thanks-for-watching-9.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;</content>
        <category term="Radis" />
        <updated>2023-10-26T14:15:36.096Z</updated>
    </entry>
    <entry>
        <id>https://superrjohn.github.io/John/2023/10/22/hexo/Hexo</id>
        <title>Hexoå¿«é€Ÿéƒ¨ç½²!</title>
        <link rel="alternate" href="https://superrjohn.github.io/John/2023/10/22/hexo/Hexo"/>
        <content type="html">&lt;h2 id=&#34;å‰è¨€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å‰è¨€&#34;&gt;#&lt;/a&gt; å‰è¨€&lt;/h2&gt;
&lt;p&gt;æƒ³éƒ¨ç½²ä¸€å€‹è‡ªå·±çš„ç¶²ç«™çš„åŸå› ï¼Œæ˜¯å› ç‚ºæŸå¤©åœ¨å­¸ JAVA é …ç›®æ™‚é‡åˆ°å¾ˆå¤š BUG, å°±æ»‘è©•è«–å€æ‰¾è§£æ±ºæ–¹æ¡ˆï¼Œç„¶å¾Œè¢«æˆ‘æ‰¾åˆ°ä¸€å€‹å¤§ç¥ï¼Œä»–æŠŠå­¸ç¿’éç¨‹éƒ½æ”¾åœ¨è‡ªå·±çš„ç¶²ç«™ä¸Šï¼Œæˆ‘è¦ºå¾—å¾ˆé…·ï¼Œæ‰€ä»¥ä¹Ÿæ‰“ç®—æ•ˆä»¿ï½é‚£é€™ç¯‡ä¸»è¦æ˜¯è¨˜éŒ„ä¸€ä¸‹éƒ¨ç½²éç¨‹è¸©å‘çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;hexoéƒ¨ç½²&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#hexoéƒ¨ç½²&#34;&gt;#&lt;/a&gt; Hexo éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;1. é¦–å…ˆç…§è‘—å®˜æ–¹æ–‡æª”å®‰è£&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9oZXhvLmlvL3poLWNuL2RvY3Mv&#34;&gt; Hexo&lt;/span&gt; å’Œæ‰€éœ€æ‡‰ç”¨&lt;br&gt;
 2. å…¶å¯¦å®˜æ–¹æ–‡æª”èªªæ˜å¾—å¾ˆæ¸…æ¥šï¼Œç…§è‘—å®ƒèªªçš„éƒ¨ç½²åŸºæœ¬æ²’æœ‰å•é¡Œï¼Œæœ¬äººæ˜¯åˆ©ç”¨ Hexo å’Œ Github Pages éƒ¨ç½²çš„ã€‚&lt;br&gt;
3. è¦æ³¨æ„çš„é»æ˜¯ source æ–‡ä»¶æœƒå­˜æ”¾æ‰€ä»¥æ–‡ç« ï¼Œæ‰€ä»¥å®ƒæ˜¯ç¶²åŸŸçš„çˆ¶è·¯ç”±ï¼Œå¦‚æœä½ æƒ³æ–°å¢å­è·¯ç”±ï¼Œéœ€è¦å‰µä¸€å€‹æ–‡ä»¶å¤¾ï¼Œä½ ç‚ºæ–‡ä»¶å¤¾èµ·çš„åå­—å°±æ˜¯ path äº†ï¼Œç„¶å¾Œå†å‰µä¸€å€‹ index.md çš„æª”æ¡ˆå°±å®Œæˆå•¦ï½&lt;/p&gt;
&lt;h2 id=&#34;ä¸»é¡Œé…ç½®-é¦–é¡µç²¾é€‰ä¸åˆ†ç±»ç¿»è½¬å—&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸»é¡Œé…ç½®-é¦–é¡µç²¾é€‰ä¸åˆ†ç±»ç¿»è½¬å—&#34;&gt;#&lt;/a&gt; ä¸»é¡Œé…ç½® - é¦–é¡µç²¾é€‰ä¸åˆ†ç±»ç¿»è½¬å—&lt;/h2&gt;
&lt;p&gt;1. æœ¬ç«™ä¸»é¡Œæ˜¯ç”¨ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kb2NzLmthaXRha3UueHl6L2d1aWRlLw==&#34;&gt;hexo-theme-shokaX&lt;/span&gt; è«‹å…ˆä¸‹è¼‰ï¼Œæˆ‘æœƒä»¥é€™å€‹ä¸»é¡Œçš„é…ç½®åšè¨˜éŒ„ï¼Œä¸éåŸºæœ¬ä¸Šä¸»é¡Œçš„ä½¿ç”¨éƒ½å¤§åŒå°ç•°ã€‚&lt;br&gt;
2 ä¿®æ”¹ç¶²ç«™é…ç½®ï¼Œåœ¨ Hexo æ ¹ç›®éŒ„ _config.yml ä¸­æ‰¾åˆ° category_mapï¼Œé…ç½®æ¯å€‹åˆ†é¡å°æ‡‰çš„è‹±æ–‡æ˜ å°„ã€‚&lt;br&gt;
Hexo å°æ–¼è·¯å¾‘ä¸­çš„ç‰¹æ®Šå­—å…ƒï½``!@#$%^&amp;amp;*()-_+={}|;:&amp;quot;&#39;&amp;lt;&amp;gt;,.? ä»¥åŠç©ºæ ¼ï¼Œé€™äº›å…¨éƒ¨æœƒè¢«æ›¿æ›æˆ -&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;category_map:&lt;br&gt;
 è®¡ç®—æœºç§‘å­¦: computer-science&lt;br&gt;
C++: cpp&lt;br&gt;
 éƒ‘è‰è€å¸ˆ C++ è¯­è¨€ç¨‹åºè®¾è®¡: course-1&lt;br&gt;
Linux: Linux&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;2.1ã€è¨­å®šæ–‡ç« æ‰€å±¬çš„ç›®éŒ„&lt;/p&gt;
&lt;p&gt;source/_posts ç‚ºä¸Šå‚³æ–‡ç« çš„å„²å­˜ç›®éŒ„ ã€‚&lt;/p&gt;
&lt;p&gt;categories çš„è¨­å®šè¦æ ¹æ“šä¸Šé¢çš„ category_map ä»¥åŠæ–‡ä»¶é †åºé †åºæ›¸å¯«ã€‚ ä¾‹å¦‚ï¼ŒæŸæ–‡ä»¶ä½æ–¼é›»è…¦ç§‘å­¸ / C++/ é„­è‰è€å¸« C++ èªè¨€ç¨‹å¼è¨­è¨ˆç›®éŒ„ä¸‹ï¼Œæ ¹æ“šä¸Šé¢çš„æ˜ å°„ï¼Œåœ¨å„²å­˜æª”æ¡ˆçš„_posts æª”æ¡ˆè·¯å¾‘ä¸‹å°±ä½æ–¼ source/_posts ä¸‹ computer-science/cpp/course-1 ç›®éŒ„ ä¸‹ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;yml&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;categories:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  - [è®¡ç®—æœºç§‘å­¦, C++, éƒ‘è‰è€å¸ˆC++è¯­è¨€ç¨‹åºè®¾è®¡]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;img data-src=&#34;/John/img/hexo/categories.png&#34; class=&#34;abc&#34; width=&#34;350&#34; height=&#34;300&#34;&gt;
&lt;p&gt;ä»¥ä¸Šæ˜¯å®˜æ–¹æ–‡æª”å…§å®¹&lt;/p&gt;
&lt;h2 id=&#34;ä¸»é¡Œé…ç½®-è©•è«–å€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸»é¡Œé…ç½®-è©•è«–å€&#34;&gt;#&lt;/a&gt; ä¸»é¡Œé…ç½® - è©•è«–å€&lt;/h2&gt;
&lt;p&gt;ç…§è‘—å®˜æ–¹æ–‡æª”é…ç½®è©•è«–ç³»çµ±æœ€å¾Œçµæœæœƒæ˜¯ not initialized, åŸå› æˆ‘ä¹Ÿæ‰¾äº†å¾ˆä¹…ï¼Œçµ‚æ–¼è§£æ±ºäº†ï½æ‰€ä»¥è¨˜éŒ„ä¸‹&lt;br&gt;
 1. é¦–å…ˆåœ¨é…ç½®æ ¹ç›®å½•ä¸‹ _config.shokaX.yml çš„è¯„è®ºç³»ç»Ÿï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;figcaption&gt;&lt;span&gt;YML&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;waline:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  enable: true # æ˜¯å¦å¯ç”¨&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  serverURL: &amp;quot;https://domains.zeabur.app&amp;quot; # å°†æ­¤é“¾æ¥æ¢æˆæ‚¨è‡ªå·±çš„Domains,ä¸»é¡µé“¾æ¥åé¢ä¸èƒ½åŠ  /  ä¼šå‡ºé”™&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2. å®˜æ–¹æ¨è–¦ç”¨&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93YWxpbmUuanMub3JnL2d1aWRlL2RlcGxveS96ZWFidXIuaHRtbA==&#34;&gt; Zeabur&lt;/span&gt; æœåŠ¡ç«¯éƒ¨ç½²ï¼ŒæŒ‰ç…§å®ƒçš„æ­¥é©Ÿå¾Œåšæ¸¬è©¦æ™‚æœƒç™¼ç¾å¾—åˆ°çš„æ˜¯ not initialized, ç‚ºä»€éº¼å‘¢ï¼Ÿ&lt;br&gt;
 åŸå› æ˜¯ zeabur åªæ˜¯æœå‹™å™¨ï¼Œè€Œå®˜æ–¹é»˜èªæ˜¯ç”¨ LeanCloud ç‚ºæ•¸æ“šåº«ï¼Œæ‰€ä»¥åœ¨&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93YWxpbmUuanMub3JnL2d1aWRlL2dldC1zdGFydGVkLw==&#34;&gt; Waline&lt;/span&gt; å¿«é€Ÿä¸Šæ‰‹ä¸­æœ‰èªªæ˜è¦è¨»å†Š LeanCloud å¸³è™Ÿæ‰å¯ä»¥ï¼Œè¡¨ç…§å¿«é€Ÿä¸Šæ‰‹çš„æ•™å­¸ï¼Œå¾—åˆ° APP ID,APP Key å’Œ Master Key, ç„¶å¾Œé€²å…¥ zeabur-starter ä¸­çš„ Variables é€²è¡Œé…ç½®ï¼Œé…ç½®ç’°å¢ƒè®Šé‡ LEAN_ID, LEAN_KEY å’Œ LEAN_MASTER_KEY, å€¼æ˜¯è¨»å†Š LeanCloud å¾—åˆ°çš„å€¼åƒé€™æ¨£é…ï½&lt;/p&gt;
&lt;img data-src=&#34;/John/img/hexo/zeabur-starter-variable.png&#34; class=&#34;abc&#34; width=&#34;650&#34; height=&#34;450&#34;&gt;
&lt;p&gt;2.1 ä¸€é–‹å§‹è¦ºå¾—ç¶²ç«™ä¸€å®šè¦æœ‰å€‹è©•è«–å€å§ï½æ‰€ä»¥å°±é…ç½®äº†ä¸€å€‹ï¼Œä¸éé…ç½®å¾Œç™¼ç¾ï¼Œzeabur åªæœ‰ 7 å¤©å…è²»ï¼ŒéæœŸå‰å¯ä»¥å»¶çºŒ 7 å¤©ï¼Œæ‰€ä»¥æŸå¤©ç™¼ç¾è©•è«–å€ä¸è¦‹äº†ï¼Œæ²’éŒ¯æ˜¯æˆ‘å¤ªæ‡¶æ²’æœ‰å»¶çºŒï¼Œç•¶ç„¶è§£æ±ºæ–¹æ³•å¯ä»¥éƒ¨ç½²åœ¨è‡ªå·±çš„ docker æˆ–äº‘æœå‹™ã€‚&lt;br&gt;
2.2&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93YWxpbmUuanMub3JnL2d1aWRlL2dldC1zdGFydGVkLw==&#34;&gt;Zeabur å¿«é€Ÿä¸Šæ‰‹&lt;/span&gt;ï¼Œå› ç‚ºæƒ³è¨­å€‹è©•è«–ç™¼ç¾äº†é€™å€‹è©•è«–ç³»çµ±ï¼Œè¦ºå¾—å®ƒè »ä¸éŒ¯çš„ï¼Œé‚„å¤šåŠŸèƒ½çš„åƒæ˜¯ç•™è¨€å¾Œæœƒç²å¾—é€šçŸ¥ï¼Œç”¨æˆ¶å®‰å…¨æ€§å’Œç•™è¨€é™åˆ¶ç­‰ç­‰ï¼Œæ„Ÿè¦ºæœ‰ç©ºå¯ä»¥å†æ·±å…¥ç ”ç©¶ç ”ç©¶ã€‚&lt;/p&gt;
&lt;img data-src=&#34;https://i.makeagif.com/media/9-15-2015/bQkqor.gif&#34; class=&#34;abc&#34; width=&#34;600&#34; height=&#34;350&#34;&gt;</content>
        <category term="hexo" />
        <updated>2023-10-22T08:24:11.599Z</updated>
    </entry>
</feed>
